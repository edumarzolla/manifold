class Ps{constructor(){this._listeners={}}addEventListener(e,r){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(r)===-1&&n[e].push(r),this}removeEventListener(e,r){if(this._listeners===void 0)return this;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(r);a!==-1&&s.splice(a,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const n=this._listeners[e.type];if(n!==void 0){const s=n.slice(0);for(let a=0,c=s.length;a<c;a++)s[a].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class gr extends Ps{constructor(e,r,n,s={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=r,this._child=n,this._attributes=s,!r.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class ph extends Ps{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(r=>r.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(r=>r.getChild())}disconnectParents(e,r){let n=this.listParentEdges(e);return r&&(n=n.filter(s=>r(s.getParent()))),n.forEach(s=>s.dispose()),this}createEdge(e,r,n,s){return this._registerEdge(new gr(e,r,n,s))}_registerEdge(e){this._edges.add(e);const r=e.getParent();this._parentEdges.has(r)||this._parentEdges.set(r,new Set),this._parentEdges.get(r).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function Br(){return Br=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Br.apply(this,arguments)}function xs(t){return t instanceof gr}function Dr(t){return Array.isArray(t)&&t[0]instanceof gr}function $r(t){return!!(mh(t)&&gh(t)instanceof gr)}function gh(t){for(const e in t)return t[e]}function mh(t){return!!t&&Object.getPrototypeOf(t)===Object.prototype}const Te=Symbol("attributes"),ur=Symbol("immutableKeys");class ks extends Ps{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[Te]=void 0,this[ur]=void 0,this.graph=e,this[ur]=new Set,this[Te]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),r={};for(const n in e){const s=e[n];if(s instanceof ks){const a=this.graph.createEdge(n,this,s);a.addEventListener("dispose",()=>s.dispose()),this[ur].add(n),r[n]=a}else r[n]=s}return r}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,r){for(const n in this[Te]){const s=this[Te][n];if(xs(s)){const a=s;a.getChild()===e&&this.setRef(n,r,a.getAttributes())}else if(Dr(s)){const c=s.find(l=>l.getChild()===e);if(c){const l=c.getAttributes();this.removeRef(n,e).addRef(n,r,l)}}else if($r(s)){const a=s;for(const c in a){const l=a[c];l.getChild()===e&&this.setRefMap(n,c,r,l.getAttributes())}}}return this}get(e){return this[Te][e]}set(e,r){return this[Te][e]=r,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const r=this[Te][e];return r?r.getChild():null}setRef(e,r,n){if(this[ur].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const s=this[Te][e];if(s&&s.dispose(),!r)return this;const a=this.graph.createEdge(e,this,r,n);return a.addEventListener("dispose",()=>{delete this[Te][e],this.dispatchEvent({type:"change",attribute:e})}),this[Te][e]=a,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[Te][e].map(n=>n.getChild())}addRef(e,r,n){const s=this.graph.createEdge(e,this,r,n),a=this[Te][e];return a.push(s),s.addEventListener("dispose",()=>{let c;for(;(c=a.indexOf(s))!==-1;)a.splice(c,1);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,r){return this[Te][e].filter(a=>a.getChild()===r).forEach(a=>a.dispose()),this}listRefMapKeys(e){return Object.keys(this[Te][e])}listRefMapValues(e){return Object.values(this[Te][e]).map(r=>r.getChild())}getRefMap(e,r){const n=this[Te][e];return n[r]?n[r].getChild():null}setRefMap(e,r,n,s){const a=this[Te][e],c=a[r];if(c&&c.dispose(),!n)return this;s=Object.assign(s||{},{key:r});const l=this.graph.createEdge(e,this,n,Br({},s,{key:r}));return l.addEventListener("dispose",()=>{delete a[r],this.dispatchEvent({type:"change",attribute:e,key:r})}),a[r]=l,this.dispatchEvent({type:"change",attribute:e,key:r})}dispatchEvent(e){return super.dispatchEvent(Br({},e,{target:this})),this.graph.dispatchEvent(Br({},e,{target:this,type:`node:${e.type}`})),this}}const Ca="v3.8.0",mr="@glb.bin";var W,bn,rt,ut,Kt;(function(t){t.ACCESSOR="Accessor",t.ANIMATION="Animation",t.ANIMATION_CHANNEL="AnimationChannel",t.ANIMATION_SAMPLER="AnimationSampler",t.BUFFER="Buffer",t.CAMERA="Camera",t.MATERIAL="Material",t.MESH="Mesh",t.PRIMITIVE="Primitive",t.PRIMITIVE_TARGET="PrimitiveTarget",t.NODE="Node",t.ROOT="Root",t.SCENE="Scene",t.SKIN="Skin",t.TEXTURE="Texture",t.TEXTURE_INFO="TextureInfo"})(W||(W={})),function(t){t.INTERLEAVED="interleaved",t.SEPARATE="separate"}(bn||(bn={})),function(t){t.ARRAY_BUFFER="ARRAY_BUFFER",t.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",t.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",t.OTHER="OTHER",t.SPARSE="SPARSE"}(rt||(rt={})),function(t){t[t.R=4096]="R",t[t.G=256]="G",t[t.B=16]="B",t[t.A=1]="A"}(ut||(ut={})),function(t){t.GLTF="GLTF",t.GLB="GLB"}(Kt||(Kt={}));const An={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var gn,Ts=typeof Float32Array<"u"?Float32Array:Array;function us(t){return Math.hypot(t[0],t[1],t[2])}function vh(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[3]*n+r[7]*s+r[11]*a+r[15];return t[0]=(r[0]*n+r[4]*s+r[8]*a+r[12])/(c=c||1),t[1]=(r[1]*n+r[5]*s+r[9]*a+r[13])/c,t[2]=(r[2]*n+r[6]*s+r[10]*a+r[14])/c,t}function yh(t){const e={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},r=t.propertyType===W.NODE?[t]:t.listChildren();for(const n of r)n.traverse(s=>{const a=s.getMesh();if(!a)return;const c=xh(a,s.getWorldMatrix());Es(c.min,e),Es(c.max,e)});return e}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),gn=new Ts(3),Ts!=Float32Array&&(gn[0]=0,gn[1]=0,gn[2]=0);function xh(t,e){const r={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of t.listPrimitives()){const s=n.getAttribute("POSITION");if(!s)continue;let a=[0,0,0],c=[0,0,0];for(let l=0;l<s.getCount();l++)a=s.getElement(l,a),c=vh(c,a,e),Es(c,r)}return r}function Es(t,e){for(let r=0;r<3;r++)e.min[r]=Math.min(t[r],e.min[r]),e.max[r]=Math.max(t[r],e.max[r])}class oe{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const r=atob(e.split(",")[1]),n=new Uint8Array(r.length);for(let s=0;s<r.length;s++)n[s]=r.charCodeAt(s);return n}{const r=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(r,n?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let r=0;for(const a of e)r+=a.byteLength;const n=new Uint8Array(r);let s=0;for(const a of e)n.set(a,s),s+=a.byteLength;return n}static pad(e,r=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const s=new Uint8Array(n);if(s.set(e),r!==0)for(let a=e.byteLength;a<n;a++)s[a]=r;return s}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,r){if(e===r)return!0;if(e.byteLength!==r.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==r[n])return!1;return!0}static toView(e,r=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+r,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}let Qe=class{static hexToFactor(e,r){e=Math.floor(e);const n=r;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(r,r)}static factorToHex(e){const r=[...e],[n,s,a]=this.convertLinearToSRGB(e,r);return 255*n<<16^255*s<<8^255*a<<0}static convertSRGBToLinear(e,r){const n=e,s=r;for(let a=0;a<3;a++)s[a]=n[a]<.04045?.0773993808*n[a]:Math.pow(.9478672986*n[a]+.0521327014,2.4);return r}static convertLinearToSRGB(e,r){const n=e,s=r;for(let a=0;a<3;a++)s[a]=n[a]<.0031308?12.92*n[a]:1.055*Math.pow(n[a],.41666)-.055;return r}},Na=class Fa{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const r=new DataView(e.buffer,e.byteOffset);return oe.decodeText(e.slice(12,16))===Fa.PNG_FRIED_CHUNK_NAME?[r.getUint32(32,!1),r.getUint32(36,!1)]:[r.getUint32(16,!1),r.getUint32(20,!1)]}getChannels(e){return 4}};Na.PNG_FRIED_CHUNK_NAME="CgBI";let vt=class{static registerFormat(e,r){this.impls[e]=r}static getMimeType(e){for(const r in this.impls)if(this.impls[r].match(e))return r;return null}static getSize(e,r){return this.impls[r]?this.impls[r].getSize(e):null}static getChannels(e,r){return this.impls[r]?this.impls[r].getChannels(e):null}static getVRAMByteLength(e,r){if(!this.impls[r])return null;if(this.impls[r].getVRAMByteLength)return this.impls[r].getVRAMByteLength(e);let n=0;const s=this.getSize(e,r);if(!s)return null;for(;s[0]>1||s[1]>1;)n+=s[0]*s[1]*4,s[0]=Math.max(Math.floor(s[0]/2),1),s[1]=Math.max(Math.floor(s[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}};function Th(t,e){if(e>t.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(t.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return t}vt.impls={"image/jpeg":new class{match(t){return t.length>=3&&t[0]===255&&t[1]===216&&t[2]===255}getSize(t){let e,r,n=new DataView(t.buffer,t.byteOffset+4);for(;n.byteLength;){if(e=n.getUint16(0,!1),Th(n,e),r=n.getUint8(e+1),r===192||r===193||r===194)return[n.getUint16(e+7,!1),n.getUint16(e+5,!1)];n=new DataView(t.buffer,n.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(t){return 3}},"image/png":new Na};let vr=class{static basename(e){const r=e.split(/[\\/]/).pop();return r.substring(0,r.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const r=e.match(/data:(image\/\w+)/)[1];return vt.mimeTypeToExtension(r)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}};function ea(t){return Object.prototype.toString.call(t)==="[object Object]"}function Xt(t){if(ea(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const r=e.prototype;return ea(r)!==!1&&Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")!==!1}var hs,ws;(function(t){t[t.SILENT=4]="SILENT",t[t.ERROR=3]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=1]="INFO",t[t.DEBUG=0]="DEBUG"})(ws||(ws={}));let Jt=class Pr{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Pr.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Pr.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Pr.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Pr.Verbosity.ERROR&&console.error(e)}};function Eh(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=e[4],u=e[5],d=e[6],g=e[7],T=e[8],E=e[9],M=e[10],A=e[11],N=e[12],m=e[13],I=e[14],x=e[15],_=r[0],b=r[1],F=r[2],D=r[3];return t[0]=_*n+b*l+F*T+D*N,t[1]=_*s+b*u+F*E+D*m,t[2]=_*a+b*d+F*M+D*I,t[3]=_*c+b*g+F*A+D*x,t[4]=(_=r[4])*n+(b=r[5])*l+(F=r[6])*T+(D=r[7])*N,t[5]=_*s+b*u+F*E+D*m,t[6]=_*a+b*d+F*M+D*I,t[7]=_*c+b*g+F*A+D*x,t[8]=(_=r[8])*n+(b=r[9])*l+(F=r[10])*T+(D=r[11])*N,t[9]=_*s+b*u+F*E+D*m,t[10]=_*a+b*d+F*M+D*I,t[11]=_*c+b*g+F*A+D*x,t[12]=(_=r[12])*n+(b=r[13])*l+(F=r[14])*T+(D=r[15])*N,t[13]=_*s+b*u+F*E+D*m,t[14]=_*a+b*d+F*M+D*I,t[15]=_*c+b*g+F*A+D*x,t}hs=Jt,Jt.Verbosity=ws,Jt.DEFAULT_INSTANCE=new hs(hs.Verbosity.INFO);let Ne=class Ms{static identity(e){return e}static eq(e,r,n=1e-5){if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-r[s])>n)return!1;return!0}static decodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,r){return Ms.decodeNormalizedInt(e,r)}static encodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,r){return Ms.encodeNormalizedInt(e,r)}static decompose(e,r,n,s){let a=us([e[0],e[1],e[2]]);const c=us([e[4],e[5],e[6]]),l=us([e[8],e[9],e[10]]);var u,d,g,T,E,M,A,N,m,I,x,_,b,F,D,V,B;((d=(u=e)[0])*(A=u[5])-(g=u[1])*(M=u[4]))*((_=u[10])*(B=u[15])-(b=u[11])*(V=u[14]))-(d*(N=u[6])-(T=u[2])*M)*((x=u[9])*B-b*(D=u[13]))+(d*(m=u[7])-(E=u[3])*M)*(x*V-_*D)+(g*N-T*A)*((I=u[8])*B-b*(F=u[12]))-(g*m-E*A)*(I*V-_*F)+(T*m-E*N)*(I*D-x*F)<0&&(a=-a),r[0]=e[12],r[1]=e[13],r[2]=e[14];const U=e.slice(),z=1/a,G=1/c,K=1/l;U[0]*=z,U[1]*=z,U[2]*=z,U[4]*=G,U[5]*=G,U[6]*=G,U[8]*=K,U[9]*=K,U[10]*=K,function(H,k){var q=new Ts(3);(function(St,Ge){var yt=Ge[4],He=Ge[5],It=Ge[6],Jr=Ge[8],rr=Ge[9],Vn=Ge[10];St[0]=Math.hypot(Ge[0],Ge[1],Ge[2]),St[1]=Math.hypot(yt,He,It),St[2]=Math.hypot(Jr,rr,Vn)})(q,k);var ue=1/q[0],re=1/q[1],ve=1/q[2],ge=k[0]*ue,ye=k[1]*re,xe=k[2]*ve,_e=k[4]*ue,ke=k[5]*re,be=k[6]*ve,Ie=k[8]*ue,et=k[9]*re,at=k[10]*ve,Ze=ge+ke+at,Ee=0;Ze>0?(Ee=2*Math.sqrt(Ze+1),H[3]=.25*Ee,H[0]=(be-et)/Ee,H[1]=(Ie-xe)/Ee,H[2]=(ye-_e)/Ee):ge>ke&&ge>at?(Ee=2*Math.sqrt(1+ge-ke-at),H[3]=(be-et)/Ee,H[0]=.25*Ee,H[1]=(ye+_e)/Ee,H[2]=(Ie+xe)/Ee):ke>at?(Ee=2*Math.sqrt(1+ke-ge-at),H[3]=(Ie-xe)/Ee,H[0]=(ye+_e)/Ee,H[1]=.25*Ee,H[2]=(be+et)/Ee):(Ee=2*Math.sqrt(1+at-ge-ke),H[3]=(ye-_e)/Ee,H[0]=(Ie+xe)/Ee,H[1]=(be+et)/Ee,H[2]=.25*Ee)}(n,U),s[0]=a,s[1]=c,s[2]=l}static compose(e,r,n,s){const a=s,c=r[0],l=r[1],u=r[2],d=r[3],g=c+c,T=l+l,E=u+u,M=c*g,A=c*T,N=c*E,m=l*T,I=l*E,x=u*E,_=d*g,b=d*T,F=d*E,D=n[0],V=n[1],B=n[2];return a[0]=(1-(m+x))*D,a[1]=(A+F)*D,a[2]=(N-b)*D,a[3]=0,a[4]=(A-F)*V,a[5]=(1-(M+x))*V,a[6]=(I+_)*V,a[7]=0,a[8]=(N+b)*B,a[9]=(I-_)*B,a[10]=(1-(M+m))*B,a[11]=0,a[12]=e[0],a[13]=e[1],a[14]=e[2],a[15]=1,a}};function wh(t,e){if(!!t!=!!e)return!1;const r=t.getChild(),n=e.getChild();return r===n||r.equals(n)}function Mh(t,e){if(!!t!=!!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++){const n=t[r],s=e[r];if(n.getChild()!==s.getChild()&&!n.getChild().equals(s.getChild()))return!1}return!0}function _h(t,e){if(!!t!=!!e)return!1;const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const s in t){const a=t[s],c=e[s];if(!!a!=!!c)return!1;const l=a.getChild(),u=c.getChild();if(l!==u&&!l.equals(u))return!1}return!0}function Oa(t,e){if(t===e)return!0;if(!!t!=!!e||!t||!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Da(t,e){if(t===e)return!0;if(!!t!=!!e)return!1;if(!Xt(t)||!Xt(e))return t===e;const r=t,n=e;let s,a=0,c=0;for(s in r)a++;for(s in n)c++;if(a!==c)return!1;for(s in r){const l=r[s],u=n[s];if(Sn(l)&&Sn(u)){if(!Oa(l,u))return!1}else if(Xt(l)&&Xt(u)){if(!Da(l,u))return!1}else if(l!==u)return!1}return!0}function Sn(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const ta=new Set,Rh=function(){let t="";for(let e=0;e<6;e++)t+="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ".charAt(Math.floor(42*Math.random()));return t},bh=function(){for(let t=0;t<999;t++){const e=Rh();if(!ta.has(e))return ta.add(e),e}return""},ra="https://null.example";let jr=class{static dirname(e){const r=e.lastIndexOf("/");return r===-1?"./":e.substring(0,r+1)}static basename(e){return vr.basename(new URL(e,ra).pathname)}static extension(e){return vr.extension(new URL(e,ra).pathname)}static resolve(e,r){if(!this.isRelativePath(r))return r;const n=e.split("/"),s=r.split("/");n.pop();for(let a=0;a<s.length;a++)s[a]!=="."&&(s[a]===".."?n.pop():n.push(s[a]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}};jr.DEFAULT_INIT={},jr.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const bt=t=>t,Ah=new Set;let Us=class extends ks{constructor(e,r=""){super(e),this[Te].name=r,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,r){return Array.isArray(r)&&(r=r.slice()),super.set(e,r)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,bt)}copy(e,r=bt){for(const n in this[Te]){const s=this[Te][n];if(s instanceof gr)this[ur].has(n)||s.dispose();else if(Dr(s))for(const a of s)a.dispose();else if($r(s))for(const a in s)s[a].dispose()}for(const n in e[Te]){const s=this[Te][n],a=e[Te][n];if(a instanceof gr)this[ur].has(n)?s.getChild().copy(r(a.getChild()),r):this.setRef(n,r(a.getChild()),a.getAttributes());else if(Dr(a))for(const c of a)this.addRef(n,r(c.getChild()),c.getAttributes());else if($r(a))for(const c in a){const l=a[c];this.setRefMap(n,c,r(l.getChild()),l.getAttributes())}else this[Te][n]=Xt(a)?JSON.parse(JSON.stringify(a)):Array.isArray(a)||a instanceof ArrayBuffer||ArrayBuffer.isView(a)?a.slice():a}return this}equals(e,r=Ah){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[Te]){if(r.has(n))continue;const s=this[Te][n],a=e[Te][n];if(xs(s)||xs(a)){if(!wh(s,a))return!1}else if(Dr(s)||Dr(a)){if(!Mh(s,a))return!1}else if($r(s)||$r(a)){if(!_h(s,a))return!1}else if(Xt(s)||Xt(a)){if(!Da(s,a))return!1}else if(Sn(s)||Sn(a)){if(!Oa(s,a))return!1}else if(s!==a)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}},Je=class extends Us{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,r){return r&&r.t(this),this.setRefMap("extensions",e,r)}listExtensions(){return this.listRefMapValues("extensions")}},te=class Ae extends Je{constructor(...e){super(...e),this.i=Ne.identity,this.o=Ne.identity}init(){this.propertyType=W.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:Ae.Type.SCALAR,componentType:Ae.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,r=bt){return super.copy(e,r),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case Ae.Type.SCALAR:return 1;case Ae.Type.VEC2:return 2;case Ae.Type.VEC3:return 3;case Ae.Type.VEC4:case Ae.Type.MAT2:return 4;case Ae.Type.MAT3:return 9;case Ae.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case Ae.ComponentType.BYTE:case Ae.ComponentType.UNSIGNED_BYTE:return 1;case Ae.ComponentType.SHORT:case Ae.ComponentType.UNSIGNED_SHORT:return 2;case Ae.ComponentType.UNSIGNED_INT:case Ae.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const r=this.getElementSize();this.getMin(e);for(let n=0;n<r;n++)e[n]=this.o(e[n]);return e}getMin(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let a=0;a<s;a++)e[a]=1/0;for(let a=0;a<n*s;a+=s)for(let c=0;c<s;c++){const l=r[a+c];Number.isFinite(l)&&(e[c]=Math.min(e[c],l))}return e}getMaxNormalized(e){const r=this.getElementSize();this.getMax(e);for(let n=0;n<r;n++)e[n]=this.o(e[n]);return e}getMax(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let a=0;a<s;a++)e[a]=-1/0;for(let a=0;a<n*s;a+=s)for(let c=0;c<s;c++){const l=r[a+c];Number.isFinite(l)&&(e[c]=Math.max(e[c],l))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return Ae.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=r=>Ne.decodeNormalizedInt(r,this.get("componentType")),this.i=r=>Ne.encodeNormalizedInt(r,this.get("componentType"))):(this.o=Ne.identity,this.i=Ne.identity),this}getScalar(e){const r=this.getElementSize();return this.o(this.get("array")[e*r])}setScalar(e,r){return this.get("array")[e*this.getElementSize()]=this.i(r),this}getElement(e,r){const n=this.getElementSize(),s=this.get("array");for(let a=0;a<n;a++)r[a]=this.o(s[e*n+a]);return r}setElement(e,r){const n=this.getElementSize(),s=this.get("array");for(let a=0;a<n;a++)s[e*n+a]=this.i(r[a]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(r){switch(r.constructor){case Float32Array:return Ae.ComponentType.FLOAT;case Uint32Array:return Ae.ComponentType.UNSIGNED_INT;case Uint16Array:return Ae.ComponentType.UNSIGNED_SHORT;case Uint8Array:return Ae.ComponentType.UNSIGNED_BYTE;case Int16Array:return Ae.ComponentType.SHORT;case Int8Array:return Ae.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):Ae.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}};te.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},te.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};let $a=class extends Je{init(){this.propertyType=W.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}},Ls=class extends Je{init(){this.propertyType=W.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}};Ls.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};let Un=class Pa extends Je{init(){this.propertyType=W.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Pa.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:rt.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:rt.OTHER})}};Un.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};let ka=class extends Je{init(){this.propertyType=W.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}},Kr=class Ua extends Je{init(){this.propertyType=W.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Ua.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}};Kr.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};let $e=class extends Us{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}};$e.EXTENSION_NAME=void 0;let Fe=class _s extends Je{init(){this.propertyType=W.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:_s.WrapMode.REPEAT,wrapT:_s.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}};Fe.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Fe.MagFilter={NEAREST:9728,LINEAR:9729},Fe.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:mn,G:vn,B:yn,A:Sh}=ut;let yr=class La extends Je{init(){this.propertyType=W.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:La.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Fe(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Fe(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Fe(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Fe(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Fe(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const r=this.get("baseColorFactor").slice();return r[3]=e,this.set("baseColorFactor",r)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return Qe.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const r=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Qe.hexToFactor(e,r))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:mn|vn|yn|Sh,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return Qe.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const r=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Qe.hexToFactor(e,r))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:mn|vn|yn,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:mn|vn|yn})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:mn})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:vn|yn})}};yr.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};let Ba=class extends Je{init(){this.propertyType=W.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}},ja=class extends Je{constructor(...e){super(...e),this.u=null,this.h=new Set}init(){this.propertyType=W.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,r=bt){if(r===bt)throw new Error("Node cannot be copied.");return super.copy(e,r)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Ne.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const r=this.get("translation").slice(),n=this.get("rotation").slice(),s=this.get("scale").slice();return Ne.decompose(e,r,n,s),this.set("translation",r).set("rotation",n).set("scale",s)}getWorldTranslation(){const e=[0,0,0];return Ne.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Ne.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Ne.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let s=this;s!=null;s=s.u)e.push(s);let r;const n=e.pop().getMatrix();for(;r=e.pop();)Eh(n,n,r.getMatrix());return n}addChild(e){if(e.u&&e.u.removeChild(e),e.h.size)for(const n of e.h)n.removeChild(e);this.addRef("children",e),e.u=this;const r=this[Te].children;return r[r.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===W.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const r of this.listChildren())r.traverse(e);return this}},Hr=class Va extends Je{init(){this.propertyType=W.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Va.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:rt.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:rt.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}};Hr.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};let Ih=class extends Us{init(){this.propertyType=W.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:rt.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}};function Ke(){return Ke=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Ke.apply(this,arguments)}let za=class extends Je{init(){this.propertyType=W.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,r=bt){if(r===bt)throw new Error("Scene cannot be copied.");return super.copy(e,r)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.h.add(this);const r=this[Te].children;return r[r.length-1].addEventListener("dispose",()=>e.h.delete(this)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const r of this.listChildren())r.traverse(e);return this}},Ga=class extends Je{init(){this.propertyType=W.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:rt.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}},qa=class extends Je{init(){this.propertyType=W.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||vt.extensionToMimeType(vr.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const r=vt.extensionToMimeType(vr.extension(e));return r&&this.set("mimeType",r),this}getImage(){return this.get("image")}setImage(e){return this.set("image",oe.assertView(e))}getSize(){const e=this.get("image");return e?vt.getSize(e,this.getMimeType()):null}},Ha=class extends Je{init(){this.propertyType=W.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${Ca}`,version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.l=new Set,e.addEventListener("node:create",r=>{this.g(r.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,r=bt){if(r===bt)throw new Error("Root cannot be copied.");this.set("asset",Ke({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Ke({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?r(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const s=e.getExtension(n);this.setExtension(n,r(s))}return this}g(e){return e instanceof za?this.addRef("scenes",e):e instanceof ja?this.addRef("nodes",e):e instanceof Kr?this.addRef("cameras",e):e instanceof Ga?this.addRef("skins",e):e instanceof Ba?this.addRef("meshes",e):e instanceof yr?this.addRef("materials",e):e instanceof qa?this.addRef("textures",e):e instanceof $a?this.addRef("animations",e):e instanceof te?this.addRef("accessors",e):e instanceof ka&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.l)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}p(e){return this.l.add(e),this}m(e){return this.l.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}},Bs=class En{static fromGraph(e){return En.v.get(e)||null}constructor(){this.T=new ph,this.S=new Ha(this.T),this.M=Jt.DEFAULT_INSTANCE,En.v.set(this.T,this)}getRoot(){return this.S}getGraph(){return this.T}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new En().setLogger(this.M).merge(this)}merge(e){for(const a of e.getRoot().listExtensionsUsed()){const c=this.createExtension(a.constructor);a.isRequired()&&c.setRequired(!0)}const r=new Set,n=new Map;r.add(e.S),n.set(e.S,this.S);for(const a of e.T.listEdges())for(const c of[a.getParent(),a.getChild()]){if(r.has(c))continue;let l;l=c.propertyType===W.TEXTURE_INFO?c:new c.constructor(this.T),n.set(c,l),r.add(c)}const s=a=>{const c=n.get(a);if(!c)throw new Error("Could resolve property.");return c};for(const a of r){const c=n.get(a);if(!c)throw new Error("Could resolve property.");c.propertyType!==W.TEXTURE_INFO&&c.copy(a,s)}return this}async transform(...e){const r=e.map(n=>n.name);for(const n of e)await n(this,{stack:r});return this}createExtension(e){const r=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===r)||new e(this)}createScene(e=""){return new za(this.T,e)}createNode(e=""){return new ja(this.T,e)}createCamera(e=""){return new Kr(this.T,e)}createSkin(e=""){return new Ga(this.T,e)}createMesh(e=""){return new Ba(this.T,e)}createPrimitive(){return new Hr(this.T)}createPrimitiveTarget(e=""){return new Ih(this.T,e)}createMaterial(e=""){return new yr(this.T,e)}createTexture(e=""){return new qa(this.T,e)}createAnimation(e=""){return new $a(this.T,e)}createAnimationChannel(e=""){return new Ls(this.T,e)}createAnimationSampler(e=""){return new Un(this.T,e)}createAccessor(e="",r=null){return r||(r=this.getRoot().listBuffers()[0]),new te(this.T,e).setBuffer(r)}createBuffer(e=""){return new ka(this.T,e)}};Bs.v=new WeakMap;let Se=class{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.I=void 0,this.document=e,e.getRoot().p(this),this.I=n=>{const s=n,a=s.target;a instanceof $e&&a.extensionName===this.extensionName&&(s.type==="node:create"&&this.N(a),s.type==="node:dispose"&&this.O(a))};const r=e.getGraph();r.addEventListener("node:create",this.I),r.addEventListener("node:dispose",this.I)}dispose(){this.document.getRoot().m(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.I),e.removeEventListener("node:dispose",this.I);for(const r of this.properties)r.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}N(e){return this.properties.add(e),this}O(e){return this.properties.delete(e),this}install(e,r){return this}preread(e,r){return this}prewrite(e,r){return this}};Se.EXTENSION_NAME=void 0;let Ch=class{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,r){this.textureInfos.set(e,r),r.texCoord!==void 0&&e.setTexCoord(r.texCoord),r.extras!==void 0&&e.setExtras(r.extras);const n=this.jsonDoc.json.textures[r.index];if(n.sampler===void 0)return;const s=this.jsonDoc.json.samplers[n.sampler];s.magFilter!==void 0&&e.setMagFilter(s.magFilter),s.minFilter!==void 0&&e.setMinFilter(s.minFilter),s.wrapS!==void 0&&e.setWrapS(s.wrapS),s.wrapT!==void 0&&e.setWrapT(s.wrapT)}};const na={logger:Jt.DEFAULT_INSTANCE,extensions:[],dependencies:{}};let Nh=class{static read(e,r=na){const n=Ke({},na,r),{json:s}=e,a=new Bs().setLogger(n.logger);this.validate(e,n);const c=new Ch(e),l=s.asset,u=a.getRoot().getAsset();l.copyright&&(u.copyright=l.copyright),l.extras&&(u.extras=l.extras),s.extras!==void 0&&a.getRoot().setExtras(Ke({},s.extras));const d=s.extensionsUsed||[],g=s.extensionsRequired||[];for(const x of n.extensions)if(d.includes(x.EXTENSION_NAME)){const _=a.createExtension(x).setRequired(g.includes(x.EXTENSION_NAME));for(const b of _.readDependencies)_.install(b,n.dependencies[b])}const T=s.buffers||[];a.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(W.BUFFER)).forEach(x=>x.preread(c,W.BUFFER)),c.buffers=T.map(x=>{const _=a.createBuffer(x.name);return x.extras&&_.setExtras(x.extras),x.uri&&x.uri.indexOf("__")!==0&&_.setURI(x.uri),_}),c.bufferViewBuffers=(s.bufferViews||[]).map((x,_)=>{if(!c.bufferViews[_]){const b=e.json.buffers[x.buffer];c.bufferViews[_]=oe.toView(b.uri?e.resources[b.uri]:e.resources[mr],x.byteOffset||0,x.byteLength)}return c.buffers[x.buffer]});const E=s.accessors||[];c.accessors=E.map(x=>{const _=a.createAccessor(x.name,c.bufferViewBuffers[x.bufferView]).setType(x.type);return x.extras&&_.setExtras(x.extras),x.normalized!==void 0&&_.setNormalized(x.normalized),x.bufferView===void 0||_.setArray(xn(x,c)),_});const M=s.images||[],A=s.textures||[];a.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(W.TEXTURE)).forEach(x=>x.preread(c,W.TEXTURE)),c.textures=M.map(x=>{const _=a.createTexture(x.name);if(x.extras&&_.setExtras(x.extras),x.bufferView!==void 0){const b=s.bufferViews[x.bufferView],F=e.json.buffers[b.buffer],D=b.byteOffset||0,V=(F.uri?e.resources[F.uri]:e.resources[mr]).slice(D,D+b.byteLength);_.setImage(V)}else x.uri!==void 0&&(_.setImage(e.resources[x.uri]),x.uri.indexOf("__")!==0&&_.setURI(x.uri));if(x.mimeType!==void 0)_.setMimeType(x.mimeType);else if(x.uri){const b=vr.extension(x.uri);_.setMimeType(vt.extensionToMimeType(b))}return _}),c.materials=(s.materials||[]).map(x=>{const _=a.createMaterial(x.name);x.extras&&_.setExtras(x.extras),x.alphaMode!==void 0&&_.setAlphaMode(x.alphaMode),x.alphaCutoff!==void 0&&_.setAlphaCutoff(x.alphaCutoff),x.doubleSided!==void 0&&_.setDoubleSided(x.doubleSided);const b=x.pbrMetallicRoughness||{};if(b.baseColorFactor!==void 0&&_.setBaseColorFactor(b.baseColorFactor),x.emissiveFactor!==void 0&&_.setEmissiveFactor(x.emissiveFactor),b.metallicFactor!==void 0&&_.setMetallicFactor(b.metallicFactor),b.roughnessFactor!==void 0&&_.setRoughnessFactor(b.roughnessFactor),b.baseColorTexture!==void 0){const F=b.baseColorTexture;_.setBaseColorTexture(c.textures[A[F.index].source]),c.setTextureInfo(_.getBaseColorTextureInfo(),F)}if(x.emissiveTexture!==void 0){const F=x.emissiveTexture;_.setEmissiveTexture(c.textures[A[F.index].source]),c.setTextureInfo(_.getEmissiveTextureInfo(),F)}if(x.normalTexture!==void 0){const F=x.normalTexture;_.setNormalTexture(c.textures[A[F.index].source]),c.setTextureInfo(_.getNormalTextureInfo(),F),x.normalTexture.scale!==void 0&&_.setNormalScale(x.normalTexture.scale)}if(x.occlusionTexture!==void 0){const F=x.occlusionTexture;_.setOcclusionTexture(c.textures[A[F.index].source]),c.setTextureInfo(_.getOcclusionTextureInfo(),F),x.occlusionTexture.strength!==void 0&&_.setOcclusionStrength(x.occlusionTexture.strength)}if(b.metallicRoughnessTexture!==void 0){const F=b.metallicRoughnessTexture;_.setMetallicRoughnessTexture(c.textures[A[F.index].source]),c.setTextureInfo(_.getMetallicRoughnessTextureInfo(),F)}return _});const N=s.meshes||[];a.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(W.PRIMITIVE)).forEach(x=>x.preread(c,W.PRIMITIVE)),c.meshes=N.map(x=>{const _=a.createMesh(x.name);return x.extras&&_.setExtras(x.extras),x.weights!==void 0&&_.setWeights(x.weights),(x.primitives||[]).forEach(b=>{const F=a.createPrimitive();b.extras&&F.setExtras(b.extras),b.material!==void 0&&F.setMaterial(c.materials[b.material]),b.mode!==void 0&&F.setMode(b.mode);for(const[V,B]of Object.entries(b.attributes||{}))F.setAttribute(V,c.accessors[B]);b.indices!==void 0&&F.setIndices(c.accessors[b.indices]);const D=x.extras&&x.extras.targetNames||[];(b.targets||[]).forEach((V,B)=>{const U=D[B]||B.toString(),z=a.createPrimitiveTarget(U);for(const[G,K]of Object.entries(V))z.setAttribute(G,c.accessors[K]);F.addTarget(z)}),_.addPrimitive(F)}),_}),c.cameras=(s.cameras||[]).map(x=>{const _=a.createCamera(x.name).setType(x.type);if(x.extras&&_.setExtras(x.extras),x.type===Kr.Type.PERSPECTIVE){const b=x.perspective;_.setYFov(b.yfov),_.setZNear(b.znear),b.zfar!==void 0&&_.setZFar(b.zfar),b.aspectRatio!==void 0&&_.setAspectRatio(b.aspectRatio)}else{const b=x.orthographic;_.setZNear(b.znear).setZFar(b.zfar).setXMag(b.xmag).setYMag(b.ymag)}return _});const m=s.nodes||[];a.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(W.NODE)).forEach(x=>x.preread(c,W.NODE)),c.nodes=m.map(x=>{const _=a.createNode(x.name);if(x.extras&&_.setExtras(x.extras),x.translation!==void 0&&_.setTranslation(x.translation),x.rotation!==void 0&&_.setRotation(x.rotation),x.scale!==void 0&&_.setScale(x.scale),x.matrix!==void 0){const b=[0,0,0],F=[0,0,0,1],D=[1,1,1];Ne.decompose(x.matrix,b,F,D),_.setTranslation(b),_.setRotation(F),_.setScale(D)}return x.weights!==void 0&&_.setWeights(x.weights),_}),c.skins=(s.skins||[]).map(x=>{const _=a.createSkin(x.name);x.extras&&_.setExtras(x.extras),x.inverseBindMatrices!==void 0&&_.setInverseBindMatrices(c.accessors[x.inverseBindMatrices]),x.skeleton!==void 0&&_.setSkeleton(c.nodes[x.skeleton]);for(const b of x.joints)_.addJoint(c.nodes[b]);return _}),m.map((x,_)=>{const b=c.nodes[_];(x.children||[]).forEach(F=>b.addChild(c.nodes[F])),x.mesh!==void 0&&b.setMesh(c.meshes[x.mesh]),x.camera!==void 0&&b.setCamera(c.cameras[x.camera]),x.skin!==void 0&&b.setSkin(c.skins[x.skin])}),c.animations=(s.animations||[]).map(x=>{const _=a.createAnimation(x.name);x.extras&&_.setExtras(x.extras);const b=(x.samplers||[]).map(F=>{const D=a.createAnimationSampler().setInput(c.accessors[F.input]).setOutput(c.accessors[F.output]).setInterpolation(F.interpolation||Un.Interpolation.LINEAR);return F.extras&&D.setExtras(F.extras),_.addSampler(D),D});return(x.channels||[]).forEach(F=>{const D=a.createAnimationChannel().setSampler(b[F.sampler]).setTargetPath(F.target.path);F.target.node!==void 0&&D.setTargetNode(c.nodes[F.target.node]),F.extras&&D.setExtras(F.extras),_.addChannel(D)}),_});const I=s.scenes||[];return a.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(W.SCENE)).forEach(x=>x.preread(c,W.SCENE)),c.scenes=I.map(x=>{const _=a.createScene(x.name);return x.extras&&_.setExtras(x.extras),(x.nodes||[]).map(b=>c.nodes[b]).forEach(b=>_.addChild(b)),_}),s.scene!==void 0&&a.getRoot().setDefaultScene(c.scenes[s.scene]),a.getRoot().listExtensionsUsed().forEach(x=>x.read(c)),E.forEach((x,_)=>{const b=c.accessors[_],F=!!x.sparse,D=!x.bufferView&&!b.getArray();(F||D)&&b.setSparse(!0).setArray(function(V,B){const U=An[V.componentType],z=te.getElementSize(V.type);let G;G=V.bufferView!==void 0?xn(V,B):new U(V.count*z);const K=V.sparse;if(!K)return G;const H=K.count,k=Ke({},V,K.indices,{count:H,type:"SCALAR"}),q=Ke({},V,K.values,{count:H}),ue=xn(k,B),re=xn(q,B);for(let ve=0;ve<k.count;ve++)for(let ge=0;ge<z;ge++)G[ue[ve]*z+ge]=re[ve*z+ge];return G}(x,c))}),a}static validate(e,r){const n=e.json;if(n.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${n.asset.version}".`);if(n.extensionsRequired){for(const s of n.extensionsRequired)if(!r.extensions.find(a=>a.EXTENSION_NAME===s))throw new Error(`Missing required extension, "${s}".`)}if(n.extensionsUsed)for(const s of n.extensionsUsed)r.extensions.find(a=>a.EXTENSION_NAME===s)||r.logger.warn(`Missing optional extension, "${s}".`)}};function xn(t,e){const r=e.bufferViews[t.bufferView],n=e.jsonDoc.json.bufferViews[t.bufferView],s=An[t.componentType],a=te.getElementSize(t.type),c=s.BYTES_PER_ELEMENT;if(n.byteStride!==void 0&&n.byteStride!==a*c)return function(u,d){const g=d.bufferViews[u.bufferView],T=d.jsonDoc.json.bufferViews[u.bufferView],E=An[u.componentType],M=te.getElementSize(u.type),A=E.BYTES_PER_ELEMENT,N=u.byteOffset||0,m=new E(u.count*M),I=new DataView(g.buffer,g.byteOffset,g.byteLength),x=T.byteStride;for(let _=0;_<u.count;_++)for(let b=0;b<M;b++){const F=N+_*x+b*A;let D;switch(u.componentType){case te.ComponentType.FLOAT:D=I.getFloat32(F,!0);break;case te.ComponentType.UNSIGNED_INT:D=I.getUint32(F,!0);break;case te.ComponentType.UNSIGNED_SHORT:D=I.getUint16(F,!0);break;case te.ComponentType.UNSIGNED_BYTE:D=I.getUint8(F);break;case te.ComponentType.SHORT:D=I.getInt16(F,!0);break;case te.ComponentType.BYTE:D=I.getInt8(F);break;default:throw new Error(`Unexpected componentType "${u.componentType}".`)}m[_*M+b]=D}return m}(t,e);const l=r.byteOffset+(t.byteOffset||0);return new s(r.buffer.slice(l,l+t.count*a*c))}var Vr;(function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Vr||(Vr={}));let ft=class{constructor(e,r,n){this.C=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.F=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.C=e,this.jsonDoc=r,this.options=n;const s=e.getRoot(),a=s.listBuffers().length,c=s.listTextures().length;this.bufferURIGenerator=new sa(a>1,()=>n.basename||"buffer"),this.imageURIGenerator=new sa(c>1,l=>function(u,d){const g=u.getGraph().listParentEdges(d).find(T=>T.getParent()!==u.getRoot());return g?g.getName().replace(/texture$/i,""):""}(e,l)||n.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,r){const n={magFilter:r.getMagFilter()||void 0,minFilter:r.getMinFilter()||void 0,wrapS:r.getWrapS(),wrapT:r.getWrapT()},s=JSON.stringify(n);this.samplerDefIndexMap.has(s)||(this.samplerDefIndexMap.set(s,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const a={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(s)},c=JSON.stringify(a);this.textureDefIndexMap.has(c)||(this.textureDefIndexMap.set(c,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(a));const l={index:this.textureDefIndexMap.get(c)};return r.getTexCoord()!==0&&(l.texCoord=r.getTexCoord()),Object.keys(r.getExtras()).length>0&&(l.extras=r.getExtras()),this.textureInfoDefMap.set(r,l),l}createPropertyDef(e){const r={};return e.getName()&&(r.name=e.getName()),Object.keys(e.getExtras()).length>0&&(r.extras=e.getExtras()),r}createAccessorDef(e){const r=this.createPropertyDef(e);return r.type=e.getType(),r.componentType=e.getComponentType(),r.count=e.getCount(),this.C.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(r.max=e.getMax([]).map(Math.fround),r.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(r.normalized=e.getNormalized()),r}createImageData(e,r,n){if(this.options.format===Kt.GLB)this.imageBufferViews.push(r),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:r.byteLength});else{const s=vt.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,s),this.jsonDoc.resources[e.uri]=r}}getAccessorUsage(e){const r=this.F.get(e);if(r)return r;if(e.getSparse())return rt.SPARSE;for(const n of this.C.getGraph().listParentEdges(e)){const{usage:s}=n.getAttributes();if(s)return s;n.getParent().propertyType!==W.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return rt.OTHER}addAccessorToUsageGroup(e,r){const n=this.F.get(e);if(n&&n!==r)throw new Error(`Accessor with usage "${n}" cannot be reused as "${r}".`);return this.F.set(e,r),this}listAccessorUsageGroups(){const e={};for(const[r,n]of Array.from(this.F.entries()))e[n]=e[n]||[],e[n].push(r);return e}};ft.BufferViewTarget=Vr,ft.BufferViewUsage=rt,ft.USAGE_TO_TARGET={[rt.ARRAY_BUFFER]:Vr.ARRAY_BUFFER,[rt.ELEMENT_ARRAY_BUFFER]:Vr.ELEMENT_ARRAY_BUFFER};let sa=class{constructor(e,r){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=r}createURI(e,r){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${r}`}return`${this.basename(e)}.${r}`}};const{BufferViewUsage:Tn}=ft,{UNSIGNED_INT:Fh,UNSIGNED_SHORT:Oh,UNSIGNED_BYTE:Dh}=te.ComponentType;let $h=class{static write(e,r){const n=e.getRoot(),s={asset:Ke({generator:`glTF-Transform ${Ca}`},n.getAsset()),extras:Ke({},n.getExtras())},a={json:s,resources:{}},c=new ft(e,a,r),l=r.logger||Jt.DEFAULT_INSTANCE,u=new Set(r.extensions.map(m=>m.EXTENSION_NAME)),d=e.getRoot().listExtensionsUsed().filter(m=>u.has(m.extensionName)),g=e.getRoot().listExtensionsRequired().filter(m=>u.has(m.extensionName));d.length<e.getRoot().listExtensionsUsed().length&&l.warn("Some extensions were not registered for I/O, and will not be written.");for(const m of d)for(const I of m.writeDependencies)m.install(I,r.dependencies[I]);function T(m,I,x,_){const b=[];let F=0;for(const V of m){const B=c.createAccessorDef(V);B.bufferView=s.bufferViews.length;const U=V.getArray(),z=oe.pad(oe.toView(U));B.byteOffset=F,F+=z.byteLength,b.push(z),c.accessorIndexMap.set(V,s.accessors.length),s.accessors.push(B)}const D={buffer:I,byteOffset:x,byteLength:oe.concat(b).byteLength};return _&&(D.target=_),s.bufferViews.push(D),{buffers:b,byteLength:F}}function E(m,I,x){const _=m[0].getCount();let b=0;for(const B of m){const U=c.createAccessorDef(B);U.bufferView=s.bufferViews.length,U.byteOffset=b;const z=B.getElementSize(),G=B.getComponentSize();b+=oe.padNumber(z*G),c.accessorIndexMap.set(B,s.accessors.length),s.accessors.push(U)}const F=_*b,D=new ArrayBuffer(F),V=new DataView(D);for(let B=0;B<_;B++){let U=0;for(const z of m){const G=z.getElementSize(),K=z.getComponentSize(),H=z.getComponentType(),k=z.getArray();for(let q=0;q<G;q++){const ue=B*b+U+q*K,re=k[B*G+q];switch(H){case te.ComponentType.FLOAT:V.setFloat32(ue,re,!0);break;case te.ComponentType.BYTE:V.setInt8(ue,re);break;case te.ComponentType.SHORT:V.setInt16(ue,re,!0);break;case te.ComponentType.UNSIGNED_BYTE:V.setUint8(ue,re);break;case te.ComponentType.UNSIGNED_SHORT:V.setUint16(ue,re,!0);break;case te.ComponentType.UNSIGNED_INT:V.setUint32(ue,re,!0);break;default:throw new Error("Unexpected component type: "+H)}}U+=oe.padNumber(G*K)}}return s.bufferViews.push({buffer:I,byteOffset:x,byteLength:F,byteStride:b,target:ft.BufferViewTarget.ARRAY_BUFFER}),{byteLength:F,buffers:[new Uint8Array(D)]}}function M(m,I,x){const _=[];let b=0;const F=new Map;let D=-1/0;for(const H of m){const k=c.createAccessorDef(H);s.accessors.push(k),c.accessorIndexMap.set(H,s.accessors.length-1);const q=[],ue=[],re=[],ve=new Array(H.getElementSize()).fill(0);for(let _e=0,ke=H.getCount();_e<ke;_e++)if(H.getElement(_e,re),!Ne.eq(re,ve,0)){D=Math.max(_e,D),q.push(_e);for(let be=0;be<re.length;be++)ue.push(re[be])}const ge=q.length,ye={accessorDef:k,count:ge};if(F.set(H,ye),ge===0)continue;if(ge>H.getCount()/3){const _e=(100*q.length/H.getCount()).toFixed(1);l.warn(`Sparse accessor with many non-zero elements (${_e}%) may increase file size.`)}const xe=An[H.getComponentType()];ye.indices=q,ye.values=new xe(ue)}if(!Number.isFinite(D))return{buffers:_,byteLength:b};const V=D<255?Uint8Array:D<65535?Uint16Array:Uint32Array,B=D<255?Dh:D<65535?Oh:Fh,U={buffer:I,byteOffset:x+b,byteLength:0};for(const H of m){const k=F.get(H);if(k.count===0)continue;k.indicesByteOffset=U.byteLength;const q=oe.pad(oe.toView(new V(k.indices)));_.push(q),b+=q.byteLength,U.byteLength+=q.byteLength}s.bufferViews.push(U);const z=s.bufferViews.length-1,G={buffer:I,byteOffset:x+b,byteLength:0};for(const H of m){const k=F.get(H);if(k.count===0)continue;k.valuesByteOffset=G.byteLength;const q=oe.pad(oe.toView(k.values));_.push(q),b+=q.byteLength,G.byteLength+=q.byteLength}s.bufferViews.push(G);const K=s.bufferViews.length-1;for(const H of m){const k=F.get(H);k.count!==0&&(k.accessorDef.sparse={count:k.count,indices:{bufferView:z,byteOffset:k.indicesByteOffset,componentType:B},values:{bufferView:K,byteOffset:k.valuesByteOffset}})}return{buffers:_,byteLength:b}}const A=new Map;for(const m of e.getGraph().listEdges()){if(m.getParent()===n)continue;const I=m.getChild();if(I instanceof te){const x=A.get(I)||[];x.push(m),A.set(I,x)}}if(s.accessors=[],s.bufferViews=[],s.samplers=[],s.textures=[],s.images=n.listTextures().map((m,I)=>{const x=c.createPropertyDef(m);m.getMimeType()&&(x.mimeType=m.getMimeType());const _=m.getImage();return _&&c.createImageData(x,_,m),c.imageIndexMap.set(m,I),x}),d.filter(m=>m.prewriteTypes.includes(W.ACCESSOR)).forEach(m=>m.prewrite(c,W.ACCESSOR)),n.listAccessors().forEach(m=>{const I=c.accessorUsageGroupedByParent,x=c.accessorParents;if(c.accessorIndexMap.has(m))return;const _=A.get(m)||[],b=c.getAccessorUsage(m);if(c.addAccessorToUsageGroup(m,b),I.has(b)){const F=_[0].getParent(),D=x.get(F)||new Set;D.add(m),x.set(F,D)}}),d.filter(m=>m.prewriteTypes.includes(W.BUFFER)).forEach(m=>m.prewrite(c,W.BUFFER)),(n.listAccessors().length>0||n.listTextures().length>0||c.otherBufferViews.size>0)&&n.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");s.buffers=[],n.listBuffers().forEach((m,I)=>{const x=c.createPropertyDef(m),_=c.accessorUsageGroupedByParent,b=c.accessorParents,F=m.listParents().filter(G=>G instanceof te),D=new Set(F),V=[],B=s.buffers.length;let U=0;const z=c.listAccessorUsageGroups();for(const G in z)if(_.has(G))for(const K of Array.from(b.values())){const H=Array.from(K).filter(k=>D.has(k)).filter(k=>c.getAccessorUsage(k)===G);if(H.length)if(G!==Tn.ARRAY_BUFFER||r.vertexLayout===bn.INTERLEAVED){const k=G===Tn.ARRAY_BUFFER?E(H,B,U):T(H,B,U);U+=k.byteLength,V.push(...k.buffers)}else for(const k of H){const q=E([k],B,U);U+=q.byteLength,V.push(...q.buffers)}}else{const K=z[G].filter(q=>D.has(q));if(!K.length)continue;const H=G===Tn.ELEMENT_ARRAY_BUFFER?ft.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,k=G===Tn.SPARSE?M(K,B,U):T(K,B,U,H);U+=k.byteLength,V.push(...k.buffers)}if(c.imageBufferViews.length&&I===0){for(let G=0;G<c.imageBufferViews.length;G++)if(s.bufferViews[s.images[G].bufferView].byteOffset=U,U+=c.imageBufferViews[G].byteLength,V.push(c.imageBufferViews[G]),U%8){const K=8-U%8;U+=K,V.push(new Uint8Array(K))}}if(c.otherBufferViews.has(m))for(const G of c.otherBufferViews.get(m))s.bufferViews.push({buffer:B,byteOffset:U,byteLength:G.byteLength}),c.otherBufferViewsIndexMap.set(G,s.bufferViews.length-1),U+=G.byteLength,V.push(G);if(U){let G;r.format===Kt.GLB?G=mr:(G=c.bufferURIGenerator.createURI(m,"bin"),x.uri=G),x.byteLength=U,a.resources[G]=oe.concat(V)}s.buffers.push(x),c.bufferIndexMap.set(m,I)}),n.listAccessors().find(m=>!m.getBuffer())&&l.warn("Skipped writing one or more Accessors: no Buffer assigned."),s.materials=n.listMaterials().map((m,I)=>{const x=c.createPropertyDef(m);if(m.getAlphaMode()!==yr.AlphaMode.OPAQUE&&(x.alphaMode=m.getAlphaMode()),m.getAlphaMode()===yr.AlphaMode.MASK&&(x.alphaCutoff=m.getAlphaCutoff()),m.getDoubleSided()&&(x.doubleSided=!0),x.pbrMetallicRoughness={},Ne.eq(m.getBaseColorFactor(),[1,1,1,1])||(x.pbrMetallicRoughness.baseColorFactor=m.getBaseColorFactor()),Ne.eq(m.getEmissiveFactor(),[0,0,0])||(x.emissiveFactor=m.getEmissiveFactor()),m.getRoughnessFactor()!==1&&(x.pbrMetallicRoughness.roughnessFactor=m.getRoughnessFactor()),m.getMetallicFactor()!==1&&(x.pbrMetallicRoughness.metallicFactor=m.getMetallicFactor()),m.getBaseColorTexture()){const _=m.getBaseColorTexture(),b=m.getBaseColorTextureInfo();x.pbrMetallicRoughness.baseColorTexture=c.createTextureInfoDef(_,b)}if(m.getEmissiveTexture()){const _=m.getEmissiveTexture(),b=m.getEmissiveTextureInfo();x.emissiveTexture=c.createTextureInfoDef(_,b)}if(m.getNormalTexture()){const _=m.getNormalTexture(),b=m.getNormalTextureInfo(),F=c.createTextureInfoDef(_,b);m.getNormalScale()!==1&&(F.scale=m.getNormalScale()),x.normalTexture=F}if(m.getOcclusionTexture()){const _=m.getOcclusionTexture(),b=m.getOcclusionTextureInfo(),F=c.createTextureInfoDef(_,b);m.getOcclusionStrength()!==1&&(F.strength=m.getOcclusionStrength()),x.occlusionTexture=F}if(m.getMetallicRoughnessTexture()){const _=m.getMetallicRoughnessTexture(),b=m.getMetallicRoughnessTextureInfo();x.pbrMetallicRoughness.metallicRoughnessTexture=c.createTextureInfoDef(_,b)}return c.materialIndexMap.set(m,I),x}),s.meshes=n.listMeshes().map((m,I)=>{const x=c.createPropertyDef(m);let _=null;return x.primitives=m.listPrimitives().map(b=>{const F={attributes:{}};F.mode=b.getMode();const D=b.getMaterial();D&&(F.material=c.materialIndexMap.get(D)),Object.keys(b.getExtras()).length&&(F.extras=b.getExtras());const V=b.getIndices();V&&(F.indices=c.accessorIndexMap.get(V));for(const B of b.listSemantics())F.attributes[B]=c.accessorIndexMap.get(b.getAttribute(B));for(const B of b.listTargets()){const U={};for(const z of B.listSemantics())U[z]=c.accessorIndexMap.get(B.getAttribute(z));F.targets=F.targets||[],F.targets.push(U)}return b.listTargets().length&&!_&&(_=b.listTargets().map(B=>B.getName())),F}),m.getWeights().length&&(x.weights=m.getWeights()),_&&(x.extras=x.extras||{},x.extras.targetNames=_),c.meshIndexMap.set(m,I),x}),s.cameras=n.listCameras().map((m,I)=>{const x=c.createPropertyDef(m);if(x.type=m.getType(),x.type===Kr.Type.PERSPECTIVE){x.perspective={znear:m.getZNear(),zfar:m.getZFar(),yfov:m.getYFov()};const _=m.getAspectRatio();_!==null&&(x.perspective.aspectRatio=_)}else x.orthographic={znear:m.getZNear(),zfar:m.getZFar(),xmag:m.getXMag(),ymag:m.getYMag()};return c.cameraIndexMap.set(m,I),x}),s.nodes=n.listNodes().map((m,I)=>{const x=c.createPropertyDef(m);return Ne.eq(m.getTranslation(),[0,0,0])||(x.translation=m.getTranslation()),Ne.eq(m.getRotation(),[0,0,0,1])||(x.rotation=m.getRotation()),Ne.eq(m.getScale(),[1,1,1])||(x.scale=m.getScale()),m.getWeights().length&&(x.weights=m.getWeights()),c.nodeIndexMap.set(m,I),x}),s.skins=n.listSkins().map((m,I)=>{const x=c.createPropertyDef(m),_=m.getInverseBindMatrices();_&&(x.inverseBindMatrices=c.accessorIndexMap.get(_));const b=m.getSkeleton();return b&&(x.skeleton=c.nodeIndexMap.get(b)),x.joints=m.listJoints().map(F=>c.nodeIndexMap.get(F)),c.skinIndexMap.set(m,I),x}),n.listNodes().forEach((m,I)=>{const x=s.nodes[I],_=m.getMesh();_&&(x.mesh=c.meshIndexMap.get(_));const b=m.getCamera();b&&(x.camera=c.cameraIndexMap.get(b));const F=m.getSkin();F&&(x.skin=c.skinIndexMap.get(F)),m.listChildren().length>0&&(x.children=m.listChildren().map(D=>c.nodeIndexMap.get(D)))}),s.animations=n.listAnimations().map((m,I)=>{const x=c.createPropertyDef(m),_=new Map;return x.samplers=m.listSamplers().map((b,F)=>{const D=c.createPropertyDef(b);return D.input=c.accessorIndexMap.get(b.getInput()),D.output=c.accessorIndexMap.get(b.getOutput()),D.interpolation=b.getInterpolation(),_.set(b,F),D}),x.channels=m.listChannels().map(b=>{const F=c.createPropertyDef(b);return F.sampler=_.get(b.getSampler()),F.target={node:c.nodeIndexMap.get(b.getTargetNode()),path:b.getTargetPath()},F}),c.animationIndexMap.set(m,I),x}),s.scenes=n.listScenes().map((m,I)=>{const x=c.createPropertyDef(m);return x.nodes=m.listChildren().map(_=>c.nodeIndexMap.get(_)),c.sceneIndexMap.set(m,I),x});const N=n.getDefaultScene();return N&&(s.scene=n.listScenes().indexOf(N)),s.extensionsUsed=d.map(m=>m.extensionName),s.extensionsRequired=g.map(m=>m.extensionName),d.forEach(m=>m.write(c)),function(m){const I=[];for(const x in m){const _=m[x];(Array.isArray(_)&&_.length===0||_===null||_===""||_&&typeof _=="object"&&Object.keys(_).length===0)&&I.push(x)}for(const x of I)delete m[x]}(s),a}};var In;(function(t){t[t.JSON=1313821514]="JSON",t[t.BIN=5130562]="BIN"})(In||(In={}));let Ph=class{constructor(){this.M=Jt.DEFAULT_INSTANCE,this.l=new Set,this.U={},this.P=bn.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const r of e)this.l.add(r),r.register();return this}registerDependencies(e){return Object.assign(this.U,e),this}setVertexLayout(e){return this.P=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const r=await this.readURI(e,"view");this.lastReadBytes=r.byteLength;const n=ia(r)?this.L(r):{json:JSON.parse(oe.decodeText(r)),resources:{}};return await this.j(n,this.dirname(e)),this.D(n),n}async readJSON(e){return e=this._(e),this.D(e),Nh.read(e,{extensions:Array.from(this.l),dependencies:this.U,logger:this.M})}async binaryToJSON(e){const r=this.L(oe.assertView(e));this.D(r);const n=r.json;if(n.buffers&&n.buffers.some(s=>function(a,c){return c.uri!==void 0&&!(c.uri in a.resources)}(r,s)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(s=>function(a,c){return c.uri!==void 0&&!(c.uri in a.resources)&&c.bufferView===void 0}(r,s)))throw new Error("Cannot resolve external images with binaryToJSON().");return r}async readBinary(e){return this.readJSON(await this.binaryToJSON(oe.assertView(e)))}async writeJSON(e,r={}){if(r.format===Kt.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return $h.write(e,{format:r.format||Kt.GLTF,basename:r.basename||"",logger:this.M,vertexLayout:this.P,dependencies:Ke({},this.U),extensions:Array.from(this.l)})}async writeBinary(e){const{json:r,resources:n}=await this.writeJSON(e,{format:Kt.GLB}),s=new Uint32Array([1179937895,2,12]),a=JSON.stringify(r),c=oe.pad(oe.encodeText(a),32),l=oe.toView(new Uint32Array([c.byteLength,1313821514])),u=oe.concat([l,c]);s[s.length-1]+=u.byteLength;const d=Object.values(n)[0];if(!d||!d.byteLength)return oe.concat([oe.toView(s),u]);const g=oe.pad(d,0),T=oe.toView(new Uint32Array([g.byteLength,5130562])),E=oe.concat([T,g]);return s[s.length-1]+=E.byteLength,oe.concat([oe.toView(s),u,E])}async j(e,r){var n=this;const s=[...e.json.images||[],...e.json.buffers||[]].map(async function(a){const c=a.uri;if(!c||c.match(/data:/))return Promise.resolve();e.resources[c]=await n.readURI(n.resolve(r,c),"view"),n.lastReadBytes+=e.resources[c].byteLength});await Promise.all(s)}D(e){function r(n){if(n.uri){if(n.uri in e.resources)oe.assertView(e.resources[n.uri]);else if(n.uri.match(/data:/)){const s=`__${bh()}.${vr.extension(n.uri)}`;e.resources[s]=oe.createBufferFromDataURI(n.uri),n.uri=s}}}(e.json.images||[]).forEach(n=>{if(n.bufferView===void 0&&n.uri===void 0)throw new Error("Missing resource URI or buffer view.");r(n)}),(e.json.buffers||[]).forEach(r)}_(e){const{images:r,buffers:n}=e.json;return e={json:Ke({},e.json),resources:Ke({},e.resources)},r&&(e.json.images=r.map(s=>Ke({},s))),n&&(e.json.buffers=n.map(s=>Ke({},s))),e}L(e){if(!ia(e))throw new Error("Invalid glTF 2.0 binary.");const r=new Uint32Array(e.buffer,e.byteOffset+12,2);if(r[1]!==In.JSON)throw new Error("Missing required GLB JSON chunk.");const n=r[0],s=oe.decodeText(oe.toView(e,20,n)),a=JSON.parse(s),c=20+n;if(e.byteLength<=c)return{json:a,resources:{}};const l=new Uint32Array(e.buffer,e.byteOffset+c,2);if(l[1]!==In.BIN)throw new Error("Expected GLB BIN in second chunk.");const u=oe.toView(e,c+8,l[0]);return{json:a,resources:{[mr]:u}}}};function ia(t){if(t.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(t.buffer,t.byteOffset,3);return e[0]===1179937895&&e[1]===2}let kh=class extends Ph{constructor(e=jr.DEFAULT_INIT){super(),this.J=void 0,this.J=e}async readURI(e,r){const n=await fetch(e,this.J);switch(r){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,r){return jr.resolve(e,r)}dirname(e){return jr.dirname(e)}};const Uh=0,Lh=0,Bh=0,jh=2,Vh=0,zh=163,Gh=166,qh=0,Hh=2,Wh=1,Xh=64,Yh=0;class Kh{constructor(){this.vkFormat=Yh,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=Uh,this.levels=[],this.dataFormatDescriptor=[{vendorId:Bh,descriptorType:Lh,descriptorBlockSize:0,versionNumber:jh,colorModel:Vh,colorPrimaries:Wh,transferFunction:Hh,flags:qh,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Cr{constructor(e,r,n,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+r,n),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),r=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*r;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const r=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,r}_skip(e){return this._offset+=e,this}_scan(e,r=0){const n=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==r&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,s)}}const Xe=[171,75,84,88,32,50,48,187,13,10,26,10];function aa(t){return typeof TextDecoder<"u"?new TextDecoder().decode(t):Buffer.from(t).toString("utf8")}function ds(t){const e=new Uint8Array(t.buffer,t.byteOffset,Xe.length);if(e[0]!==Xe[0]||e[1]!==Xe[1]||e[2]!==Xe[2]||e[3]!==Xe[3]||e[4]!==Xe[4]||e[5]!==Xe[5]||e[6]!==Xe[6]||e[7]!==Xe[7]||e[8]!==Xe[8]||e[9]!==Xe[9]||e[10]!==Xe[10]||e[11]!==Xe[11])throw new Error("Missing KTX 2.0 identifier.");const r=new Kh,n=17*Uint32Array.BYTES_PER_ELEMENT,s=new Cr(t,Xe.length,n,!0);r.vkFormat=s._nextUint32(),r.typeSize=s._nextUint32(),r.pixelWidth=s._nextUint32(),r.pixelHeight=s._nextUint32(),r.pixelDepth=s._nextUint32(),r.layerCount=s._nextUint32(),r.faceCount=s._nextUint32();const a=s._nextUint32();r.supercompressionScheme=s._nextUint32();const c=s._nextUint32(),l=s._nextUint32(),u=s._nextUint32(),d=s._nextUint32(),g=s._nextUint64(),T=s._nextUint64(),E=a*3*8,M=new Cr(t,Xe.length+n,E,!0);for(let ye=0;ye<a;ye++)r.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+M._nextUint64(),M._nextUint64()),uncompressedByteLength:M._nextUint64()});const A=new Cr(t,c,l,!0),N={vendorId:A._skip(4)._nextUint16(),descriptorType:A._nextUint16(),versionNumber:A._nextUint16(),descriptorBlockSize:A._nextUint16(),colorModel:A._nextUint8(),colorPrimaries:A._nextUint8(),transferFunction:A._nextUint8(),flags:A._nextUint8(),texelBlockDimension:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],bytesPlane:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],samples:[]},m=6,I=4,x=(N.descriptorBlockSize/4-m)/I;for(let ye=0;ye<x;ye++){const xe={bitOffset:A._nextUint16(),bitLength:A._nextUint8(),channelType:A._nextUint8(),samplePosition:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};xe.channelType&Xh?(xe.sampleLower=A._nextInt32(),xe.sampleUpper=A._nextInt32()):(xe.sampleLower=A._nextUint32(),xe.sampleUpper=A._nextUint32()),N.samples[ye]=xe}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(N);const _=new Cr(t,u,d,!0);for(;_._offset<d;){const ye=_._nextUint32(),xe=_._scan(ye),_e=aa(xe);if(r.keyValue[_e]=_._nextUint8Array(ye-xe.byteLength-1),_e.match(/^ktx/i)){const be=aa(r.keyValue[_e]);r.keyValue[_e]=be.substring(0,be.lastIndexOf("\0"))}const ke=ye%4?4-ye%4:0;_._skip(ke)}if(T<=0)return r;const b=new Cr(t,g,T,!0),F=b._nextUint16(),D=b._nextUint16(),V=b._nextUint32(),B=b._nextUint32(),U=b._nextUint32(),z=b._nextUint32(),G=[];for(let ye=0;ye<a;ye++)G.push({imageFlags:b._nextUint32(),rgbSliceByteOffset:b._nextUint32(),rgbSliceByteLength:b._nextUint32(),alphaSliceByteOffset:b._nextUint32(),alphaSliceByteLength:b._nextUint32()});const K=g+b._offset,H=K+V,k=H+B,q=k+U,ue=new Uint8Array(t.buffer,t.byteOffset+K,V),re=new Uint8Array(t.buffer,t.byteOffset+H,B),ve=new Uint8Array(t.buffer,t.byteOffset+k,U),ge=new Uint8Array(t.buffer,t.byteOffset+q,z);return r.globalData={endpointCount:F,selectorCount:D,imageDescs:G,endpointsData:ue,selectorsData:re,tablesData:ve,extendedData:ge},r}const js="EXT_mesh_gpu_instancing",Rs="EXT_meshopt_compression",Wa="KHR_draco_mesh_compression",Vs="KHR_lights_punctual",zs="KHR_materials_anisotropy",Gs="KHR_materials_clearcoat",qs="KHR_materials_emissive_strength",Hs="KHR_materials_ior",Ws="KHR_materials_iridescence",Xs="KHR_materials_pbrSpecularGlossiness",Ys="KHR_materials_sheen",Ks="KHR_materials_specular",Js="KHR_materials_transmission",Zs="KHR_materials_unlit",Qs="KHR_materials_volume",tr="KHR_materials_variants",ei="KHR_texture_transform",Cn="KHR_xmp_json_ld",bs="INSTANCE_ATTRIBUTE";class Xa extends $e{init(){this.extensionName=js,this.propertyType="InstancedMesh",this.parentTypes=[W.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:bs})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}Xa.EXTENSION_NAME=js;const $t=js;class Ya extends Se{constructor(...e){super(...e),this.extensionName=$t,this.provideTypes=[W.NODE],this.prewriteTypes=[W.ACCESSOR]}createInstancedMesh(){return new Xa(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((r,n)=>{if(!r.extensions||!r.extensions[$t])return;const s=r.extensions[$t],a=this.createInstancedMesh();for(const c in s.attributes)a.setAttribute(c,e.accessors[s.attributes[c]]);e.nodes[n].setExtension($t,a)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(bs);for(const r of this.properties)for(const n of r.listAttributes())e.addAccessorToUsageGroup(n,bs);return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const s=n.getExtension($t);if(s){const a=e.nodeIndexMap.get(n),c=r.json.nodes[a],l={attributes:{}};s.listSemantics().forEach(u=>{const d=s.getAttribute(u);l.attributes[u]=e.accessorIndexMap.get(d)}),c.extensions=c.extensions||{},c.extensions[$t]=l}}),this}}function Rt(){return Rt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Rt.apply(this,arguments)}var Wr,dr,De;Ya.EXTENSION_NAME=$t,function(t){t.QUANTIZE="quantize",t.FILTER="filter"}(Wr||(Wr={})),function(t){t.ATTRIBUTES="ATTRIBUTES",t.TRIANGLES="TRIANGLES",t.INDICES="INDICES"}(dr||(dr={})),function(t){t.NONE="NONE",t.OCTAHEDRAL="OCTAHEDRAL",t.QUATERNION="QUATERNION",t.EXPONENTIAL="EXPONENTIAL"}(De||(De={}));const{BYTE:Jh,SHORT:oa,FLOAT:Zh}=te.ComponentType,{encodeNormalizedInt:ca,decodeNormalizedInt:ps}=Ne;function Qh(t,e,r,n){const{filter:s,bits:a}=n,c={array:t.getArray(),byteStride:t.getElementSize()*t.getComponentSize(),componentType:t.getComponentType(),normalized:t.getNormalized()};if(r!==dr.ATTRIBUTES)return c;if(s!==De.NONE){let l=t.getNormalized()?function(u){const d=u.getComponentType(),g=u.getArray(),T=new Float32Array(g.length);for(let E=0;E<g.length;E++)T[E]=ps(g[E],d);return T}(t):new Float32Array(c.array);switch(s){case De.EXPONENTIAL:c.byteStride=4*t.getElementSize(),c.componentType=Zh,c.normalized=!1,c.array=e.encodeFilterExp(l,t.getCount(),c.byteStride,a);break;case De.OCTAHEDRAL:c.byteStride=a>8?8:4,c.componentType=a>8?oa:Jh,c.normalized=!0,l=t.getElementSize()===3?function(u){const d=new Float32Array(4*u.length/3);for(let g=0,T=u.length/3;g<T;g++)d[4*g]=u[3*g],d[4*g+1]=u[3*g+1],d[4*g+2]=u[3*g+2];return d}(l):l,c.array=e.encodeFilterOct(l,t.getCount(),c.byteStride,a);break;case De.QUATERNION:c.byteStride=8,c.componentType=oa,c.normalized=!0,c.array=e.encodeFilterQuat(l,t.getCount(),c.byteStride,a);break;default:throw new Error("Invalid filter.")}c.min=t.getMin([]),c.max=t.getMax([]),t.getNormalized()&&(c.min=c.min.map(u=>ps(u,t.getComponentType())),c.max=c.max.map(u=>ps(u,t.getComponentType()))),c.normalized&&(c.min=c.min.map(u=>ca(u,c.componentType)),c.max=c.max.map(u=>ca(u,c.componentType)))}else c.byteStride%4&&(c.array=function(l,u){const d=oe.padNumber(l.BYTES_PER_ELEMENT*u)/l.BYTES_PER_ELEMENT,g=new l.constructor(l.length/u*d);for(let T=0;T*u<l.length;T++)for(let E=0;E<u;E++)g[T*d+E]=l[T*u+E];return g}(c.array,t.getElementSize()),c.byteStride=c.array.byteLength/t.getCount());return c}function ed(t,e){return e===ft.BufferViewUsage.ELEMENT_ARRAY_BUFFER?t.listParents().some(r=>r instanceof Hr&&r.getMode()===Hr.Mode.TRIANGLES)?dr.TRIANGLES:dr.INDICES:dr.ATTRIBUTES}function td(t,e){const r=e.getGraph().listParentEdges(t).filter(n=>!(n.getParent()instanceof Ha));for(const n of r){const s=n.getName(),a=n.getAttributes().key||"",c=n.getParent().propertyType===W.PRIMITIVE_TARGET;if(s==="indices")return{filter:De.NONE};if(s==="attributes"){if(a==="POSITION")return{filter:De.NONE};if(a==="TEXCOORD_0")return{filter:De.NONE};if(a.startsWith("JOINTS_"))return{filter:De.NONE};if(a.startsWith("WEIGHTS_"))return{filter:De.NONE};if(a==="NORMAL"||a==="TANGENT")return c?{filter:De.NONE}:{filter:De.OCTAHEDRAL,bits:8}}if(s==="output"){const l=Ka(t);return l==="rotation"?{filter:De.QUATERNION,bits:16}:l==="translation"||l==="scale"?{filter:De.EXPONENTIAL,bits:12}:{filter:De.NONE}}if(s==="input")return{filter:De.NONE};if(s==="inverseBindMatrices")return{filter:De.NONE}}return{filter:De.NONE}}function Ka(t){for(const e of t.listParents())if(e instanceof Un){for(const r of e.listParents())if(r instanceof Ls)return r.getTargetPath()}return null}const Ye=Rs,la={method:Wr.QUANTIZE};class As extends Se{constructor(...e){super(...e),this.extensionName=Ye,this.prereadTypes=[W.BUFFER,W.PRIMITIVE],this.prewriteTypes=[W.BUFFER,W.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=la,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,r){return e==="meshopt.decoder"&&(this._decoder=r),e==="meshopt.encoder"&&(this._encoder=r),this}setEncoderOptions(e){return this._encoderOptions=Rt({},la,e),this}preread(e,r){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${Ye}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${Ye}]: Missing WASM support.`)}return r===W.BUFFER?this._prereadBuffers(e):r===W.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach((n,s)=>{if(!n.extensions||!n.extensions[Ye])return;const a=n.extensions[Ye],c=a.byteOffset||0,l=a.byteLength||0,u=a.count,d=a.byteStride,g=new Uint8Array(u*d),T=r.json.buffers[a.buffer],E=oe.toView(T.uri?r.resources[T.uri]:r.resources[mr],c,l);this._decoder.decodeGltfBuffer(g,u,d,E,a.mode,a.filter),e.bufferViews[s]=g})}_prereadPrimitives(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach(n=>{var s;n.extensions&&n.extensions[Ye]&&(s=r.json.buffers[n.buffer]).extensions&&s.extensions[Rs]&&s.extensions[Rs].fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[Ye].buffer])})}read(e){if(!this.isRequired())return this;for(const[r,n]of this._decoderFallbackBufferMap){for(const s of r.listParents())s instanceof te&&s.swap(r,n);r.dispose()}return this}prewrite(e,r){return r===W.ACCESSOR?this._prewriteAccessors(e):r===W.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const r=e.jsonDoc.json,n=this._encoder,s=this._encoderOptions,a=this.document.createBuffer(),c=this.document.getRoot().listBuffers().indexOf(a);this._encoderFallbackBuffer=a,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const l of this.document.getRoot().listAccessors()){if(Ka(l)==="weights"||l.getSparse())continue;const u=e.getAccessorUsage(l),d=ed(l,u),g=s.method===Wr.FILTER?td(l,this.document):{filter:De.NONE},T=Qh(l,n,d,g),{array:E,byteStride:M}=T,A=l.getBuffer();if(!A)throw new Error(`${Ye}: Missing buffer for accessor.`);const N=this.document.getRoot().listBuffers().indexOf(A),m=[u,d,g.filter,M,N].join(":");let I=this._encoderBufferViews[m],x=this._encoderBufferViewData[m],_=this._encoderBufferViewAccessors[m];I&&x||(_=this._encoderBufferViewAccessors[m]=[],x=this._encoderBufferViewData[m]=[],I=this._encoderBufferViews[m]={buffer:c,target:ft.USAGE_TO_TARGET[u],byteOffset:0,byteLength:0,byteStride:u===ft.BufferViewUsage.ARRAY_BUFFER?M:void 0,extensions:{[Ye]:{buffer:N,byteOffset:0,byteLength:0,mode:d,filter:g.filter!==De.NONE?g.filter:void 0,byteStride:M,count:0}}});const b=e.createAccessorDef(l);b.componentType=T.componentType,b.normalized=T.normalized,b.byteOffset=I.byteLength,b.min&&T.min&&(b.min=T.min),b.max&&T.max&&(b.max=T.max),e.accessorIndexMap.set(l,r.accessors.length),r.accessors.push(b),_.push(b),x.push(new Uint8Array(E.buffer,E.byteOffset,E.byteLength)),I.byteLength+=E.byteLength,I.extensions.EXT_meshopt_compression.count+=l.getCount()}}_prewriteBuffers(e){const r=this._encoder;for(const n in this._encoderBufferViews){const s=this._encoderBufferViews[n],a=this._encoderBufferViewData[n],c=this.document.getRoot().listBuffers()[s.extensions[Ye].buffer],l=e.otherBufferViews.get(c)||[],{count:u,byteStride:d,mode:g}=s.extensions[Ye],T=oe.concat(a),E=r.encodeGltfBuffer(T,u,d,g),M=oe.pad(E);s.extensions[Ye].byteLength=E.byteLength,a.length=0,a.push(M),l.push(M),e.otherBufferViews.set(c,l)}}write(e){let r=0;for(const c in this._encoderBufferViews){const l=this._encoderBufferViews[c],u=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[c][0]),d=this._encoderBufferViewAccessors[c];for(const E of d)E.bufferView=u;const g=e.jsonDoc.json.bufferViews[u],T=g.byteOffset||0;Object.assign(g,l),g.byteOffset=r,g.extensions[Ye].byteOffset=T,r+=oe.padNumber(l.byteLength)}const n=this._encoderFallbackBuffer,s=e.bufferIndexMap.get(n),a=e.jsonDoc.json.buffers[s];return a.byteLength=r,a.extensions={[Ye]:{fallback:!0}},n.dispose(),this}}As.EXTENSION_NAME=Ye,As.EncoderMethod=Wr;const kr="EXT_texture_avif";class rd{match(e){return e.length>=12&&oe.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const r=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=fa(r,0);if(!n)return null;let s=n.end;for(;n=fa(r,s);)if(n.type==="meta")s=n.start+4;else if(n.type==="iprp"||n.type==="ipco")s=n.start;else{if(n.type==="ispe")return[r.getUint32(n.start+4),r.getUint32(n.start+8)];if(n.type==="mdat")break;s=n.end}return null}getChannels(e){return 4}}class Ja extends Se{constructor(...e){super(...e),this.extensionName=kr,this.prereadTypes=[W.TEXTURE]}static register(){vt.registerFormat("image/avif",new rd)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[kr]&&(r.source=r.extensions[kr].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions[kr]={source:a.source},delete a.source)})}}),this}}function fa(t,e){if(t.byteLength<4+e)return null;const r=t.getUint32(e);return t.byteLength<r+e||r<8?null:{type:oe.decodeText(new Uint8Array(t.buffer,t.byteOffset+e+4,4)),start:e+8,end:e+r}}Ja.EXTENSION_NAME=kr;const Ur="EXT_texture_webp";class nd{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const r=oe.decodeText(e.slice(0,4)),n=oe.decodeText(e.slice(8,12));if(r!=="RIFF"||n!=="WEBP")return null;const s=new DataView(e.buffer,e.byteOffset);let a=12;for(;a<s.byteLength;){const c=oe.decodeText(new Uint8Array([s.getUint8(a),s.getUint8(a+1),s.getUint8(a+2),s.getUint8(a+3)])),l=s.getUint32(a+4,!0);if(c==="VP8 ")return[16383&s.getInt16(a+14,!0),16383&s.getInt16(a+16,!0)];if(c==="VP8L"){const u=s.getUint8(a+9),d=s.getUint8(a+10),g=s.getUint8(a+11);return[1+((63&d)<<8|u),1+((15&s.getUint8(a+12))<<10|g<<2|(192&d)>>6)]}a+=8+l+l%2}return null}getChannels(e){return 4}}class Za extends Se{constructor(...e){super(...e),this.extensionName=Ur,this.prereadTypes=[W.TEXTURE]}static register(){vt.registerFormat("image/webp",new nd)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[Ur]&&(r.source=r.extensions[Ur].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions[Ur]={source:a.source},delete a.source)})}}),this}}Za.EXTENSION_NAME=Ur;const ua=Wa;let Ue,Qa,eo,nt;function sd(t,e){const r=new Ue.DecoderBuffer;try{if(r.Init(e,e.length),t.GetEncodedGeometryType(r)!==Ue.TRIANGULAR_MESH)throw new Error(`[${ua}] Unknown geometry type.`);const n=new Ue.Mesh;if(!t.DecodeBufferToMesh(r,n).ok()||n.ptr===0)throw new Error(`[${ua}] Decoding failure.`);return n}finally{Ue.destroy(r)}}function id(t,e){const r=3*e.num_faces();let n,s;if(e.num_points()<=65534){const a=r*Uint16Array.BYTES_PER_ELEMENT;n=Ue._malloc(a),t.GetTrianglesUInt16Array(e,a,n),s=new Uint16Array(Ue.HEAPU16.buffer,n,r).slice()}else{const a=r*Uint32Array.BYTES_PER_ELEMENT;n=Ue._malloc(a),t.GetTrianglesUInt32Array(e,a,n),s=new Uint32Array(Ue.HEAPU32.buffer,n,r).slice()}return Ue._free(n),s}function ad(t,e,r,n){const s=eo[n.componentType],a=Qa[n.componentType],c=r.num_components(),l=e.num_points()*c,u=l*a.BYTES_PER_ELEMENT,d=Ue._malloc(u);t.GetAttributeDataArrayForAllPoints(e,r,s,u,d);const g=new a(Ue.HEAPF32.buffer,d,l).slice();return Ue._free(d),g}var Xr,st;(function(t){t[t.EDGEBREAKER=1]="EDGEBREAKER",t[t.SEQUENTIAL=0]="SEQUENTIAL"})(Xr||(Xr={})),function(t){t.POSITION="POSITION",t.NORMAL="NORMAL",t.COLOR="COLOR",t.TEX_COORD="TEX_COORD",t.GENERIC="GENERIC"}(st||(st={}));const to={[st.POSITION]:14,[st.NORMAL]:10,[st.COLOR]:8,[st.TEX_COORD]:12,[st.GENERIC]:12},ha={decodeSpeed:5,encodeSpeed:5,method:Xr.EDGEBREAKER,quantizationBits:to,quantizationVolume:"mesh"};function od(t,e=ha){const r=Rt({},ha,e);r.quantizationBits=Rt({},to,e.quantizationBits);const n=new nt.MeshBuilder,s=new nt.Mesh,a=new nt.ExpertEncoder(s),c={},l=new nt.DracoInt8Array,u=t.listTargets().length>0;let d=!1;for(const N of t.listSemantics()){const m=t.getAttribute(N);if(m.getSparse()){d=!0;continue}const I=cd(N),x=ld(n,m.getComponentType(),s,nt[I],m.getCount(),m.getElementSize(),m.getArray());if(x===-1)throw new Error(`Error compressing "${N}" attribute.`);if(c[N]=x,r.quantizationVolume==="mesh"||N!=="POSITION")a.SetAttributeQuantization(x,r.quantizationBits[I]);else{if(typeof r.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:_}=r,b=Math.max(_.max[0]-_.min[0],_.max[1]-_.min[1],_.max[2]-_.min[2]);a.SetAttributeExplicitQuantization(x,r.quantizationBits[I],m.getElementSize(),_.min,b)}}}const g=t.getIndices();if(!g)throw new Ss("Primitive must have indices.");n.AddFacesToMesh(s,g.getCount()/3,g.getArray()),a.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),a.SetTrackEncodedProperties(!0),a.SetEncodingMethod(r.method===Xr.SEQUENTIAL||u||d?nt.MESH_SEQUENTIAL_ENCODING:nt.MESH_EDGEBREAKER_ENCODING);const T=a.EncodeToDracoBuffer(!(u||d),l);if(T<=0)throw new Ss("Error applying Draco compression.");const E=new Uint8Array(T);for(let N=0;N<T;++N)E[N]=l.GetValue(N);const M=a.GetNumberOfEncodedPoints(),A=3*a.GetNumberOfEncodedFaces();return nt.destroy(l),nt.destroy(s),nt.destroy(n),nt.destroy(a),{numVertices:M,numIndices:A,data:E,attributeIDs:c}}function cd(t){return t==="POSITION"?st.POSITION:t==="NORMAL"?st.NORMAL:t.startsWith("COLOR_")?st.COLOR:t.startsWith("TEXCOORD_")?st.TEX_COORD:st.GENERIC}function ld(t,e,r,n,s,a,c){switch(e){case te.ComponentType.UNSIGNED_BYTE:return t.AddUInt8Attribute(r,n,s,a,c);case te.ComponentType.BYTE:return t.AddInt8Attribute(r,n,s,a,c);case te.ComponentType.UNSIGNED_SHORT:return t.AddUInt16Attribute(r,n,s,a,c);case te.ComponentType.SHORT:return t.AddInt16Attribute(r,n,s,a,c);case te.ComponentType.UNSIGNED_INT:return t.AddUInt32Attribute(r,n,s,a,c);case te.ComponentType.FLOAT:return t.AddFloatAttribute(r,n,s,a,c);default:throw new Error(`Unexpected component type, "${e}".`)}}class Ss extends Error{}const Oe=Wa;class Is extends Se{constructor(...e){super(...e),this.extensionName=Oe,this.prereadTypes=[W.PRIMITIVE],this.prewriteTypes=[W.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,r){return e==="draco3d.decoder"&&(this._decoderModule=r,Ue=this._decoderModule,Qa={[te.ComponentType.FLOAT]:Float32Array,[te.ComponentType.UNSIGNED_INT]:Uint32Array,[te.ComponentType.UNSIGNED_SHORT]:Uint16Array,[te.ComponentType.UNSIGNED_BYTE]:Uint8Array,[te.ComponentType.SHORT]:Int16Array,[te.ComponentType.BYTE]:Int8Array},eo={[te.ComponentType.FLOAT]:Ue.DT_FLOAT32,[te.ComponentType.UNSIGNED_INT]:Ue.DT_UINT32,[te.ComponentType.UNSIGNED_SHORT]:Ue.DT_UINT16,[te.ComponentType.UNSIGNED_BYTE]:Ue.DT_UINT8,[te.ComponentType.SHORT]:Ue.DT_INT16,[te.ComponentType.BYTE]:Ue.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=r,nt=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Oe}] Please install extension dependency, "draco3d.decoder".`);const r=this.document.getLogger(),n=e.jsonDoc,s=new Map;try{const a=n.json.meshes||[];for(const c of a)for(const l of c.primitives){if(!l.extensions||!l.extensions[Oe])continue;const u=l.extensions[Oe];let[d,g]=s.get(u.bufferView)||[];if(!g||!d){const T=n.json.bufferViews[u.bufferView],E=n.json.buffers[T.buffer],M=oe.toView(E.uri?n.resources[E.uri]:n.resources[mr],T.byteOffset||0,T.byteLength);d=new this._decoderModule.Decoder,g=sd(d,M),s.set(u.bufferView,[d,g]),r.debug(`[${Oe}] Decompressed ${M.byteLength} bytes.`)}for(const T in l.attributes){const E=e.jsonDoc.json.accessors[l.attributes[T]],M=d.GetAttributeByUniqueId(g,u.attributes[T]),A=ad(d,g,M,E);e.accessors[l.attributes[T]].setArray(A)}l.indices!==void 0&&e.accessors[l.indices].setArray(id(d,g))}}finally{for(const[a,c]of Array.from(s.values()))this._decoderModule.destroy(a),this._decoderModule.destroy(c)}return this}read(e){return this}prewrite(e,r){if(!this._encoderModule)throw new Error(`[${Oe}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Oe}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const s=function(l){const u=l.getLogger(),d=new Set,g=new Set;for(const m of l.getRoot().listMeshes())for(const I of m.listPrimitives())I.getIndices()?I.getMode()!==Hr.Mode.TRIANGLES?(g.add(I),u.warn(`[${Oe}] Skipping Draco compression on non-TRIANGLES primitive.`)):d.add(I):(g.add(I),u.warn(`[${Oe}] Skipping Draco compression on non-indexed primitive.`));const T=l.getRoot().listAccessors(),E=new Map;for(let m=0;m<T.length;m++)E.set(T[m],m);const M=new Map,A=new Set,N=new Map;for(const m of Array.from(d)){let I=da(m,E);if(A.has(I))N.set(m,I);else{if(M.has(m.getIndices())){const x=m.getIndices(),_=x.clone();E.set(_,l.getRoot().listAccessors().length-1),m.swap(x,_)}for(const x of m.listAttributes())if(M.has(x)){const _=x.clone();E.set(_,l.getRoot().listAccessors().length-1),m.swap(x,_)}I=da(m,E),A.add(I),N.set(m,I),M.set(m.getIndices(),I);for(const x of m.listAttributes())M.set(x,I)}}for(const m of Array.from(M.keys())){const I=new Set(m.listParents().map(x=>x.propertyType));if(I.size!==2||!I.has(W.PRIMITIVE)||!I.has(W.ROOT))throw new Error(`[${Oe}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const m of Array.from(d)){const I=N.get(m),x=m.getIndices();if(M.get(x)!==I||m.listAttributes().some(_=>M.get(_)!==I))throw new Error(`[${Oe}] Draco primitives must share all, or no, accessors.`)}for(const m of Array.from(g)){const I=m.getIndices();if(M.has(I)||m.listAttributes().some(x=>M.has(x)))throw new Error(`[${Oe}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return N}(this.document),a=new Map;let c="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${Oe}]: quantizationVolume=scene requires exactly 1 scene.`):c=yh(this.document.getRoot().listScenes().pop()));for(const l of Array.from(s.keys())){const u=s.get(l);if(!u)throw new Error("Unexpected primitive.");if(a.has(u)){a.set(u,a.get(u));continue}const d=l.getIndices(),g=e.jsonDoc.json.accessors;let T;try{T=od(l,Rt({},this._encoderOptions,{quantizationVolume:c}))}catch(A){if(A instanceof Ss){n.warn(`[${Oe}]: ${A.message} Skipping primitive compression.`);continue}throw A}a.set(u,T);const E=e.createAccessorDef(d);E.count=T.numIndices,e.accessorIndexMap.set(d,g.length),g.push(E);for(const A of l.listSemantics()){const N=l.getAttribute(A);if(T.attributeIDs[A]===void 0)continue;const m=e.createAccessorDef(N);m.count=T.numVertices,e.accessorIndexMap.set(N,g.length),g.push(m)}const M=l.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(M)||e.otherBufferViews.set(M,[]),e.otherBufferViews.get(M).push(T.data)}return n.debug(`[${Oe}] Compressed ${s.size} primitives.`),e.extensionData[Oe]={primitiveHashMap:s,primitiveEncodingMap:a},this}write(e){const r=e.extensionData[Oe];for(const n of this.document.getRoot().listMeshes()){const s=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let a=0;a<n.listPrimitives().length;a++){const c=n.listPrimitives()[a],l=s.primitives[a],u=r.primitiveHashMap.get(c);if(!u)continue;const d=r.primitiveEncodingMap.get(u);d&&(l.extensions=l.extensions||{},l.extensions[Oe]={bufferView:e.otherBufferViewsIndexMap.get(d.data),attributes:d.attributeIDs})}}if(!r.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(s=>s!==Oe),n.extensionsRequired=(n.extensionsRequired||[]).filter(s=>s!==Oe)}return this}}function da(t,e){const r=[],n=t.getIndices();r.push(e.get(n));for(const s of t.listAttributes())r.push(e.get(s));return r.sort().join("|")}Is.EXTENSION_NAME=Oe,Is.EncoderMethod=Xr;class xr extends $e{init(){this.extensionName=Vs,this.propertyType="Light",this.parentTypes=[W.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:xr.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Qe.factorToHex(this.getColor())}setColorHex(e){const r=this.getColor().slice();return Qe.hexToFactor(e,r),this.setColor(r)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}xr.EXTENSION_NAME=Vs,xr.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const pt=Vs;class ro extends Se{constructor(...e){super(...e),this.extensionName=pt}createLight(e=""){return new xr(this.document.getGraph(),e)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[pt])return this;const n=(r.json.extensions[pt].lights||[]).map(s=>{var a,c;const l=this.createLight().setName(s.name||"").setType(s.type);return s.color!==void 0&&l.setColor(s.color),s.intensity!==void 0&&l.setIntensity(s.intensity),s.range!==void 0&&l.setRange(s.range),((a=s.spot)==null?void 0:a.innerConeAngle)!==void 0&&l.setInnerConeAngle(s.spot.innerConeAngle),((c=s.spot)==null?void 0:c.outerConeAngle)!==void 0&&l.setOuterConeAngle(s.spot.outerConeAngle),l});return r.json.nodes.forEach((s,a)=>{s.extensions&&s.extensions[pt]&&e.nodes[a].setExtension(pt,n[s.extensions[pt].light])}),this}write(e){const r=e.jsonDoc;if(this.properties.size===0)return this;const n=[],s=new Map;for(const a of this.properties){const c=a,l={type:c.getType()};Ne.eq(c.getColor(),[1,1,1])||(l.color=c.getColor()),c.getIntensity()!==1&&(l.intensity=c.getIntensity()),c.getRange()!=null&&(l.range=c.getRange()),c.getName()&&(l.name=c.getName()),c.getType()===xr.Type.SPOT&&(l.spot={innerConeAngle:c.getInnerConeAngle(),outerConeAngle:c.getOuterConeAngle()}),n.push(l),s.set(c,n.length-1)}return this.document.getRoot().listNodes().forEach(a=>{const c=a.getExtension(pt);if(c){const l=e.nodeIndexMap.get(a),u=r.json.nodes[l];u.extensions=u.extensions||{},u.extensions[pt]={light:s.get(c)}}}),r.json.extensions=r.json.extensions||{},r.json.extensions[pt]={lights:n},this}}ro.EXTENSION_NAME=pt;const{R:fd,G:ud,B:hd}=ut;class no extends $e{init(){this.extensionName=zs,this.propertyType="Anisotropy",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new Fe(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:fd|ud|hd})}}no.EXTENSION_NAME=zs;const Pt=zs;class so extends Se{constructor(...e){super(...e),this.extensionName=Pt}createAnisotropy(){return new no(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Pt]){const c=this.createAnisotropy();e.materials[a].setExtension(Pt,c);const l=s.extensions[Pt];if(l.anisotropyStrength!==void 0&&c.setAnisotropyStrength(l.anisotropyStrength),l.anisotropyRotation!==void 0&&c.setAnisotropyRotation(l.anisotropyRotation),l.anisotropyTexture!==void 0){const u=l.anisotropyTexture;c.setAnisotropyTexture(e.textures[n[u.index].source]),e.setTextureInfo(c.getAnisotropyTextureInfo(),u)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Pt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const l=c.extensions[Pt]={};if(s.getAnisotropyStrength()>0&&(l.anisotropyStrength=s.getAnisotropyStrength()),s.getAnisotropyRotation()!==0&&(l.anisotropyRotation=s.getAnisotropyRotation()),s.getAnisotropyTexture()){const u=s.getAnisotropyTexture(),d=s.getAnisotropyTextureInfo();l.anisotropyTexture=e.createTextureInfoDef(u,d)}}}),this}}so.EXTENSION_NAME=Pt;const{R:pa,G:ga,B:dd}=ut;class io extends $e{init(){this.extensionName=Gs,this.propertyType="Clearcoat",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Fe(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Fe(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Fe(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:pa})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:ga})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:pa|ga|dd})}}io.EXTENSION_NAME=Gs;const kt=Gs;class ao extends Se{constructor(...e){super(...e),this.extensionName=kt}createClearcoat(){return new io(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[kt]){const c=this.createClearcoat();e.materials[a].setExtension(kt,c);const l=s.extensions[kt];if(l.clearcoatFactor!==void 0&&c.setClearcoatFactor(l.clearcoatFactor),l.clearcoatRoughnessFactor!==void 0&&c.setClearcoatRoughnessFactor(l.clearcoatRoughnessFactor),l.clearcoatTexture!==void 0){const u=l.clearcoatTexture;c.setClearcoatTexture(e.textures[n[u.index].source]),e.setTextureInfo(c.getClearcoatTextureInfo(),u)}if(l.clearcoatRoughnessTexture!==void 0){const u=l.clearcoatRoughnessTexture;c.setClearcoatRoughnessTexture(e.textures[n[u.index].source]),e.setTextureInfo(c.getClearcoatRoughnessTextureInfo(),u)}if(l.clearcoatNormalTexture!==void 0){const u=l.clearcoatNormalTexture;c.setClearcoatNormalTexture(e.textures[n[u.index].source]),e.setTextureInfo(c.getClearcoatNormalTextureInfo(),u),u.scale!==void 0&&c.setClearcoatNormalScale(u.scale)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(kt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const l=c.extensions[kt]={clearcoatFactor:s.getClearcoatFactor(),clearcoatRoughnessFactor:s.getClearcoatRoughnessFactor()};if(s.getClearcoatTexture()){const u=s.getClearcoatTexture(),d=s.getClearcoatTextureInfo();l.clearcoatTexture=e.createTextureInfoDef(u,d)}if(s.getClearcoatRoughnessTexture()){const u=s.getClearcoatRoughnessTexture(),d=s.getClearcoatRoughnessTextureInfo();l.clearcoatRoughnessTexture=e.createTextureInfoDef(u,d)}if(s.getClearcoatNormalTexture()){const u=s.getClearcoatNormalTexture(),d=s.getClearcoatNormalTextureInfo();l.clearcoatNormalTexture=e.createTextureInfoDef(u,d),s.getClearcoatNormalScale()!==1&&(l.clearcoatNormalTexture.scale=s.getClearcoatNormalScale())}}}),this}}ao.EXTENSION_NAME=kt;class oo extends $e{init(){this.extensionName=qs,this.propertyType="EmissiveStrength",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}oo.EXTENSION_NAME=qs;const Ut=qs;class co extends Se{constructor(...e){super(...e),this.extensionName=Ut}createEmissiveStrength(){return new oo(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{if(r.extensions&&r.extensions[Ut]){const s=this.createEmissiveStrength();e.materials[n].setExtension(Ut,s);const a=r.extensions[Ut];a.emissiveStrength!==void 0&&s.setEmissiveStrength(a.emissiveStrength)}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Ut);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{},c.extensions[Ut]={emissiveStrength:s.getEmissiveStrength()}}}),this}}co.EXTENSION_NAME=Ut;class lo extends $e{init(){this.extensionName=Hs,this.propertyType="IOR",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}lo.EXTENSION_NAME=Hs;const Lt=Hs;class fo extends Se{constructor(...e){super(...e),this.extensionName=Lt}createIOR(){return new lo(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{if(r.extensions&&r.extensions[Lt]){const s=this.createIOR();e.materials[n].setExtension(Lt,s);const a=r.extensions[Lt];a.ior!==void 0&&s.setIOR(a.ior)}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Lt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{},c.extensions[Lt]={ior:s.getIOR()}}}),this}}fo.EXTENSION_NAME=Lt;const{R:pd,G:gd}=ut;class uo extends $e{init(){this.extensionName=Ws,this.propertyType="Iridescence",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Fe(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Fe(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:pd})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:gd})}}uo.EXTENSION_NAME=Ws;const Bt=Ws;class ho extends Se{constructor(...e){super(...e),this.extensionName=Bt}createIridescence(){return new uo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Bt]){const c=this.createIridescence();e.materials[a].setExtension(Bt,c);const l=s.extensions[Bt];if(l.iridescenceFactor!==void 0&&c.setIridescenceFactor(l.iridescenceFactor),l.iridescenceIor!==void 0&&c.setIridescenceIOR(l.iridescenceIor),l.iridescenceThicknessMinimum!==void 0&&c.setIridescenceThicknessMinimum(l.iridescenceThicknessMinimum),l.iridescenceThicknessMaximum!==void 0&&c.setIridescenceThicknessMaximum(l.iridescenceThicknessMaximum),l.iridescenceTexture!==void 0){const u=l.iridescenceTexture;c.setIridescenceTexture(e.textures[n[u.index].source]),e.setTextureInfo(c.getIridescenceTextureInfo(),u)}if(l.iridescenceThicknessTexture!==void 0){const u=l.iridescenceThicknessTexture;c.setIridescenceThicknessTexture(e.textures[n[u.index].source]),e.setTextureInfo(c.getIridescenceThicknessTextureInfo(),u)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Bt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const l=c.extensions[Bt]={};if(s.getIridescenceFactor()>0&&(l.iridescenceFactor=s.getIridescenceFactor()),s.getIridescenceIOR()!==1.3&&(l.iridescenceIor=s.getIridescenceIOR()),s.getIridescenceThicknessMinimum()!==100&&(l.iridescenceThicknessMinimum=s.getIridescenceThicknessMinimum()),s.getIridescenceThicknessMaximum()!==400&&(l.iridescenceThicknessMaximum=s.getIridescenceThicknessMaximum()),s.getIridescenceTexture()){const u=s.getIridescenceTexture(),d=s.getIridescenceTextureInfo();l.iridescenceTexture=e.createTextureInfoDef(u,d)}if(s.getIridescenceThicknessTexture()){const u=s.getIridescenceThicknessTexture(),d=s.getIridescenceThicknessTextureInfo();l.iridescenceThicknessTexture=e.createTextureInfoDef(u,d)}}}),this}}ho.EXTENSION_NAME=Bt;const{R:ma,G:va,B:ya,A:xa}=ut;class po extends $e{init(){this.extensionName=Xs,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Fe(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Fe(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Qe.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const r=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Qe.hexToFactor(e,r))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:ma|va|ya|xa,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:ma|va|ya|xa})}}po.EXTENSION_NAME=Xs;const jt=Xs;class go extends Se{constructor(...e){super(...e),this.extensionName=jt}createPBRSpecularGlossiness(){return new po(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[jt]){const c=this.createPBRSpecularGlossiness();e.materials[a].setExtension(jt,c);const l=s.extensions[jt];if(l.diffuseFactor!==void 0&&c.setDiffuseFactor(l.diffuseFactor),l.specularFactor!==void 0&&c.setSpecularFactor(l.specularFactor),l.glossinessFactor!==void 0&&c.setGlossinessFactor(l.glossinessFactor),l.diffuseTexture!==void 0){const u=l.diffuseTexture;c.setDiffuseTexture(e.textures[n[u.index].source]),e.setTextureInfo(c.getDiffuseTextureInfo(),u)}if(l.specularGlossinessTexture!==void 0){const u=l.specularGlossinessTexture;c.setSpecularGlossinessTexture(e.textures[n[u.index].source]),e.setTextureInfo(c.getSpecularGlossinessTextureInfo(),u)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(jt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const l=c.extensions[jt]={diffuseFactor:s.getDiffuseFactor(),specularFactor:s.getSpecularFactor(),glossinessFactor:s.getGlossinessFactor()};if(s.getDiffuseTexture()){const u=s.getDiffuseTexture(),d=s.getDiffuseTextureInfo();l.diffuseTexture=e.createTextureInfoDef(u,d)}if(s.getSpecularGlossinessTexture()){const u=s.getSpecularGlossinessTexture(),d=s.getSpecularGlossinessTextureInfo();l.specularGlossinessTexture=e.createTextureInfoDef(u,d)}}}),this}}go.EXTENSION_NAME=jt;const{R:md,G:vd,B:yd,A:xd}=ut;class mo extends $e{init(){this.extensionName=Ys,this.propertyType="Sheen",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Fe(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Fe(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Qe.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const r=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Qe.hexToFactor(e,r))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:md|vd|yd,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:xd})}}mo.EXTENSION_NAME=Ys;const Vt=Ys;class vo extends Se{constructor(...e){super(...e),this.extensionName=Vt}createSheen(){return new mo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Vt]){const c=this.createSheen();e.materials[a].setExtension(Vt,c);const l=s.extensions[Vt];if(l.sheenColorFactor!==void 0&&c.setSheenColorFactor(l.sheenColorFactor),l.sheenRoughnessFactor!==void 0&&c.setSheenRoughnessFactor(l.sheenRoughnessFactor),l.sheenColorTexture!==void 0){const u=l.sheenColorTexture;c.setSheenColorTexture(e.textures[n[u.index].source]),e.setTextureInfo(c.getSheenColorTextureInfo(),u)}if(l.sheenRoughnessTexture!==void 0){const u=l.sheenRoughnessTexture;c.setSheenRoughnessTexture(e.textures[n[u.index].source]),e.setTextureInfo(c.getSheenRoughnessTextureInfo(),u)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Vt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const l=c.extensions[Vt]={sheenColorFactor:s.getSheenColorFactor(),sheenRoughnessFactor:s.getSheenRoughnessFactor()};if(s.getSheenColorTexture()){const u=s.getSheenColorTexture(),d=s.getSheenColorTextureInfo();l.sheenColorTexture=e.createTextureInfoDef(u,d)}if(s.getSheenRoughnessTexture()){const u=s.getSheenRoughnessTexture(),d=s.getSheenRoughnessTextureInfo();l.sheenRoughnessTexture=e.createTextureInfoDef(u,d)}}}),this}}vo.EXTENSION_NAME=Vt;const{R:Td,G:Ed,B:wd,A:Md}=ut;class yo extends $e{init(){this.extensionName=Ks,this.propertyType="Specular",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Fe(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Fe(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Qe.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const r=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Qe.hexToFactor(e,r))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:Md})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Td|Ed|wd,isColor:!0})}}yo.EXTENSION_NAME=Ks;const zt=Ks;class xo extends Se{constructor(...e){super(...e),this.extensionName=zt}createSpecular(){return new yo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[zt]){const c=this.createSpecular();e.materials[a].setExtension(zt,c);const l=s.extensions[zt];if(l.specularFactor!==void 0&&c.setSpecularFactor(l.specularFactor),l.specularColorFactor!==void 0&&c.setSpecularColorFactor(l.specularColorFactor),l.specularTexture!==void 0){const u=l.specularTexture;c.setSpecularTexture(e.textures[n[u.index].source]),e.setTextureInfo(c.getSpecularTextureInfo(),u)}if(l.specularColorTexture!==void 0){const u=l.specularColorTexture;c.setSpecularColorTexture(e.textures[n[u.index].source]),e.setTextureInfo(c.getSpecularColorTextureInfo(),u)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(zt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const l=c.extensions[zt]={};if(s.getSpecularFactor()!==1&&(l.specularFactor=s.getSpecularFactor()),Ne.eq(s.getSpecularColorFactor(),[1,1,1])||(l.specularColorFactor=s.getSpecularColorFactor()),s.getSpecularTexture()){const u=s.getSpecularTexture(),d=s.getSpecularTextureInfo();l.specularTexture=e.createTextureInfoDef(u,d)}if(s.getSpecularColorTexture()){const u=s.getSpecularColorTexture(),d=s.getSpecularColorTextureInfo();l.specularColorTexture=e.createTextureInfoDef(u,d)}}}),this}}xo.EXTENSION_NAME=zt;const{R:_d}=ut;class To extends $e{init(){this.extensionName=Js,this.propertyType="Transmission",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Fe(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:_d})}}To.EXTENSION_NAME=Js;const Gt=Js;class Eo extends Se{constructor(...e){super(...e),this.extensionName=Gt}createTransmission(){return new To(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Gt]){const c=this.createTransmission();e.materials[a].setExtension(Gt,c);const l=s.extensions[Gt];if(l.transmissionFactor!==void 0&&c.setTransmissionFactor(l.transmissionFactor),l.transmissionTexture!==void 0){const u=l.transmissionTexture;c.setTransmissionTexture(e.textures[n[u.index].source]),e.setTextureInfo(c.getTransmissionTextureInfo(),u)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Gt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const l=c.extensions[Gt]={transmissionFactor:s.getTransmissionFactor()};if(s.getTransmissionTexture()){const u=s.getTransmissionTexture(),d=s.getTransmissionTextureInfo();l.transmissionTexture=e.createTextureInfoDef(u,d)}}}),this}}Eo.EXTENSION_NAME=Gt;class wo extends $e{init(){this.extensionName=Zs,this.propertyType="Unlit",this.parentTypes=[W.MATERIAL]}}wo.EXTENSION_NAME=Zs;const fr=Zs;class ti extends Se{constructor(...e){super(...e),this.extensionName=fr}createUnlit(){return new wo(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{r.extensions&&r.extensions[fr]&&e.materials[n].setExtension(fr,this.createUnlit())}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(fr)){const s=e.materialIndexMap.get(n),a=r.json.materials[s];a.extensions=a.extensions||{},a.extensions[fr]={}}}),this}}ti.EXTENSION_NAME=fr;class Mo extends $e{init(){this.extensionName=tr,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}Mo.EXTENSION_NAME=tr;class _o extends $e{init(){this.extensionName=tr,this.propertyType="MappingList",this.parentTypes=[W.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}_o.EXTENSION_NAME=tr;class Cs extends $e{init(){this.extensionName=tr,this.propertyType="Variant",this.parentTypes=["MappingList"]}}Cs.EXTENSION_NAME=tr;const gt=tr;class Ro extends Se{constructor(...e){super(...e),this.extensionName=gt}createMappingList(){return new _o(this.document.getGraph())}createVariant(e=""){return new Cs(this.document.getGraph(),e)}createMapping(){return new Mo(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof Cs)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[gt])return this;const n=(r.json.extensions[gt].variants||[]).map(s=>this.createVariant().setName(s.name||""));return(r.json.meshes||[]).forEach((s,a)=>{const c=e.meshes[a];(s.primitives||[]).forEach((l,u)=>{if(!l.extensions||!l.extensions[gt])return;const d=this.createMappingList(),g=l.extensions[gt];for(const T of g.mappings){const E=this.createMapping();T.material!==void 0&&E.setMaterial(e.materials[T.material]);for(const M of T.variants||[])E.addVariant(n[M]);d.addMapping(E)}c.listPrimitives()[u].setExtension(gt,d)})}),this}write(e){const r=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const s=[],a=new Map;for(const c of n)a.set(c,s.length),s.push(e.createPropertyDef(c));for(const c of this.document.getRoot().listMeshes()){const l=e.meshIndexMap.get(c);c.listPrimitives().forEach((u,d)=>{const g=u.getExtension(gt);if(!g)return;const T=e.jsonDoc.json.meshes[l].primitives[d],E=g.listMappings().map(M=>{const A=e.createPropertyDef(M),N=M.getMaterial();return N&&(A.material=e.materialIndexMap.get(N)),A.variants=M.listVariants().map(m=>a.get(m)),A});T.extensions=T.extensions||{},T.extensions[gt]={mappings:E}})}return r.json.extensions=r.json.extensions||{},r.json.extensions[gt]={variants:s},this}}Ro.EXTENSION_NAME=gt;const{G:Rd}=ut;class bo extends $e{init(){this.extensionName=Qs,this.propertyType="Volume",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Fe(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Rd})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Qe.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const r=this.getAttenuationColor().slice();return this.set("attenuationColor",Qe.hexToFactor(e,r))}}bo.EXTENSION_NAME=Qs;const qt=Qs;class Ao extends Se{constructor(...e){super(...e),this.extensionName=qt}createVolume(){return new bo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[qt]){const c=this.createVolume();e.materials[a].setExtension(qt,c);const l=s.extensions[qt];if(l.thicknessFactor!==void 0&&c.setThicknessFactor(l.thicknessFactor),l.attenuationDistance!==void 0&&c.setAttenuationDistance(l.attenuationDistance),l.attenuationColor!==void 0&&c.setAttenuationColor(l.attenuationColor),l.thicknessTexture!==void 0){const u=l.thicknessTexture;c.setThicknessTexture(e.textures[n[u.index].source]),e.setTextureInfo(c.getThicknessTextureInfo(),u)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(qt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const l=c.extensions[qt]={};if(s.getThicknessFactor()>0&&(l.thicknessFactor=s.getThicknessFactor()),Number.isFinite(s.getAttenuationDistance())&&(l.attenuationDistance=s.getAttenuationDistance()),Ne.eq(s.getAttenuationColor(),[1,1,1])||(l.attenuationColor=s.getAttenuationColor()),s.getThicknessTexture()){const u=s.getThicknessTexture(),d=s.getThicknessTextureInfo();l.thicknessTexture=e.createTextureInfoDef(u,d)}}}),this}}Ao.EXTENSION_NAME=qt;const So="KHR_mesh_quantization";class Io extends Se{constructor(...e){super(...e),this.extensionName=So}read(e){return this}write(e){return this}}Io.EXTENSION_NAME=So;const Lr="KHR_texture_basisu";class bd{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const r=ds(e);return[r.pixelWidth,r.pixelHeight]}getChannels(e){const r=ds(e).dataFormatDescriptor[0];if(r.colorModel===zh)return r.samples.length===2&&(15&r.samples[1].channelType)==15?4:3;if(r.colorModel===Gh)return(15&r.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${r.colorModel}".`)}getVRAMByteLength(e){const r=ds(e),n=this.getChannels(e)>3;let s=0;for(let a=0;a<r.levels.length;a++){const c=r.levels[a];s+=c.uncompressedByteLength?c.uncompressedByteLength:Math.max(1,Math.floor(r.pixelWidth/Math.pow(2,a)))/4*(Math.max(1,Math.floor(r.pixelHeight/Math.pow(2,a)))/4)*(n?16:8)}return s}}class Co extends Se{constructor(...e){super(...e),this.extensionName=Lr,this.prereadTypes=[W.TEXTURE]}static register(){vt.registerFormat("image/ktx2",new bd)}preread(e){return e.jsonDoc.json.textures.forEach(r=>{r.extensions&&r.extensions[Lr]&&(r.source=r.extensions[Lr].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const s=e.imageIndexMap.get(n);r.json.textures.forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions[Lr]={source:a.source},delete a.source)})}}),this}}Co.EXTENSION_NAME=Lr;class No extends $e{init(){this.extensionName=ei,this.propertyType="Transform",this.parentTypes=[W.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}No.EXTENSION_NAME=ei;const Ht=ei;class Fo extends Se{constructor(...e){super(...e),this.extensionName=Ht}createTransform(){return new No(this.document.getGraph())}read(e){for(const[r,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[Ht])continue;const s=this.createTransform(),a=n.extensions[Ht];a.offset!==void 0&&s.setOffset(a.offset),a.rotation!==void 0&&s.setRotation(a.rotation),a.scale!==void 0&&s.setScale(a.scale),a.texCoord!==void 0&&s.setTexCoord(a.texCoord),r.setExtension(Ht,s)}return this}write(e){const r=Array.from(e.textureInfoDefMap.entries());for(const[n,s]of r){const a=n.getExtension(Ht);if(!a)continue;s.extensions=s.extensions||{};const c={},l=Ne.eq;l(a.getOffset(),[0,0])||(c.offset=a.getOffset()),a.getRotation()!==0&&(c.rotation=a.getRotation()),l(a.getScale(),[1,1])||(c.scale=a.getScale()),a.getTexCoord()!=null&&(c.texCoord=a.getTexCoord()),s.extensions[Ht]=c}return this}}Fo.EXTENSION_NAME=Ht;const Ad=[W.ROOT,W.SCENE,W.NODE,W.MESH,W.MATERIAL,W.TEXTURE,W.ANIMATION];class Oo extends $e{init(){this.extensionName=Cn,this.propertyType="Packet",this.parentTypes=Ad}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",Rt({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const r=this.get("properties");return e in r?r[e]:null}setProperty(e,r){this._assertContext(e);const n=Rt({},this.get("properties"));return r?n[e]=r:delete n[e],this.set("properties",n)}toJSONLD(){return Rt({"@context":gs(this.get("context"))},gs(this.get("properties")))}fromJSONLD(e){const r=(e=gs(e))["@context"];return r&&this.set("context",r),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${Cn}: Missing context for term, "${e}".`)}}function gs(t){return JSON.parse(JSON.stringify(t))}Oo.EXTENSION_NAME=Cn;const _t=Cn;class Do extends Se{constructor(...e){super(...e),this.extensionName=_t}createPacket(){return new Oo(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var r;const n=(r=e.jsonDoc.json.extensions)==null?void 0:r[_t];if(!n||!n.packets)return this;const s=e.jsonDoc.json,a=this.document.getRoot(),c=n.packets.map(d=>this.createPacket().fromJSONLD(d)),l=[[s.asset],s.scenes,s.nodes,s.meshes,s.materials,s.images,s.animations],u=[[a],a.listScenes(),a.listNodes(),a.listMeshes(),a.listMaterials(),a.listTextures(),a.listAnimations()];for(let d=0;d<l.length;d++){const g=l[d]||[];for(let T=0;T<g.length;T++){const E=g[T];E.extensions&&E.extensions[_t]&&u[d][T].setExtension(_t,c[E.extensions[_t].packet])}}return this}write(e){const{json:r}=e.jsonDoc,n=[];for(const s of this.properties){n.push(s.toJSONLD());for(const a of s.listParents()){let c;switch(a.propertyType){case W.ROOT:c=r.asset;break;case W.SCENE:c=r.scenes[e.sceneIndexMap.get(a)];break;case W.NODE:c=r.nodes[e.nodeIndexMap.get(a)];break;case W.MESH:c=r.meshes[e.meshIndexMap.get(a)];break;case W.MATERIAL:c=r.materials[e.materialIndexMap.get(a)];break;case W.TEXTURE:c=r.images[e.imageIndexMap.get(a)];break;case W.ANIMATION:c=r.animations[e.animationIndexMap.get(a)];break;default:c=null,this.document.getLogger().warn(`[${_t}]: Unsupported parent property, "${a.propertyType}"`)}c&&(c.extensions=c.extensions||{},c.extensions[_t]={packet:n.length-1})}}return n.length>0&&(r.extensions=r.extensions||{},r.extensions[_t]={packets:n}),this}}Do.EXTENSION_NAME=_t;const $o=[Is,ro,so,ao,co,fo,ho,go,xo,vo,Eo,ti,Ro,Ao,Io,Co,Fo,Do];[...$o];const Po=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ko=t=>{let e="";for(let r=0;r<16;r++)r%4!=3&&(r>0&&(e+=" "),e+=t[r]||0);return e},Sd=(t=1,e=Po)=>`    <item objectid="${t}" transform="${ko(e)}" />
`,Ta=t=>t?t.toISOString().substring(0,10):"";function Id(t,{unit:e="millimeter",title:r="jscad model",author:n="",description:s="",application:a="jscad",creationDate:c=new Date,license:l="",modificationDate:u}={}){t.push(`<?xml version="1.0" encoding="UTF-8"?>
<model unit="${e}" xml:lang="en-US" xmlns="http://schemas.microsoft.com/3dmanufacturing/core/2015/02" xmlns:slic3rpe="http://schemas.slic3r.org/3mf/2017/06">
  <metadata name="slic3rpe:Version3mf">1</metadata>
  <metadata name="Title">${r}</metadata>
  <metadata name="Designer">${n}</metadata>
  <metadata name="Description">${s||r}</metadata>
  <metadata name="Copyright"></metadata>
  <metadata name="LicenseTerms">${l}</metadata>
  <metadata name="Rating"></metadata>
  <metadata name="CreationDate">${Ta(c)}</metadata>
  <metadata name="ModificationDate">${Ta(u||c)}</metadata>
  <metadata name="Application">${a}</metadata>
   `)}function Cd(t,e,r,n){t.push(`<object id="${e}" type="model"${n==null?"":' name="'+n+'"'}>
`),t.push(` <components>
`),r.forEach(({objectID:s,transform:a})=>{Nd(t,s,a)}),t.push(` </components>
`),t.push(`</object>
`)}const Nd=(t,e=1,r=Po)=>{t.push(`    <component objectid="${e}" transform="${ko(r)}" />
`)};function Fd(t,e,r,n,s,a){t.push(`  <object id="${e}" type="model"${a?' name="'+a+'"':""}>
   <mesh>
    <vertices>
`);for(let c=0;c<r.length;c+=3)t.push(`     <vertex x="${r[c].toPrecision(s)}" y="${r[c+1].toPrecision(s)}" z="${r[c+2].toPrecision(s)}" />
`);t.push(`    </vertices>
    <triangles>
`);for(let c=0;c<n.length;c+=3)t.push(`     <triangle v1="${n[c]}" v2="${n[c+1]}" v3="${n[c+2]}" />
`);return t.push(`    </triangles>
   </mesh>
  </object>
`),t}const Ea={name:"[Content_Types].xml",content:`<?xml version="1.0" encoding="UTF-8"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml" />
<Default Extension="model" ContentType="application/vnd.ms-package.3dmanufacturing-3dmodel+xml" />
<Default Extension="png" ContentType="image/png" />
</Types>`};function Od({meshes:t=[],components:e=[],items:r=[],precision:n=17,header:s}){const a=[];return Id(a,s),a.push(`  <resources>
`),r.length==0&&console.error("3MF empty build! Include items or simple."),t.forEach(({id:c,vertices:l,indices:u,name:d})=>Fd(a,c,l,u,n,d)),e.forEach(({id:c,children:l,name:u})=>{Cd(a,c,l,u)}),a.push(`  </resources>
`),a.push(`<build>
`),r.forEach(({objectID:c,transform:l})=>{a.push(Sd(c,l))}),a.push(`</build>
`),a.push(`</model>
`),a.join("")}class Dd{constructor(){this.idSeq=0,this.lines=['<?xml version="1.0" encoding="UTF-8"?>','<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">']}get name(){return"_rels/.rels"}addRel(e,r){this.lines.push(`  <Relationship Target="${e}" Id="rel-${++this.idSeq}" Type="${r}" />`)}add3dModel(e){this.addRel(e,"http://schemas.microsoft.com/3dmanufacturing/2013/01/3dmodel")}addThumbnail(e){this.addRel(e,"http://schemas.openxmlformats.org/package/2006/relationships/metadata/thumbnail")}get content(){return this.lines.join(`
`)+`
</Relationships>`}}var ze=Uint8Array,tt=Uint16Array,ri=Int32Array,ni=new ze([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),si=new ze([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wa=new ze([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Uo=function(t,e){for(var r=new tt(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var s=new ri(r[30]),n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)s[a]=a-r[n]<<5|n;return{b:r,r:s}},Lo=Uo(ni,2),$d=Lo.b,Ns=Lo.r;$d[28]=258,Ns[258]=28;var Pd=Uo(si,0),Ma=Pd.r,Fs=new tt(32768);for(var Re=0;Re<32768;++Re){var At=(Re&43690)>>1|(Re&21845)<<1;At=(At&52428)>>2|(At&13107)<<2,At=(At&61680)>>4|(At&3855)<<4,Fs[Re]=((At&65280)>>8|(At&255)<<8)>>1}var zr=function(t,e,r){for(var n=t.length,s=0,a=new tt(e);s<n;++s)t[s]&&++a[t[s]-1];var c=new tt(e);for(s=1;s<e;++s)c[s]=c[s-1]+a[s-1]<<1;var l;if(r){l=new tt(1<<e);var u=15-e;for(s=0;s<n;++s)if(t[s])for(var d=s<<4|t[s],g=e-t[s],T=c[t[s]-1]++<<g,E=T|(1<<g)-1;T<=E;++T)l[Fs[T]>>u]=d}else for(l=new tt(n),s=0;s<n;++s)t[s]&&(l[s]=Fs[c[t[s]-1]++]>>15-t[s]);return l},Qt=new ze(288);for(var Re=0;Re<144;++Re)Qt[Re]=8;for(var Re=144;Re<256;++Re)Qt[Re]=9;for(var Re=256;Re<280;++Re)Qt[Re]=7;for(var Re=280;Re<288;++Re)Qt[Re]=8;var Nn=new ze(32);for(var Re=0;Re<32;++Re)Nn[Re]=5;var kd=zr(Qt,9,0),Ud=zr(Nn,5,0),Bo=function(t){return(t+7)/8|0},jo=function(t,e,r){return(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length),new ze(t.subarray(e,r))},Ld=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ln=function(t,e,r){var n=new Error(e||Ld[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,Ln),!r)throw n;return n},Mt=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8},Nr=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8,t[n+2]|=r>>16},ms=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var s=r.length,a=r.slice();if(!s)return{t:zo,l:0};if(s==1){var c=new ze(r[0].s+1);return c[r[0].s]=1,{t:c,l:1}}r.sort(function(F,D){return F.f-D.f}),r.push({s:-1,f:25001});var l=r[0],u=r[1],d=0,g=1,T=2;for(r[0]={s:-1,f:l.f+u.f,l,r:u};g!=s-1;)l=r[r[d].f<r[T].f?d++:T++],u=r[d!=g&&r[d].f<r[T].f?d++:T++],r[g++]={s:-1,f:l.f+u.f,l,r:u};for(var E=a[0].s,n=1;n<s;++n)a[n].s>E&&(E=a[n].s);var M=new tt(E+1),A=Os(r[g-1],M,0);if(A>e){var n=0,N=0,m=A-e,I=1<<m;for(a.sort(function(D,V){return M[V.s]-M[D.s]||D.f-V.f});n<s;++n){var x=a[n].s;if(M[x]>e)N+=I-(1<<A-M[x]),M[x]=e;else break}for(N>>=m;N>0;){var _=a[n].s;M[_]<e?N-=1<<e-M[_]++-1:++n}for(;n>=0&&N;--n){var b=a[n].s;M[b]==e&&(--M[b],++N)}A=e}return{t:new ze(M),l:A}},Os=function(t,e,r){return t.s==-1?Math.max(Os(t.l,e,r+1),Os(t.r,e,r+1)):e[t.s]=r},_a=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new tt(++e),n=0,s=t[0],a=1,c=function(u){r[n++]=u},l=1;l<=e;++l)if(t[l]==s&&l!=e)++a;else{if(!s&&a>2){for(;a>138;a-=138)c(32754);a>2&&(c(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(c(s),--a;a>6;a-=6)c(8304);a>2&&(c(a-3<<5|8208),a=0)}for(;a--;)c(s);a=1,s=t[l]}return{c:r.subarray(0,n),n:e}},Fr=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},Vo=function(t,e,r){var n=r.length,s=Bo(e+2);t[s]=n&255,t[s+1]=n>>8,t[s+2]=t[s]^255,t[s+3]=t[s+1]^255;for(var a=0;a<n;++a)t[s+a+4]=r[a];return(s+4+n)*8},Ra=function(t,e,r,n,s,a,c,l,u,d,g){Mt(e,g++,r),++s[256];for(var T=ms(s,15),E=T.t,M=T.l,A=ms(a,15),N=A.t,m=A.l,I=_a(E),x=I.c,_=I.n,b=_a(N),F=b.c,D=b.n,V=new tt(19),B=0;B<x.length;++B)++V[x[B]&31];for(var B=0;B<F.length;++B)++V[F[B]&31];for(var U=ms(V,7),z=U.t,G=U.l,K=19;K>4&&!z[wa[K-1]];--K);var H=d+5<<3,k=Fr(s,Qt)+Fr(a,Nn)+c,q=Fr(s,E)+Fr(a,N)+c+14+3*K+Fr(V,z)+2*V[16]+3*V[17]+7*V[18];if(u>=0&&H<=k&&H<=q)return Vo(e,g,t.subarray(u,u+d));var ue,re,ve,ge;if(Mt(e,g,1+(q<k)),g+=2,q<k){ue=zr(E,M,0),re=E,ve=zr(N,m,0),ge=N;var ye=zr(z,G,0);Mt(e,g,_-257),Mt(e,g+5,D-1),Mt(e,g+10,K-4),g+=14;for(var B=0;B<K;++B)Mt(e,g+3*B,z[wa[B]]);g+=3*K;for(var xe=[x,F],_e=0;_e<2;++_e)for(var ke=xe[_e],B=0;B<ke.length;++B){var be=ke[B]&31;Mt(e,g,ye[be]),g+=z[be],be>15&&(Mt(e,g,ke[B]>>5&127),g+=ke[B]>>12)}}else ue=kd,re=Qt,ve=Ud,ge=Nn;for(var B=0;B<l;++B){var Ie=n[B];if(Ie>255){var be=Ie>>18&31;Nr(e,g,ue[be+257]),g+=re[be+257],be>7&&(Mt(e,g,Ie>>23&31),g+=ni[be]);var et=Ie&31;Nr(e,g,ve[et]),g+=ge[et],et>3&&(Nr(e,g,Ie>>5&8191),g+=si[et])}else Nr(e,g,ue[Ie]),g+=re[Ie]}return Nr(e,g,ue[256]),g+re[256]},Bd=new ri([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),zo=new ze(0),jd=function(t,e,r,n,s,a){var c=a.z||t.length,l=new ze(n+c+5*(1+Math.ceil(c/7e3))+s),u=l.subarray(n,l.length-s),d=a.l,g=(a.r||0)&7;if(e){g&&(u[0]=a.r>>3);for(var T=Bd[e-1],E=T>>13,M=T&8191,A=(1<<r)-1,N=a.p||new tt(32768),m=a.h||new tt(A+1),I=Math.ceil(r/3),x=2*I,_=function(It){return(t[It]^t[It+1]<<I^t[It+2]<<x)&A},b=new ri(25e3),F=new tt(288),D=new tt(32),V=0,B=0,U=a.i||0,z=0,G=a.w||0,K=0;U+2<c;++U){var H=_(U),k=U&32767,q=m[H];if(N[k]=q,m[H]=k,G<=U){var ue=c-U;if((V>7e3||z>24576)&&(ue>423||!d)){g=Ra(t,u,0,b,F,D,B,z,K,U-K,g),z=V=B=0,K=U;for(var re=0;re<286;++re)F[re]=0;for(var re=0;re<30;++re)D[re]=0}var ve=2,ge=0,ye=M,xe=k-q&32767;if(ue>2&&H==_(U-xe))for(var _e=Math.min(E,ue)-1,ke=Math.min(32767,U),be=Math.min(258,ue);xe<=ke&&--ye&&k!=q;){if(t[U+ve]==t[U+ve-xe]){for(var Ie=0;Ie<be&&t[U+Ie]==t[U+Ie-xe];++Ie);if(Ie>ve){if(ve=Ie,ge=xe,Ie>_e)break;for(var et=Math.min(xe,Ie-2),at=0,re=0;re<et;++re){var Ze=U-xe+re&32767,Ee=N[Ze],St=Ze-Ee&32767;St>at&&(at=St,q=Ze)}}}k=q,q=N[k],xe+=k-q&32767}if(ge){b[z++]=268435456|Ns[ve]<<18|Ma[ge];var Ge=Ns[ve]&31,yt=Ma[ge]&31;B+=ni[Ge]+si[yt],++F[257+Ge],++D[yt],G=U+ve,++V}else b[z++]=t[U],++F[t[U]]}}for(U=Math.max(U,G);U<c;++U)b[z++]=t[U],++F[t[U]];g=Ra(t,u,d,b,F,D,B,z,K,U-K,g),d||(a.r=g&7|u[g/8|0]<<3,g-=7,a.h=m,a.p=N,a.i=U,a.w=G)}else{for(var U=a.w||0;U<c+d;U+=65535){var He=U+65535;He>=c&&(u[g/8|0]=d,He=c),g=Vo(u,g+1,t.subarray(U,He))}a.i=c}return jo(l,0,n+Bo(g)+s)},Vd=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var r=e,n=9;--n;)r=(r&1&&-306674912)^r>>>1;t[e]=r}return t}(),zd=function(){var t=-1;return{p:function(e){for(var r=t,n=0;n<e.length;++n)r=Vd[r&255^e[n]]^r>>>8;t=r},d:function(){return~t}}},Gd=function(t,e,r,n,s){if(!s&&(s={l:1},e.dictionary)){var a=e.dictionary.subarray(-32768),c=new ze(a.length+t.length);c.set(a),c.set(t,a.length),t=c,s.w=a.length}return jd(t,e.level==null?6:e.level,e.mem==null?s.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,r,n,s)},Go=function(t,e){var r={};for(var n in t)r[n]=t[n];for(var n in e)r[n]=e[n];return r},Ve=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8};function qd(t,e){return Gd(t,e||{},0,0)}var qo=function(t,e,r,n){for(var s in t){var a=t[s],c=e+s,l=n;Array.isArray(a)&&(l=Go(n,a[1]),a=a[0]),a instanceof ze?r[c]=[a,l]:(r[c+="/"]=[new ze(0),l],qo(a,c,r,n))}},ba=typeof TextEncoder<"u"&&new TextEncoder,Hd=typeof TextDecoder<"u"&&new TextDecoder,Wd=0;try{Hd.decode(zo,{stream:!0}),Wd=1}catch{}function Gr(t,e){if(e){for(var r=new ze(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}if(ba)return ba.encode(t);for(var s=t.length,a=new ze(t.length+(t.length>>1)),c=0,l=function(g){a[c++]=g},n=0;n<s;++n){if(c+5>a.length){var u=new ze(c+8+(s-n<<1));u.set(a),a=u}var d=t.charCodeAt(n);d<128||e?l(d):d<2048?(l(192|d>>6),l(128|d&63)):d>55295&&d<57344?(d=65536+(d&1047552)|t.charCodeAt(++n)&1023,l(240|d>>18),l(128|d>>12&63),l(128|d>>6&63),l(128|d&63)):(l(224|d>>12),l(128|d>>6&63),l(128|d&63))}return jo(a,0,c)}var Ds=function(t){var e=0;if(t)for(var r in t){var n=t[r].length;n>65535&&Ln(9),e+=n+4}return e},Aa=function(t,e,r,n,s,a,c,l){var u=n.length,d=r.extra,g=l&&l.length,T=Ds(d);Ve(t,e,c!=null?33639248:67324752),e+=4,c!=null&&(t[e++]=20,t[e++]=r.os),t[e]=20,e+=2,t[e++]=r.flag<<1|(a<0&&8),t[e++]=s&&8,t[e++]=r.compression&255,t[e++]=r.compression>>8;var E=new Date(r.mtime==null?Date.now():r.mtime),M=E.getFullYear()-1980;if((M<0||M>119)&&Ln(10),Ve(t,e,M<<25|E.getMonth()+1<<21|E.getDate()<<16|E.getHours()<<11|E.getMinutes()<<5|E.getSeconds()>>1),e+=4,a!=-1&&(Ve(t,e,r.crc),Ve(t,e+4,a<0?-a-2:a),Ve(t,e+8,r.size)),Ve(t,e+12,u),Ve(t,e+14,T),e+=16,c!=null&&(Ve(t,e,g),Ve(t,e+6,r.attrs),Ve(t,e+10,c),e+=14),t.set(n,e),e+=u,T)for(var A in d){var N=d[A],m=N.length;Ve(t,e,+A),Ve(t,e+2,m),t.set(N,e+4),e+=4+m}return g&&(t.set(l,e),e+=g),e},Xd=function(t,e,r,n,s){Ve(t,e,101010256),Ve(t,e+8,r),Ve(t,e+10,r),Ve(t,e+12,n),Ve(t,e+16,s)};function Yd(t,e){e||(e={});var r={},n=[];qo(t,"",r,e);var s=0,a=0;for(var c in r){var l=r[c],u=l[0],d=l[1],g=d.level==0?0:8,T=Gr(c),E=T.length,M=d.comment,A=M&&Gr(M),N=A&&A.length,m=Ds(d.extra);E>65535&&Ln(11);var I=g?qd(u,d):u,x=I.length,_=zd();_.p(u),n.push(Go(d,{size:u.length,crc:_.d(),c:I,f:T,m:A,u:E!=c.length||A&&M.length!=N,o:s,compression:g})),s+=30+E+m+x,a+=76+2*(E+m)+(N||0)+x}for(var b=new ze(a+22),F=s,D=a-s,V=0;V<n.length;++V){var T=n[V];Aa(b,T.o,T,T.f,T.u,T.c.length);var B=30+T.f.length+Ds(T.extra);b.set(T.c,T.o+B),Aa(b,s,T,T.f,T.u,T.c.length,T.o,T.m),s+=16+B+(T.m?T.m.length:0)}return Xd(b,s,n.length,D,F),b}var ee=1e-6,fe=typeof Float32Array<"u"?Float32Array:Array,lt=Math.random;function Ho(t){fe=t}var Kd=Math.PI/180;function Jd(t){return t*Kd}function Zd(t,e){return Math.abs(t-e)<=ee*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Qd=Object.freeze({__proto__:null,get ARRAY_TYPE(){return fe},EPSILON:ee,RANDOM:lt,equals:Zd,setMatrixArrayType:Ho,toRadian:Jd});function ep(){var t=new fe(4);return fe!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function tp(t){var e=new fe(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function rp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function np(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function sp(t,e,r,n){var s=new fe(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function ip(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function ap(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function op(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r*a-s*n;return c?(c=1/c,t[0]=a*c,t[1]=-n*c,t[2]=-s*c,t[3]=r*c,t):null}function cp(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function lp(t){return t[0]*t[3]-t[2]*t[1]}function Wo(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=r[0],u=r[1],d=r[2],g=r[3];return t[0]=n*l+a*u,t[1]=s*l+c*u,t[2]=n*d+a*g,t[3]=s*d+c*g,t}function fp(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=Math.sin(r),u=Math.cos(r);return t[0]=n*u+a*l,t[1]=s*u+c*l,t[2]=n*-l+a*u,t[3]=s*-l+c*u,t}function up(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=r[0],u=r[1];return t[0]=n*l,t[1]=s*l,t[2]=a*u,t[3]=c*u,t}function hp(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t}function dp(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function pp(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function gp(t){return Math.hypot(t[0],t[1],t[2],t[3])}function mp(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]}function vp(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Xo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function yp(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function xp(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=e[0],l=e[1],u=e[2],d=e[3];return Math.abs(r-c)<=ee*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-l)<=ee*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-u)<=ee*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(a-d)<=ee*Math.max(1,Math.abs(a),Math.abs(d))}function Tp(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Ep(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}var wp=Wo,Mp=Xo,_p=Object.freeze({__proto__:null,LDU:mp,add:vp,adjoint:cp,clone:tp,copy:rp,create:ep,determinant:lp,equals:xp,exactEquals:yp,frob:gp,fromRotation:hp,fromScaling:dp,fromValues:sp,identity:np,invert:op,mul:wp,multiply:Wo,multiplyScalar:Tp,multiplyScalarAndAdd:Ep,rotate:fp,scale:up,set:ip,str:pp,sub:Mp,subtract:Xo,transpose:ap});function Rp(){var t=new fe(6);return fe!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function bp(t){var e=new fe(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Ap(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Sp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Ip(t,e,r,n,s,a){var c=new fe(6);return c[0]=t,c[1]=e,c[2]=r,c[3]=n,c[4]=s,c[5]=a,c}function Cp(t,e,r,n,s,a,c){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t}function Np(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],l=e[5],u=r*a-n*s;return u?(u=1/u,t[0]=a*u,t[1]=-n*u,t[2]=-s*u,t[3]=r*u,t[4]=(s*l-a*c)*u,t[5]=(n*c-r*l)*u,t):null}function Fp(t){return t[0]*t[3]-t[1]*t[2]}function Yo(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=e[4],u=e[5],d=r[0],g=r[1],T=r[2],E=r[3],M=r[4],A=r[5];return t[0]=n*d+a*g,t[1]=s*d+c*g,t[2]=n*T+a*E,t[3]=s*T+c*E,t[4]=n*M+a*A+l,t[5]=s*M+c*A+u,t}function Op(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=e[4],u=e[5],d=Math.sin(r),g=Math.cos(r);return t[0]=n*g+a*d,t[1]=s*g+c*d,t[2]=n*-d+a*g,t[3]=s*-d+c*g,t[4]=l,t[5]=u,t}function Dp(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=e[4],u=e[5],d=r[0],g=r[1];return t[0]=n*d,t[1]=s*d,t[2]=a*g,t[3]=c*g,t[4]=l,t[5]=u,t}function $p(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=e[4],u=e[5],d=r[0],g=r[1];return t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=n*d+a*g+l,t[5]=s*d+c*g+u,t}function Pp(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t}function kp(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Up(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Lp(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Bp(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function jp(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function Ko(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function Vp(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function zp(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t}function Gp(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function qp(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],l=t[5],u=e[0],d=e[1],g=e[2],T=e[3],E=e[4],M=e[5];return Math.abs(r-u)<=ee*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-d)<=ee*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(s-g)<=ee*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(a-T)<=ee*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(c-E)<=ee*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(l-M)<=ee*Math.max(1,Math.abs(l),Math.abs(M))}var Hp=Yo,Wp=Ko,Xp=Object.freeze({__proto__:null,add:jp,clone:bp,copy:Ap,create:Rp,determinant:Fp,equals:qp,exactEquals:Gp,frob:Bp,fromRotation:Pp,fromScaling:kp,fromTranslation:Up,fromValues:Ip,identity:Sp,invert:Np,mul:Hp,multiply:Yo,multiplyScalar:Vp,multiplyScalarAndAdd:zp,rotate:Op,scale:Dp,set:Cp,str:Lp,sub:Wp,subtract:Ko,translate:$p});function Jo(){var t=new fe(9);return fe!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Yp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Kp(t){var e=new fe(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Jp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Zp(t,e,r,n,s,a,c,l,u){var d=new fe(9);return d[0]=t,d[1]=e,d[2]=r,d[3]=n,d[4]=s,d[5]=a,d[6]=c,d[7]=l,d[8]=u,d}function Qp(t,e,r,n,s,a,c,l,u,d){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t[6]=l,t[7]=u,t[8]=d,t}function eg(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function tg(t,e){if(t===e){var r=e[1],n=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function rg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],l=e[5],u=e[6],d=e[7],g=e[8],T=g*c-l*d,E=-g*a+l*u,M=d*a-c*u,A=r*T+n*E+s*M;return A?(A=1/A,t[0]=T*A,t[1]=(-g*n+s*d)*A,t[2]=(l*n-s*c)*A,t[3]=E*A,t[4]=(g*r-s*u)*A,t[5]=(-l*r+s*a)*A,t[6]=M*A,t[7]=(-d*r+n*u)*A,t[8]=(c*r-n*a)*A,t):null}function ng(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],l=e[5],u=e[6],d=e[7],g=e[8];return t[0]=c*g-l*d,t[1]=s*d-n*g,t[2]=n*l-s*c,t[3]=l*u-a*g,t[4]=r*g-s*u,t[5]=s*a-r*l,t[6]=a*d-c*u,t[7]=n*u-r*d,t[8]=r*c-n*a,t}function sg(t){var e=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],l=t[6],u=t[7],d=t[8];return e*(d*a-c*u)+r*(-d*s+c*l)+n*(u*s-a*l)}function Zo(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=e[4],u=e[5],d=e[6],g=e[7],T=e[8],E=r[0],M=r[1],A=r[2],N=r[3],m=r[4],I=r[5],x=r[6],_=r[7],b=r[8];return t[0]=E*n+M*c+A*d,t[1]=E*s+M*l+A*g,t[2]=E*a+M*u+A*T,t[3]=N*n+m*c+I*d,t[4]=N*s+m*l+I*g,t[5]=N*a+m*u+I*T,t[6]=x*n+_*c+b*d,t[7]=x*s+_*l+b*g,t[8]=x*a+_*u+b*T,t}function ig(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=e[4],u=e[5],d=e[6],g=e[7],T=e[8],E=r[0],M=r[1];return t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=l,t[5]=u,t[6]=E*n+M*c+d,t[7]=E*s+M*l+g,t[8]=E*a+M*u+T,t}function ag(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=e[4],u=e[5],d=e[6],g=e[7],T=e[8],E=Math.sin(r),M=Math.cos(r);return t[0]=M*n+E*c,t[1]=M*s+E*l,t[2]=M*a+E*u,t[3]=M*c-E*n,t[4]=M*l-E*s,t[5]=M*u-E*a,t[6]=d,t[7]=g,t[8]=T,t}function og(t,e,r){var n=r[0],s=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function cg(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function lg(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function fg(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function ug(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function hg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r+r,l=n+n,u=s+s,d=r*c,g=n*c,T=n*l,E=s*c,M=s*l,A=s*u,N=a*c,m=a*l,I=a*u;return t[0]=1-T-A,t[3]=g-I,t[6]=E+m,t[1]=g+I,t[4]=1-d-A,t[7]=M-N,t[2]=E-m,t[5]=M+N,t[8]=1-d-T,t}function dg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],l=e[5],u=e[6],d=e[7],g=e[8],T=e[9],E=e[10],M=e[11],A=e[12],N=e[13],m=e[14],I=e[15],x=r*l-n*c,_=r*u-s*c,b=r*d-a*c,F=n*u-s*l,D=n*d-a*l,V=s*d-a*u,B=g*N-T*A,U=g*m-E*A,z=g*I-M*A,G=T*m-E*N,K=T*I-M*N,H=E*I-M*m,k=x*H-_*K+b*G+F*z-D*U+V*B;return k?(k=1/k,t[0]=(l*H-u*K+d*G)*k,t[1]=(u*z-c*H-d*U)*k,t[2]=(c*K-l*z+d*B)*k,t[3]=(s*K-n*H-a*G)*k,t[4]=(r*H-s*z+a*U)*k,t[5]=(n*z-r*K-a*B)*k,t[6]=(N*V-m*D+I*F)*k,t[7]=(m*b-A*V-I*_)*k,t[8]=(A*D-N*b+I*x)*k,t):null}function pg(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function gg(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function mg(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function vg(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function Qo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function yg(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function xg(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function Tg(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Eg(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],l=t[5],u=t[6],d=t[7],g=t[8],T=e[0],E=e[1],M=e[2],A=e[3],N=e[4],m=e[5],I=e[6],x=e[7],_=e[8];return Math.abs(r-T)<=ee*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(n-E)<=ee*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(s-M)<=ee*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(a-A)<=ee*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(c-N)<=ee*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(l-m)<=ee*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(u-I)<=ee*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(d-x)<=ee*Math.max(1,Math.abs(d),Math.abs(x))&&Math.abs(g-_)<=ee*Math.max(1,Math.abs(g),Math.abs(_))}var wg=Zo,Mg=Qo,_g=Object.freeze({__proto__:null,add:vg,adjoint:ng,clone:Kp,copy:Jp,create:Jo,determinant:sg,equals:Eg,exactEquals:Tg,frob:mg,fromMat2d:ug,fromMat4:Yp,fromQuat:hg,fromRotation:lg,fromScaling:fg,fromTranslation:cg,fromValues:Zp,identity:eg,invert:rg,mul:wg,multiply:Zo,multiplyScalar:yg,multiplyScalarAndAdd:xg,normalFromMat4:dg,projection:pg,rotate:ag,scale:og,set:Qp,str:gg,sub:Mg,subtract:Qo,translate:ig,transpose:tg});function Rg(){var t=new fe(16);return fe!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function bg(t){var e=new fe(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ag(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Sg(t,e,r,n,s,a,c,l,u,d,g,T,E,M,A,N){var m=new fe(16);return m[0]=t,m[1]=e,m[2]=r,m[3]=n,m[4]=s,m[5]=a,m[6]=c,m[7]=l,m[8]=u,m[9]=d,m[10]=g,m[11]=T,m[12]=E,m[13]=M,m[14]=A,m[15]=N,m}function Ig(t,e,r,n,s,a,c,l,u,d,g,T,E,M,A,N,m){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t[6]=l,t[7]=u,t[8]=d,t[9]=g,t[10]=T,t[11]=E,t[12]=M,t[13]=A,t[14]=N,t[15]=m,t}function ec(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Cg(t,e){if(t===e){var r=e[1],n=e[2],s=e[3],a=e[6],c=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=s,t[13]=c,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Ng(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],l=e[5],u=e[6],d=e[7],g=e[8],T=e[9],E=e[10],M=e[11],A=e[12],N=e[13],m=e[14],I=e[15],x=r*l-n*c,_=r*u-s*c,b=r*d-a*c,F=n*u-s*l,D=n*d-a*l,V=s*d-a*u,B=g*N-T*A,U=g*m-E*A,z=g*I-M*A,G=T*m-E*N,K=T*I-M*N,H=E*I-M*m,k=x*H-_*K+b*G+F*z-D*U+V*B;return k?(k=1/k,t[0]=(l*H-u*K+d*G)*k,t[1]=(s*K-n*H-a*G)*k,t[2]=(N*V-m*D+I*F)*k,t[3]=(E*D-T*V-M*F)*k,t[4]=(u*z-c*H-d*U)*k,t[5]=(r*H-s*z+a*U)*k,t[6]=(m*b-A*V-I*_)*k,t[7]=(g*V-E*b+M*_)*k,t[8]=(c*K-l*z+d*B)*k,t[9]=(n*z-r*K-a*B)*k,t[10]=(A*D-N*b+I*x)*k,t[11]=(T*b-g*D-M*x)*k,t[12]=(l*U-c*G-u*B)*k,t[13]=(r*G-n*U+s*B)*k,t[14]=(N*_-A*F-m*x)*k,t[15]=(g*F-T*_+E*x)*k,t):null}function Fg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],l=e[5],u=e[6],d=e[7],g=e[8],T=e[9],E=e[10],M=e[11],A=e[12],N=e[13],m=e[14],I=e[15];return t[0]=l*(E*I-M*m)-T*(u*I-d*m)+N*(u*M-d*E),t[1]=-(n*(E*I-M*m)-T*(s*I-a*m)+N*(s*M-a*E)),t[2]=n*(u*I-d*m)-l*(s*I-a*m)+N*(s*d-a*u),t[3]=-(n*(u*M-d*E)-l*(s*M-a*E)+T*(s*d-a*u)),t[4]=-(c*(E*I-M*m)-g*(u*I-d*m)+A*(u*M-d*E)),t[5]=r*(E*I-M*m)-g*(s*I-a*m)+A*(s*M-a*E),t[6]=-(r*(u*I-d*m)-c*(s*I-a*m)+A*(s*d-a*u)),t[7]=r*(u*M-d*E)-c*(s*M-a*E)+g*(s*d-a*u),t[8]=c*(T*I-M*N)-g*(l*I-d*N)+A*(l*M-d*T),t[9]=-(r*(T*I-M*N)-g*(n*I-a*N)+A*(n*M-a*T)),t[10]=r*(l*I-d*N)-c*(n*I-a*N)+A*(n*d-a*l),t[11]=-(r*(l*M-d*T)-c*(n*M-a*T)+g*(n*d-a*l)),t[12]=-(c*(T*m-E*N)-g*(l*m-u*N)+A*(l*E-u*T)),t[13]=r*(T*m-E*N)-g*(n*m-s*N)+A*(n*E-s*T),t[14]=-(r*(l*m-u*N)-c*(n*m-s*N)+A*(n*u-s*l)),t[15]=r*(l*E-u*T)-c*(n*E-s*T)+g*(n*u-s*l),t}function Og(t){var e=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],l=t[6],u=t[7],d=t[8],g=t[9],T=t[10],E=t[11],M=t[12],A=t[13],N=t[14],m=t[15],I=e*c-r*a,x=e*l-n*a,_=e*u-s*a,b=r*l-n*c,F=r*u-s*c,D=n*u-s*l,V=d*A-g*M,B=d*N-T*M,U=d*m-E*M,z=g*N-T*A,G=g*m-E*A,K=T*m-E*N;return I*K-x*G+_*z+b*U-F*B+D*V}function tc(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=e[4],u=e[5],d=e[6],g=e[7],T=e[8],E=e[9],M=e[10],A=e[11],N=e[12],m=e[13],I=e[14],x=e[15],_=r[0],b=r[1],F=r[2],D=r[3];return t[0]=_*n+b*l+F*T+D*N,t[1]=_*s+b*u+F*E+D*m,t[2]=_*a+b*d+F*M+D*I,t[3]=_*c+b*g+F*A+D*x,_=r[4],b=r[5],F=r[6],D=r[7],t[4]=_*n+b*l+F*T+D*N,t[5]=_*s+b*u+F*E+D*m,t[6]=_*a+b*d+F*M+D*I,t[7]=_*c+b*g+F*A+D*x,_=r[8],b=r[9],F=r[10],D=r[11],t[8]=_*n+b*l+F*T+D*N,t[9]=_*s+b*u+F*E+D*m,t[10]=_*a+b*d+F*M+D*I,t[11]=_*c+b*g+F*A+D*x,_=r[12],b=r[13],F=r[14],D=r[15],t[12]=_*n+b*l+F*T+D*N,t[13]=_*s+b*u+F*E+D*m,t[14]=_*a+b*d+F*M+D*I,t[15]=_*c+b*g+F*A+D*x,t}function Dg(t,e,r){var n=r[0],s=r[1],a=r[2],c,l,u,d,g,T,E,M,A,N,m,I;return e===t?(t[12]=e[0]*n+e[4]*s+e[8]*a+e[12],t[13]=e[1]*n+e[5]*s+e[9]*a+e[13],t[14]=e[2]*n+e[6]*s+e[10]*a+e[14],t[15]=e[3]*n+e[7]*s+e[11]*a+e[15]):(c=e[0],l=e[1],u=e[2],d=e[3],g=e[4],T=e[5],E=e[6],M=e[7],A=e[8],N=e[9],m=e[10],I=e[11],t[0]=c,t[1]=l,t[2]=u,t[3]=d,t[4]=g,t[5]=T,t[6]=E,t[7]=M,t[8]=A,t[9]=N,t[10]=m,t[11]=I,t[12]=c*n+g*s+A*a+e[12],t[13]=l*n+T*s+N*a+e[13],t[14]=u*n+E*s+m*a+e[14],t[15]=d*n+M*s+I*a+e[15]),t}function $g(t,e,r){var n=r[0],s=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Pg(t,e,r,n){var s=n[0],a=n[1],c=n[2],l=Math.hypot(s,a,c),u,d,g,T,E,M,A,N,m,I,x,_,b,F,D,V,B,U,z,G,K,H,k,q;return l<ee?null:(l=1/l,s*=l,a*=l,c*=l,u=Math.sin(r),d=Math.cos(r),g=1-d,T=e[0],E=e[1],M=e[2],A=e[3],N=e[4],m=e[5],I=e[6],x=e[7],_=e[8],b=e[9],F=e[10],D=e[11],V=s*s*g+d,B=a*s*g+c*u,U=c*s*g-a*u,z=s*a*g-c*u,G=a*a*g+d,K=c*a*g+s*u,H=s*c*g+a*u,k=a*c*g-s*u,q=c*c*g+d,t[0]=T*V+N*B+_*U,t[1]=E*V+m*B+b*U,t[2]=M*V+I*B+F*U,t[3]=A*V+x*B+D*U,t[4]=T*z+N*G+_*K,t[5]=E*z+m*G+b*K,t[6]=M*z+I*G+F*K,t[7]=A*z+x*G+D*K,t[8]=T*H+N*k+_*q,t[9]=E*H+m*k+b*q,t[10]=M*H+I*k+F*q,t[11]=A*H+x*k+D*q,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function kg(t,e,r){var n=Math.sin(r),s=Math.cos(r),a=e[4],c=e[5],l=e[6],u=e[7],d=e[8],g=e[9],T=e[10],E=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*s+d*n,t[5]=c*s+g*n,t[6]=l*s+T*n,t[7]=u*s+E*n,t[8]=d*s-a*n,t[9]=g*s-c*n,t[10]=T*s-l*n,t[11]=E*s-u*n,t}function Ug(t,e,r){var n=Math.sin(r),s=Math.cos(r),a=e[0],c=e[1],l=e[2],u=e[3],d=e[8],g=e[9],T=e[10],E=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*s-d*n,t[1]=c*s-g*n,t[2]=l*s-T*n,t[3]=u*s-E*n,t[8]=a*n+d*s,t[9]=c*n+g*s,t[10]=l*n+T*s,t[11]=u*n+E*s,t}function Lg(t,e,r){var n=Math.sin(r),s=Math.cos(r),a=e[0],c=e[1],l=e[2],u=e[3],d=e[4],g=e[5],T=e[6],E=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*s+d*n,t[1]=c*s+g*n,t[2]=l*s+T*n,t[3]=u*s+E*n,t[4]=d*s-a*n,t[5]=g*s-c*n,t[6]=T*s-l*n,t[7]=E*s-u*n,t}function Bg(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function jg(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Vg(t,e,r){var n=r[0],s=r[1],a=r[2],c=Math.hypot(n,s,a),l,u,d;return c<ee?null:(c=1/c,n*=c,s*=c,a*=c,l=Math.sin(e),u=Math.cos(e),d=1-u,t[0]=n*n*d+u,t[1]=s*n*d+a*l,t[2]=a*n*d-s*l,t[3]=0,t[4]=n*s*d-a*l,t[5]=s*s*d+u,t[6]=a*s*d+n*l,t[7]=0,t[8]=n*a*d+s*l,t[9]=s*a*d-n*l,t[10]=a*a*d+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function zg(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Gg(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function qg(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function rc(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=n+n,u=s+s,d=a+a,g=n*l,T=n*u,E=n*d,M=s*u,A=s*d,N=a*d,m=c*l,I=c*u,x=c*d;return t[0]=1-(M+N),t[1]=T+x,t[2]=E-I,t[3]=0,t[4]=T-x,t[5]=1-(g+N),t[6]=A+m,t[7]=0,t[8]=E+I,t[9]=A-m,t[10]=1-(g+M),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Hg(t,e){var r=new fe(3),n=-e[0],s=-e[1],a=-e[2],c=e[3],l=e[4],u=e[5],d=e[6],g=e[7],T=n*n+s*s+a*a+c*c;return T>0?(r[0]=(l*c+g*n+u*a-d*s)*2/T,r[1]=(u*c+g*s+d*n-l*a)*2/T,r[2]=(d*c+g*a+l*s-u*n)*2/T):(r[0]=(l*c+g*n+u*a-d*s)*2,r[1]=(u*c+g*s+d*n-l*a)*2,r[2]=(d*c+g*a+l*s-u*n)*2),rc(t,e,r),t}function nc(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function sc(t,e){var r=e[0],n=e[1],s=e[2],a=e[4],c=e[5],l=e[6],u=e[8],d=e[9],g=e[10];return t[0]=Math.hypot(r,n,s),t[1]=Math.hypot(a,c,l),t[2]=Math.hypot(u,d,g),t}function ic(t,e){var r=new fe(3);sc(r,e);var n=1/r[0],s=1/r[1],a=1/r[2],c=e[0]*n,l=e[1]*s,u=e[2]*a,d=e[4]*n,g=e[5]*s,T=e[6]*a,E=e[8]*n,M=e[9]*s,A=e[10]*a,N=c+g+A,m=0;return N>0?(m=Math.sqrt(N+1)*2,t[3]=.25*m,t[0]=(T-M)/m,t[1]=(E-u)/m,t[2]=(l-d)/m):c>g&&c>A?(m=Math.sqrt(1+c-g-A)*2,t[3]=(T-M)/m,t[0]=.25*m,t[1]=(l+d)/m,t[2]=(E+u)/m):g>A?(m=Math.sqrt(1+g-c-A)*2,t[3]=(E-u)/m,t[0]=(l+d)/m,t[1]=.25*m,t[2]=(T+M)/m):(m=Math.sqrt(1+A-c-g)*2,t[3]=(l-d)/m,t[0]=(E+u)/m,t[1]=(T+M)/m,t[2]=.25*m),t}function Wg(t,e,r,n){var s=e[0],a=e[1],c=e[2],l=e[3],u=s+s,d=a+a,g=c+c,T=s*u,E=s*d,M=s*g,A=a*d,N=a*g,m=c*g,I=l*u,x=l*d,_=l*g,b=n[0],F=n[1],D=n[2];return t[0]=(1-(A+m))*b,t[1]=(E+_)*b,t[2]=(M-x)*b,t[3]=0,t[4]=(E-_)*F,t[5]=(1-(T+m))*F,t[6]=(N+I)*F,t[7]=0,t[8]=(M+x)*D,t[9]=(N-I)*D,t[10]=(1-(T+A))*D,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Xg(t,e,r,n,s){var a=e[0],c=e[1],l=e[2],u=e[3],d=a+a,g=c+c,T=l+l,E=a*d,M=a*g,A=a*T,N=c*g,m=c*T,I=l*T,x=u*d,_=u*g,b=u*T,F=n[0],D=n[1],V=n[2],B=s[0],U=s[1],z=s[2],G=(1-(N+I))*F,K=(M+b)*F,H=(A-_)*F,k=(M-b)*D,q=(1-(E+I))*D,ue=(m+x)*D,re=(A+_)*V,ve=(m-x)*V,ge=(1-(E+N))*V;return t[0]=G,t[1]=K,t[2]=H,t[3]=0,t[4]=k,t[5]=q,t[6]=ue,t[7]=0,t[8]=re,t[9]=ve,t[10]=ge,t[11]=0,t[12]=r[0]+B-(G*B+k*U+re*z),t[13]=r[1]+U-(K*B+q*U+ve*z),t[14]=r[2]+z-(H*B+ue*U+ge*z),t[15]=1,t}function Yg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r+r,l=n+n,u=s+s,d=r*c,g=n*c,T=n*l,E=s*c,M=s*l,A=s*u,N=a*c,m=a*l,I=a*u;return t[0]=1-T-A,t[1]=g+I,t[2]=E-m,t[3]=0,t[4]=g-I,t[5]=1-d-A,t[6]=M+N,t[7]=0,t[8]=E+m,t[9]=M-N,t[10]=1-d-T,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Kg(t,e,r,n,s,a,c){var l=1/(r-e),u=1/(s-n),d=1/(a-c);return t[0]=a*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*u,t[6]=0,t[7]=0,t[8]=(r+e)*l,t[9]=(s+n)*u,t[10]=(c+a)*d,t[11]=-1,t[12]=0,t[13]=0,t[14]=c*a*2*d,t[15]=0,t}function ac(t,e,r,n,s){var a=1/Math.tan(e/2),c;return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(c=1/(n-s),t[10]=(s+n)*c,t[14]=2*s*n*c):(t[10]=-1,t[14]=-2*n),t}var Jg=ac;function Zg(t,e,r,n,s){var a=1/Math.tan(e/2),c;return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(c=1/(n-s),t[10]=s*c,t[14]=s*n*c):(t[10]=-1,t[14]=-n),t}function Qg(t,e,r,n){var s=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),c=Math.tan(e.leftDegrees*Math.PI/180),l=Math.tan(e.rightDegrees*Math.PI/180),u=2/(c+l),d=2/(s+a);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=-((c-l)*u*.5),t[9]=(s-a)*d*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function oc(t,e,r,n,s,a,c){var l=1/(e-r),u=1/(n-s),d=1/(a-c);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*d,t[11]=0,t[12]=(e+r)*l,t[13]=(s+n)*u,t[14]=(c+a)*d,t[15]=1,t}var e1=oc;function t1(t,e,r,n,s,a,c){var l=1/(e-r),u=1/(n-s),d=1/(a-c);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=d,t[11]=0,t[12]=(e+r)*l,t[13]=(s+n)*u,t[14]=a*d,t[15]=1,t}function r1(t,e,r,n){var s,a,c,l,u,d,g,T,E,M,A=e[0],N=e[1],m=e[2],I=n[0],x=n[1],_=n[2],b=r[0],F=r[1],D=r[2];return Math.abs(A-b)<ee&&Math.abs(N-F)<ee&&Math.abs(m-D)<ee?ec(t):(g=A-b,T=N-F,E=m-D,M=1/Math.hypot(g,T,E),g*=M,T*=M,E*=M,s=x*E-_*T,a=_*g-I*E,c=I*T-x*g,M=Math.hypot(s,a,c),M?(M=1/M,s*=M,a*=M,c*=M):(s=0,a=0,c=0),l=T*c-E*a,u=E*s-g*c,d=g*a-T*s,M=Math.hypot(l,u,d),M?(M=1/M,l*=M,u*=M,d*=M):(l=0,u=0,d=0),t[0]=s,t[1]=l,t[2]=g,t[3]=0,t[4]=a,t[5]=u,t[6]=T,t[7]=0,t[8]=c,t[9]=d,t[10]=E,t[11]=0,t[12]=-(s*A+a*N+c*m),t[13]=-(l*A+u*N+d*m),t[14]=-(g*A+T*N+E*m),t[15]=1,t)}function n1(t,e,r,n){var s=e[0],a=e[1],c=e[2],l=n[0],u=n[1],d=n[2],g=s-r[0],T=a-r[1],E=c-r[2],M=g*g+T*T+E*E;M>0&&(M=1/Math.sqrt(M),g*=M,T*=M,E*=M);var A=u*E-d*T,N=d*g-l*E,m=l*T-u*g;return M=A*A+N*N+m*m,M>0&&(M=1/Math.sqrt(M),A*=M,N*=M,m*=M),t[0]=A,t[1]=N,t[2]=m,t[3]=0,t[4]=T*m-E*N,t[5]=E*A-g*m,t[6]=g*N-T*A,t[7]=0,t[8]=g,t[9]=T,t[10]=E,t[11]=0,t[12]=s,t[13]=a,t[14]=c,t[15]=1,t}function s1(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function i1(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function a1(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function cc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function o1(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function c1(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function l1(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function f1(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],l=t[5],u=t[6],d=t[7],g=t[8],T=t[9],E=t[10],M=t[11],A=t[12],N=t[13],m=t[14],I=t[15],x=e[0],_=e[1],b=e[2],F=e[3],D=e[4],V=e[5],B=e[6],U=e[7],z=e[8],G=e[9],K=e[10],H=e[11],k=e[12],q=e[13],ue=e[14],re=e[15];return Math.abs(r-x)<=ee*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(n-_)<=ee*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(s-b)<=ee*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-F)<=ee*Math.max(1,Math.abs(a),Math.abs(F))&&Math.abs(c-D)<=ee*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(l-V)<=ee*Math.max(1,Math.abs(l),Math.abs(V))&&Math.abs(u-B)<=ee*Math.max(1,Math.abs(u),Math.abs(B))&&Math.abs(d-U)<=ee*Math.max(1,Math.abs(d),Math.abs(U))&&Math.abs(g-z)<=ee*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(T-G)<=ee*Math.max(1,Math.abs(T),Math.abs(G))&&Math.abs(E-K)<=ee*Math.max(1,Math.abs(E),Math.abs(K))&&Math.abs(M-H)<=ee*Math.max(1,Math.abs(M),Math.abs(H))&&Math.abs(A-k)<=ee*Math.max(1,Math.abs(A),Math.abs(k))&&Math.abs(N-q)<=ee*Math.max(1,Math.abs(N),Math.abs(q))&&Math.abs(m-ue)<=ee*Math.max(1,Math.abs(m),Math.abs(ue))&&Math.abs(I-re)<=ee*Math.max(1,Math.abs(I),Math.abs(re))}var u1=tc,h1=cc,d1=Object.freeze({__proto__:null,add:a1,adjoint:Fg,clone:bg,copy:Ag,create:Rg,determinant:Og,equals:f1,exactEquals:l1,frob:i1,fromQuat:Yg,fromQuat2:Hg,fromRotation:Vg,fromRotationTranslation:rc,fromRotationTranslationScale:Wg,fromRotationTranslationScaleOrigin:Xg,fromScaling:jg,fromTranslation:Bg,fromValues:Sg,fromXRotation:zg,fromYRotation:Gg,fromZRotation:qg,frustum:Kg,getRotation:ic,getScaling:sc,getTranslation:nc,identity:ec,invert:Ng,lookAt:r1,mul:u1,multiply:tc,multiplyScalar:o1,multiplyScalarAndAdd:c1,ortho:e1,orthoNO:oc,orthoZO:t1,perspective:Jg,perspectiveFromFieldOfView:Qg,perspectiveNO:ac,perspectiveZO:Zg,rotate:Pg,rotateX:kg,rotateY:Ug,rotateZ:Lg,scale:$g,set:Ig,str:s1,sub:h1,subtract:cc,targetTo:n1,translate:Dg,transpose:Cg});function ii(){var t=new fe(3);return fe!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function p1(t){var e=new fe(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function lc(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function $s(t,e,r){var n=new fe(3);return n[0]=t,n[1]=e,n[2]=r,n}function g1(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function m1(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function v1(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function fc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function uc(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function hc(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function y1(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function x1(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function T1(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function E1(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function w1(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function M1(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function _1(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function dc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return Math.hypot(r,n,s)}function pc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return r*r+n*n+s*s}function gc(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function R1(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function b1(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function mc(t,e){var r=e[0],n=e[1],s=e[2],a=r*r+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function ai(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function wn(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[0],l=r[1],u=r[2];return t[0]=s*u-a*l,t[1]=a*c-n*u,t[2]=n*l-s*c,t}function A1(t,e,r,n){var s=e[0],a=e[1],c=e[2];return t[0]=s+n*(r[0]-s),t[1]=a+n*(r[1]-a),t[2]=c+n*(r[2]-c),t}function S1(t,e,r,n,s,a){var c=a*a,l=c*(2*a-3)+1,u=c*(a-2)+a,d=c*(a-1),g=c*(3-2*a);return t[0]=e[0]*l+r[0]*u+n[0]*d+s[0]*g,t[1]=e[1]*l+r[1]*u+n[1]*d+s[1]*g,t[2]=e[2]*l+r[2]*u+n[2]*d+s[2]*g,t}function I1(t,e,r,n,s,a){var c=1-a,l=c*c,u=a*a,d=l*c,g=3*a*l,T=3*u*c,E=u*a;return t[0]=e[0]*d+r[0]*g+n[0]*T+s[0]*E,t[1]=e[1]*d+r[1]*g+n[1]*T+s[1]*E,t[2]=e[2]*d+r[2]*g+n[2]*T+s[2]*E,t}function C1(t,e){e=e||1;var r=lt()*2*Math.PI,n=lt()*2-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*s,t[1]=Math.sin(r)*s,t[2]=n*e,t}function N1(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[3]*n+r[7]*s+r[11]*a+r[15];return c=c||1,t[0]=(r[0]*n+r[4]*s+r[8]*a+r[12])/c,t[1]=(r[1]*n+r[5]*s+r[9]*a+r[13])/c,t[2]=(r[2]*n+r[6]*s+r[10]*a+r[14])/c,t}function F1(t,e,r){var n=e[0],s=e[1],a=e[2];return t[0]=n*r[0]+s*r[3]+a*r[6],t[1]=n*r[1]+s*r[4]+a*r[7],t[2]=n*r[2]+s*r[5]+a*r[8],t}function O1(t,e,r){var n=r[0],s=r[1],a=r[2],c=r[3],l=e[0],u=e[1],d=e[2],g=s*d-a*u,T=a*l-n*d,E=n*u-s*l,M=s*E-a*T,A=a*g-n*E,N=n*T-s*g,m=c*2;return g*=m,T*=m,E*=m,M*=2,A*=2,N*=2,t[0]=l+g+M,t[1]=u+T+A,t[2]=d+E+N,t}function D1(t,e,r,n){var s=[],a=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],a[0]=s[0],a[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),a[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function $1(t,e,r,n){var s=[],a=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],a[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),a[1]=s[1],a[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function P1(t,e,r,n){var s=[],a=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],a[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),a[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),a[2]=s[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function k1(t,e){var r=t[0],n=t[1],s=t[2],a=e[0],c=e[1],l=e[2],u=Math.sqrt(r*r+n*n+s*s),d=Math.sqrt(a*a+c*c+l*l),g=u*d,T=g&&ai(t,e)/g;return Math.acos(Math.min(Math.max(T,-1),1))}function U1(t){return t[0]=0,t[1]=0,t[2]=0,t}function L1(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function B1(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function j1(t,e){var r=t[0],n=t[1],s=t[2],a=e[0],c=e[1],l=e[2];return Math.abs(r-a)<=ee*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-c)<=ee*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-l)<=ee*Math.max(1,Math.abs(s),Math.abs(l))}var V1=fc,z1=uc,G1=hc,q1=dc,H1=pc,vc=lc,W1=gc,X1=function(){var t=ii();return function(e,r,n,s,a,c){var l,u;for(r||(r=3),n||(n=0),s?u=Math.min(s*r+n,e.length):u=e.length,l=n;l<u;l+=r)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],a(t,t,c),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}}(),Y1=Object.freeze({__proto__:null,add:v1,angle:k1,bezier:I1,ceil:y1,clone:p1,copy:g1,create:ii,cross:wn,dist:q1,distance:dc,div:G1,divide:hc,dot:ai,equals:j1,exactEquals:B1,floor:x1,forEach:X1,fromValues:$s,hermite:S1,inverse:b1,len:vc,length:lc,lerp:A1,max:E1,min:T1,mul:z1,multiply:uc,negate:R1,normalize:mc,random:C1,rotateX:D1,rotateY:$1,rotateZ:P1,round:w1,scale:M1,scaleAndAdd:_1,set:m1,sqrDist:H1,sqrLen:W1,squaredDistance:pc,squaredLength:gc,str:L1,sub:V1,subtract:fc,transformMat3:F1,transformMat4:N1,transformQuat:O1,zero:U1});function yc(){var t=new fe(4);return fe!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function xc(t){var e=new fe(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Tc(t,e,r,n){var s=new fe(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function Ec(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function wc(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function Mc(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function _c(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Rc(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function bc(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function K1(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function J1(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Z1(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function Q1(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function e0(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Ac(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function t0(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function Sc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],a=e[3]-t[3];return Math.hypot(r,n,s,a)}function Ic(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],a=e[3]-t[3];return r*r+n*n+s*s+a*a}function oi(t){var e=t[0],r=t[1],n=t[2],s=t[3];return Math.hypot(e,r,n,s)}function ci(t){var e=t[0],r=t[1],n=t[2],s=t[3];return e*e+r*r+n*n+s*s}function r0(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function n0(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Cc(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r*r+n*n+s*s+a*a;return c>0&&(c=1/Math.sqrt(c)),t[0]=r*c,t[1]=n*c,t[2]=s*c,t[3]=a*c,t}function Nc(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function s0(t,e,r,n){var s=r[0]*n[1]-r[1]*n[0],a=r[0]*n[2]-r[2]*n[0],c=r[0]*n[3]-r[3]*n[0],l=r[1]*n[2]-r[2]*n[1],u=r[1]*n[3]-r[3]*n[1],d=r[2]*n[3]-r[3]*n[2],g=e[0],T=e[1],E=e[2],M=e[3];return t[0]=T*d-E*u+M*l,t[1]=-(g*d)+E*c-M*a,t[2]=g*u-T*c+M*s,t[3]=-(g*l)+T*a-E*s,t}function Fc(t,e,r,n){var s=e[0],a=e[1],c=e[2],l=e[3];return t[0]=s+n*(r[0]-s),t[1]=a+n*(r[1]-a),t[2]=c+n*(r[2]-c),t[3]=l+n*(r[3]-l),t}function i0(t,e){e=e||1;var r,n,s,a,c,l;do r=lt()*2-1,n=lt()*2-1,c=r*r+n*n;while(c>=1);do s=lt()*2-1,a=lt()*2-1,l=s*s+a*a;while(l>=1);var u=Math.sqrt((1-c)/l);return t[0]=e*r,t[1]=e*n,t[2]=e*s*u,t[3]=e*a*u,t}function a0(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3];return t[0]=r[0]*n+r[4]*s+r[8]*a+r[12]*c,t[1]=r[1]*n+r[5]*s+r[9]*a+r[13]*c,t[2]=r[2]*n+r[6]*s+r[10]*a+r[14]*c,t[3]=r[3]*n+r[7]*s+r[11]*a+r[15]*c,t}function o0(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[0],l=r[1],u=r[2],d=r[3],g=d*n+l*a-u*s,T=d*s+u*n-c*a,E=d*a+c*s-l*n,M=-c*n-l*s-u*a;return t[0]=g*d+M*-c+T*-u-E*-l,t[1]=T*d+M*-l+E*-c-g*-u,t[2]=E*d+M*-u+g*-l-T*-c,t[3]=e[3],t}function c0(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function l0(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Oc(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Dc(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=e[0],l=e[1],u=e[2],d=e[3];return Math.abs(r-c)<=ee*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-l)<=ee*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-u)<=ee*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(a-d)<=ee*Math.max(1,Math.abs(a),Math.abs(d))}var f0=_c,u0=Rc,h0=bc,d0=Sc,p0=Ic,g0=oi,m0=ci,v0=function(){var t=yc();return function(e,r,n,s,a,c){var l,u;for(r||(r=4),n||(n=0),s?u=Math.min(s*r+n,e.length):u=e.length,l=n;l<u;l+=r)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],a(t,t,c),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}}(),y0=Object.freeze({__proto__:null,add:Mc,ceil:K1,clone:xc,copy:Ec,create:yc,cross:s0,dist:d0,distance:Sc,div:h0,divide:bc,dot:Nc,equals:Dc,exactEquals:Oc,floor:J1,forEach:v0,fromValues:Tc,inverse:n0,len:g0,length:oi,lerp:Fc,max:Q1,min:Z1,mul:u0,multiply:Rc,negate:r0,normalize:Cc,random:i0,round:e0,scale:Ac,scaleAndAdd:t0,set:wc,sqrDist:p0,sqrLen:m0,squaredDistance:Ic,squaredLength:ci,str:l0,sub:f0,subtract:_c,transformMat4:a0,transformQuat:o0,zero:c0});function Fn(){var t=new fe(4);return fe!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function x0(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function $c(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function T0(t,e){var r=Math.acos(e[3])*2,n=Math.sin(r/2);return n>ee?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function E0(t,e){var r=fi(t,e);return Math.acos(2*r*r-1)}function Pc(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=r[0],u=r[1],d=r[2],g=r[3];return t[0]=n*g+c*l+s*d-a*u,t[1]=s*g+c*u+a*l-n*d,t[2]=a*g+c*d+n*u-s*l,t[3]=c*g-n*l-s*u-a*d,t}function kc(t,e,r){r*=.5;var n=e[0],s=e[1],a=e[2],c=e[3],l=Math.sin(r),u=Math.cos(r);return t[0]=n*u+c*l,t[1]=s*u+a*l,t[2]=a*u-s*l,t[3]=c*u-n*l,t}function Uc(t,e,r){r*=.5;var n=e[0],s=e[1],a=e[2],c=e[3],l=Math.sin(r),u=Math.cos(r);return t[0]=n*u-a*l,t[1]=s*u+c*l,t[2]=a*u+n*l,t[3]=c*u-s*l,t}function Lc(t,e,r){r*=.5;var n=e[0],s=e[1],a=e[2],c=e[3],l=Math.sin(r),u=Math.cos(r);return t[0]=n*u+s*l,t[1]=s*u-n*l,t[2]=a*u+c*l,t[3]=c*u-a*l,t}function w0(t,e){var r=e[0],n=e[1],s=e[2];return t[0]=r,t[1]=n,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s)),t}function Bc(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sqrt(r*r+n*n+s*s),l=Math.exp(a),u=c>0?l*Math.sin(c)/c:0;return t[0]=r*u,t[1]=n*u,t[2]=s*u,t[3]=l*Math.cos(c),t}function jc(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sqrt(r*r+n*n+s*s),l=c>0?Math.atan2(c,a)/c:0;return t[0]=r*l,t[1]=n*l,t[2]=s*l,t[3]=.5*Math.log(r*r+n*n+s*s+a*a),t}function M0(t,e,r){return jc(t,e),zc(t,t,r),Bc(t,t),t}function Mn(t,e,r,n){var s=e[0],a=e[1],c=e[2],l=e[3],u=r[0],d=r[1],g=r[2],T=r[3],E,M,A,N,m;return M=s*u+a*d+c*g+l*T,M<0&&(M=-M,u=-u,d=-d,g=-g,T=-T),1-M>ee?(E=Math.acos(M),A=Math.sin(E),N=Math.sin((1-n)*E)/A,m=Math.sin(n*E)/A):(N=1-n,m=n),t[0]=N*s+m*u,t[1]=N*a+m*d,t[2]=N*c+m*g,t[3]=N*l+m*T,t}function _0(t){var e=lt(),r=lt(),n=lt(),s=Math.sqrt(1-e),a=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*r),t[1]=s*Math.cos(2*Math.PI*r),t[2]=a*Math.sin(2*Math.PI*n),t[3]=a*Math.cos(2*Math.PI*n),t}function R0(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r*r+n*n+s*s+a*a,l=c?1/c:0;return t[0]=-r*l,t[1]=-n*l,t[2]=-s*l,t[3]=a*l,t}function b0(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Vc(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var a=(s+1)%3,c=(s+2)%3;n=Math.sqrt(e[s*3+s]-e[a*3+a]-e[c*3+c]+1),t[s]=.5*n,n=.5/n,t[3]=(e[a*3+c]-e[c*3+a])*n,t[a]=(e[a*3+s]+e[s*3+a])*n,t[c]=(e[c*3+s]+e[s*3+c])*n}return t}function A0(t,e,r,n){var s=.5*Math.PI/180;e*=s,r*=s,n*=s;var a=Math.sin(e),c=Math.cos(e),l=Math.sin(r),u=Math.cos(r),d=Math.sin(n),g=Math.cos(n);return t[0]=a*u*g-c*l*d,t[1]=c*l*g+a*u*d,t[2]=c*u*d-a*l*g,t[3]=c*u*g+a*l*d,t}function S0(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var I0=xc,C0=Tc,li=Ec,N0=wc,F0=Mc,O0=Pc,zc=Ac,fi=Nc,D0=Fc,ui=oi,$0=ui,hi=ci,P0=hi,di=Cc,k0=Oc,U0=Dc,L0=function(){var t=ii(),e=$s(1,0,0),r=$s(0,1,0);return function(n,s,a){var c=ai(s,a);return c<-.999999?(wn(t,e,s),vc(t)<1e-6&&wn(t,r,s),mc(t,t),$c(n,t,Math.PI),n):c>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(wn(t,s,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+c,di(n,n))}}(),B0=function(){var t=Fn(),e=Fn();return function(r,n,s,a,c,l){return Mn(t,n,c,l),Mn(e,s,a,l),Mn(r,t,e,2*l*(1-l)),r}}(),j0=function(){var t=Jo();return function(e,r,n,s){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],di(e,Vc(e,t))}}(),V0=Object.freeze({__proto__:null,add:F0,calculateW:w0,clone:I0,conjugate:b0,copy:li,create:Fn,dot:fi,equals:U0,exactEquals:k0,exp:Bc,fromEuler:A0,fromMat3:Vc,fromValues:C0,getAngle:E0,getAxisAngle:T0,identity:x0,invert:R0,len:$0,length:ui,lerp:D0,ln:jc,mul:O0,multiply:Pc,normalize:di,pow:M0,random:_0,rotateX:kc,rotateY:Uc,rotateZ:Lc,rotationTo:L0,scale:zc,set:N0,setAxes:j0,setAxisAngle:$c,slerp:Mn,sqlerp:B0,sqrLen:P0,squaredLength:hi,str:S0});function z0(){var t=new fe(8);return fe!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function G0(t){var e=new fe(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function q0(t,e,r,n,s,a,c,l){var u=new fe(8);return u[0]=t,u[1]=e,u[2]=r,u[3]=n,u[4]=s,u[5]=a,u[6]=c,u[7]=l,u}function H0(t,e,r,n,s,a,c){var l=new fe(8);l[0]=t,l[1]=e,l[2]=r,l[3]=n;var u=s*.5,d=a*.5,g=c*.5;return l[4]=u*n+d*r-g*e,l[5]=d*n+g*t-u*r,l[6]=g*n+u*e-d*t,l[7]=-u*t-d*e-g*r,l}function Gc(t,e,r){var n=r[0]*.5,s=r[1]*.5,a=r[2]*.5,c=e[0],l=e[1],u=e[2],d=e[3];return t[0]=c,t[1]=l,t[2]=u,t[3]=d,t[4]=n*d+s*u-a*l,t[5]=s*d+a*c-n*u,t[6]=a*d+n*l-s*c,t[7]=-n*c-s*l-a*u,t}function W0(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0]*.5,t[5]=e[1]*.5,t[6]=e[2]*.5,t[7]=0,t}function X0(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Y0(t,e){var r=Fn();ic(r,e);var n=new fe(3);return nc(n,e),Gc(t,r,n),t}function qc(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function K0(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function J0(t,e,r,n,s,a,c,l,u){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t[6]=l,t[7]=u,t}var Z0=li;function Q0(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var em=li;function tm(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function rm(t,e){var r=e[4],n=e[5],s=e[6],a=e[7],c=-e[0],l=-e[1],u=-e[2],d=e[3];return t[0]=(r*d+a*c+n*u-s*l)*2,t[1]=(n*d+a*l+s*c-r*u)*2,t[2]=(s*d+a*u+r*l-n*c)*2,t}function nm(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=r[0]*.5,u=r[1]*.5,d=r[2]*.5,g=e[4],T=e[5],E=e[6],M=e[7];return t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=c*l+s*d-a*u+g,t[5]=c*u+a*l-n*d+T,t[6]=c*d+n*u-s*l+E,t[7]=-n*l-s*u-a*d+M,t}function sm(t,e,r){var n=-e[0],s=-e[1],a=-e[2],c=e[3],l=e[4],u=e[5],d=e[6],g=e[7],T=l*c+g*n+u*a-d*s,E=u*c+g*s+d*n-l*a,M=d*c+g*a+l*s-u*n,A=g*c-l*n-u*s-d*a;return kc(t,e,r),n=t[0],s=t[1],a=t[2],c=t[3],t[4]=T*c+A*n+E*a-M*s,t[5]=E*c+A*s+M*n-T*a,t[6]=M*c+A*a+T*s-E*n,t[7]=A*c-T*n-E*s-M*a,t}function im(t,e,r){var n=-e[0],s=-e[1],a=-e[2],c=e[3],l=e[4],u=e[5],d=e[6],g=e[7],T=l*c+g*n+u*a-d*s,E=u*c+g*s+d*n-l*a,M=d*c+g*a+l*s-u*n,A=g*c-l*n-u*s-d*a;return Uc(t,e,r),n=t[0],s=t[1],a=t[2],c=t[3],t[4]=T*c+A*n+E*a-M*s,t[5]=E*c+A*s+M*n-T*a,t[6]=M*c+A*a+T*s-E*n,t[7]=A*c-T*n-E*s-M*a,t}function am(t,e,r){var n=-e[0],s=-e[1],a=-e[2],c=e[3],l=e[4],u=e[5],d=e[6],g=e[7],T=l*c+g*n+u*a-d*s,E=u*c+g*s+d*n-l*a,M=d*c+g*a+l*s-u*n,A=g*c-l*n-u*s-d*a;return Lc(t,e,r),n=t[0],s=t[1],a=t[2],c=t[3],t[4]=T*c+A*n+E*a-M*s,t[5]=E*c+A*s+M*n-T*a,t[6]=M*c+A*a+T*s-E*n,t[7]=A*c-T*n-E*s-M*a,t}function om(t,e,r){var n=r[0],s=r[1],a=r[2],c=r[3],l=e[0],u=e[1],d=e[2],g=e[3];return t[0]=l*c+g*n+u*a-d*s,t[1]=u*c+g*s+d*n-l*a,t[2]=d*c+g*a+l*s-u*n,t[3]=g*c-l*n-u*s-d*a,l=e[4],u=e[5],d=e[6],g=e[7],t[4]=l*c+g*n+u*a-d*s,t[5]=u*c+g*s+d*n-l*a,t[6]=d*c+g*a+l*s-u*n,t[7]=g*c-l*n-u*s-d*a,t}function cm(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=r[0],u=r[1],d=r[2],g=r[3];return t[0]=n*g+c*l+s*d-a*u,t[1]=s*g+c*u+a*l-n*d,t[2]=a*g+c*d+n*u-s*l,t[3]=c*g-n*l-s*u-a*d,l=r[4],u=r[5],d=r[6],g=r[7],t[4]=n*g+c*l+s*d-a*u,t[5]=s*g+c*u+a*l-n*d,t[6]=a*g+c*d+n*u-s*l,t[7]=c*g-n*l-s*u-a*d,t}function lm(t,e,r,n){if(Math.abs(n)<ee)return qc(t,e);var s=Math.hypot(r[0],r[1],r[2]);n=n*.5;var a=Math.sin(n),c=a*r[0]/s,l=a*r[1]/s,u=a*r[2]/s,d=Math.cos(n),g=e[0],T=e[1],E=e[2],M=e[3];t[0]=g*d+M*c+T*u-E*l,t[1]=T*d+M*l+E*c-g*u,t[2]=E*d+M*u+g*l-T*c,t[3]=M*d-g*c-T*l-E*u;var A=e[4],N=e[5],m=e[6],I=e[7];return t[4]=A*d+I*c+N*u-m*l,t[5]=N*d+I*l+m*c-A*u,t[6]=m*d+I*u+A*l-N*c,t[7]=I*d-A*c-N*l-m*u,t}function fm(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t}function Hc(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],l=r[4],u=r[5],d=r[6],g=r[7],T=e[4],E=e[5],M=e[6],A=e[7],N=r[0],m=r[1],I=r[2],x=r[3];return t[0]=n*x+c*N+s*I-a*m,t[1]=s*x+c*m+a*N-n*I,t[2]=a*x+c*I+n*m-s*N,t[3]=c*x-n*N-s*m-a*I,t[4]=n*g+c*l+s*d-a*u+T*x+A*N+E*I-M*m,t[5]=s*g+c*u+a*l-n*d+E*x+A*m+M*N-T*I,t[6]=a*g+c*d+n*u-s*l+M*x+A*I+T*m-E*N,t[7]=c*g-n*l-s*u-a*d+A*x-T*N-E*m-M*I,t}var um=Hc;function hm(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t}var Wc=fi;function dm(t,e,r,n){var s=1-n;return Wc(e,r)<0&&(n=-n),t[0]=e[0]*s+r[0]*n,t[1]=e[1]*s+r[1]*n,t[2]=e[2]*s+r[2]*n,t[3]=e[3]*s+r[3]*n,t[4]=e[4]*s+r[4]*n,t[5]=e[5]*s+r[5]*n,t[6]=e[6]*s+r[6]*n,t[7]=e[7]*s+r[7]*n,t}function pm(t,e){var r=Bn(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t}function gm(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var Xc=ui,mm=Xc,Bn=hi,vm=Bn;function ym(t,e){var r=Bn(e);if(r>0){r=Math.sqrt(r);var n=e[0]/r,s=e[1]/r,a=e[2]/r,c=e[3]/r,l=e[4],u=e[5],d=e[6],g=e[7],T=n*l+s*u+a*d+c*g;t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=(l-n*T)/r,t[5]=(u-s*T)/r,t[6]=(d-a*T)/r,t[7]=(g-c*T)/r}return t}function xm(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function Tm(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function Em(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],l=t[5],u=t[6],d=t[7],g=e[0],T=e[1],E=e[2],M=e[3],A=e[4],N=e[5],m=e[6],I=e[7];return Math.abs(r-g)<=ee*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(n-T)<=ee*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(s-E)<=ee*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(a-M)<=ee*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(c-A)<=ee*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(l-N)<=ee*Math.max(1,Math.abs(l),Math.abs(N))&&Math.abs(u-m)<=ee*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(d-I)<=ee*Math.max(1,Math.abs(d),Math.abs(I))}var wm=Object.freeze({__proto__:null,add:fm,clone:G0,conjugate:gm,copy:qc,create:z0,dot:Wc,equals:Em,exactEquals:Tm,fromMat4:Y0,fromRotation:X0,fromRotationTranslation:Gc,fromRotationTranslationValues:H0,fromTranslation:W0,fromValues:q0,getDual:Q0,getReal:Z0,getTranslation:rm,identity:K0,invert:pm,len:mm,length:Xc,lerp:dm,mul:um,multiply:Hc,normalize:ym,rotateAroundAxis:lm,rotateByQuatAppend:om,rotateByQuatPrepend:cm,rotateX:sm,rotateY:im,rotateZ:am,scale:hm,set:J0,setDual:tm,setReal:em,sqrLen:vm,squaredLength:Bn,str:xm,translate:nm});function Yc(){var t=new fe(2);return fe!=Float32Array&&(t[0]=0,t[1]=0),t}function Mm(t){var e=new fe(2);return e[0]=t[0],e[1]=t[1],e}function _m(t,e){var r=new fe(2);return r[0]=t,r[1]=e,r}function Rm(t,e){return t[0]=e[0],t[1]=e[1],t}function bm(t,e,r){return t[0]=e,t[1]=r,t}function Am(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Kc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Jc(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function Zc(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function Sm(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Im(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Cm(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function Nm(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function Fm(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Om(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Dm(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function Qc(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function el(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function tl(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function rl(t){var e=t[0],r=t[1];return e*e+r*r}function $m(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Pm(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function km(t,e){var r=e[0],n=e[1],s=r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t}function Um(t,e){return t[0]*e[0]+t[1]*e[1]}function Lm(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t}function Bm(t,e,r,n){var s=e[0],a=e[1];return t[0]=s+n*(r[0]-s),t[1]=a+n*(r[1]-a),t}function jm(t,e){e=e||1;var r=lt()*2*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function Vm(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s,t[1]=r[1]*n+r[3]*s,t}function zm(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s+r[4],t[1]=r[1]*n+r[3]*s+r[5],t}function Gm(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[3]*s+r[6],t[1]=r[1]*n+r[4]*s+r[7],t}function qm(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[4]*s+r[12],t[1]=r[1]*n+r[5]*s+r[13],t}function Hm(t,e,r,n){var s=e[0]-r[0],a=e[1]-r[1],c=Math.sin(n),l=Math.cos(n);return t[0]=s*l-a*c+r[0],t[1]=s*c+a*l+r[1],t}function Wm(t,e){var r=t[0],n=t[1],s=e[0],a=e[1],c=Math.sqrt(r*r+n*n)*Math.sqrt(s*s+a*a),l=c&&(r*s+n*a)/c;return Math.acos(Math.min(Math.max(l,-1),1))}function Xm(t){return t[0]=0,t[1]=0,t}function Ym(t){return"vec2("+t[0]+", "+t[1]+")"}function Km(t,e){return t[0]===e[0]&&t[1]===e[1]}function Jm(t,e){var r=t[0],n=t[1],s=e[0],a=e[1];return Math.abs(r-s)<=ee*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=ee*Math.max(1,Math.abs(n),Math.abs(a))}var Zm=tl,Qm=Kc,ev=Jc,tv=Zc,rv=Qc,nv=el,sv=rl,iv=function(){var t=Yc();return function(e,r,n,s,a,c){var l,u;for(r||(r=2),n||(n=0),s?u=Math.min(s*r+n,e.length):u=e.length,l=n;l<u;l+=r)t[0]=e[l],t[1]=e[l+1],a(t,t,c),e[l]=t[0],e[l+1]=t[1];return e}}(),av=Object.freeze({__proto__:null,add:Am,angle:Wm,ceil:Sm,clone:Mm,copy:Rm,create:Yc,cross:Lm,dist:rv,distance:Qc,div:tv,divide:Zc,dot:Um,equals:Jm,exactEquals:Km,floor:Im,forEach:iv,fromValues:_m,inverse:Pm,len:Zm,length:tl,lerp:Bm,max:Nm,min:Cm,mul:ev,multiply:Jc,negate:$m,normalize:km,random:jm,rotate:Hm,round:Fm,scale:Om,scaleAndAdd:Dm,set:bm,sqrDist:nv,sqrLen:sv,squaredDistance:el,squaredLength:rl,str:Ym,sub:Qm,subtract:Kc,transformMat2:Vm,transformMat2d:zm,transformMat3:Gm,transformMat4:qm,zero:Xm}),nl=Object.freeze({__proto__:null,glMatrix:Qd,mat2:_p,mat2d:Xp,mat3:_g,mat4:d1,quat:V0,quat2:wm,vec2:av,vec3:Y1,vec4:y0}),ov=(()=>{var t=import.meta.url;return async function(e={}){var r,n=e,s,a,c=new Promise((i,o)=>{s=i,a=o}),l=typeof window=="object",u=typeof importScripts=="function",d=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(d){const{createRequire:i}=await import("./__vite-browser-external-4ed993c7.js");var g=i(import.meta.url)}var T=!1;n.setup=function(){if(T)return;T=!0;function i(C,S,$=j=>j){if(S)for(let j of S)C.push_back($(j));return C}function o(C,S=$=>$){const $=[],j=C.size();for(let Z=0;Z<j;Z++)$.push(S(C.get(Z)));return $}function f(C,S=$=>$){const $=[],j=C.size();for(let Z=0;Z<j;Z++){const de=C.get(Z),le=de.size(),We=[];for(let qe=0;qe<le;qe++)We.push(S(de.get(qe)));$.push(We)}return $}function h(C){return C[0].length<3&&(C=[C]),i(new n.Vector2_vec2,C,S=>i(new n.Vector_vec2,S,$=>$ instanceof Array?{x:$[0],y:$[1]}:$))}function p(C){for(let S=0;S<C.size();S++)C.get(S).delete();C.delete()}function v(C){return C[0]instanceof Array?{x:C[0][0],y:C[0][1]}:typeof C[0]=="number"?{x:C[0]||0,y:C[1]||0}:C[0]}function w(C){return C[0]instanceof Array?{x:C[0][0],y:C[0][1],z:C[0][2]}:typeof C[0]=="number"?{x:C[0]||0,y:C[1]||0,z:C[2]||0}:C[0]}function R(C){return C=="EvenOdd"?0:C=="NonZero"?1:C=="Negative"?3:2}function O(C){return C=="Round"?1:C=="Miter"?2:0}const P=n.CrossSection;function L(C,S="Positive"){if(C instanceof P)return C;{const $=h(C),j=new P($,R(S));return p($),j}}n.CrossSection.prototype.translate=function(...C){return this._Translate(v(C))},n.CrossSection.prototype.scale=function(C){return typeof C=="number"?this._Scale({x:C,y:C}):this._Scale(v([C]))},n.CrossSection.prototype.mirror=function(C){return this._Mirror(v([C]))},n.CrossSection.prototype.warp=function(C){const S=Sr(function(j){const Z=ot(j,"float"),de=ot(j+4,"float"),le=[Z,de];C(le),nr(j,le[0],"float"),nr(j+4,le[1],"float")},"vi"),$=this._Warp(S);return Ir(S),$},n.CrossSection.prototype.decompose=function(){const C=this._Decompose(),S=o(C);return C.delete(),S},n.CrossSection.prototype.bounds=function(){const C=this._Bounds();return{min:["x","y"].map(S=>C.min[S]),max:["x","y"].map(S=>C.max[S])}},n.CrossSection.prototype.offset=function(C,S="Square",$=2,j=0){return this._Offset(C,O(S),$,j)},n.CrossSection.prototype.extrude=function(C,S=0,$=0,j=[1,1],Z=!1){j=v([j]);const de=n._Extrude(this._ToPolygons(),C,S,$,j);return Z?de.translate([0,0,-C/2]):de},n.CrossSection.prototype.revolve=function(C=0,S=360){return n._Revolve(this._ToPolygons(),C,S)},n.CrossSection.prototype.add=function(C){return this._add(L(C))},n.CrossSection.prototype.subtract=function(C){return this._subtract(L(C))},n.CrossSection.prototype.intersect=function(C){return this._intersect(L(C))},n.CrossSection.prototype.toPolygons=function(){const C=this._ToPolygons(),S=f(C);return C.delete(),S},n.Manifold.prototype.smoothOut=function(C=60,S=0){return this._SmoothOut(C,S)},n.Manifold.prototype.warp=function(C){const S=Sr(function(Z){const de=ot(Z,"float"),le=ot(Z+4,"float"),We=ot(Z+8,"float"),qe=[de,le,We];C(qe),nr(Z,qe[0],"float"),nr(Z+4,qe[1],"float"),nr(Z+8,qe[2],"float")},"vi"),$=this._Warp(S);Ir(S);const j=$.status();if(j.value!==0)throw new n.ManifoldError(j.value);return $},n.Manifold.prototype.calculateNormals=function(C,S=60){return this._CalculateNormals(C,S)},n.Manifold.prototype.setProperties=function(C,S){const $=this.numProp(),j=Sr(function(de,le,We){const qe=[];for(let Pe=0;Pe<C;++Pe)qe[Pe]=ot(de+4*Pe,"float");const cr=[];for(let Pe=0;Pe<3;++Pe)cr[Pe]=ot(le+4*Pe,"float");const lr=[];for(let Pe=0;Pe<$;++Pe)lr[Pe]=ot(We+4*Pe,"float");S(qe,cr,lr);for(let Pe=0;Pe<C;++Pe)nr(de+4*Pe,qe[Pe],"float")},"viii"),Z=this._SetProperties(C,j);return Ir(j),Z},n.Manifold.prototype.translate=function(...C){return this._Translate(w(C))},n.Manifold.prototype.rotate=function(C,S,$){return Array.isArray(C)?this._Rotate(...C):this._Rotate(C,S||0,$||0)},n.Manifold.prototype.scale=function(C){return typeof C=="number"?this._Scale({x:C,y:C,z:C}):this._Scale(w([C]))},n.Manifold.prototype.mirror=function(C){return this._Mirror(w([C]))},n.Manifold.prototype.trimByPlane=function(C,S=0){return this._TrimByPlane(w([C]),S)},n.Manifold.prototype.slice=function(C=0){return n.CrossSection(this._Slice(C))},n.Manifold.prototype.project=function(){return n.CrossSection(this._Project()).simplify(this.precision())},n.Manifold.prototype.split=function(C){const S=this._Split(C),$=o(S);return S.delete(),$},n.Manifold.prototype.splitByPlane=function(C,S=0){const $=this._SplitByPlane(w([C]),S),j=o($);return $.delete(),j},n.Manifold.prototype.decompose=function(){const C=this._Decompose(),S=o(C);return C.delete(),S},n.Manifold.prototype.boundingBox=function(){const C=this._boundingBox();return{min:["x","y","z"].map(S=>C.min[S]),max:["x","y","z"].map(S=>C.max[S])}};class X{constructor({numProp:S=3,triVerts:$=new Uint32Array,vertProperties:j=new Float32Array,mergeFromVert:Z,mergeToVert:de,runIndex:le,runOriginalID:We,faceID:qe,halfedgeTangent:cr,runTransform:lr}={}){this.numProp=S,this.triVerts=$,this.vertProperties=j,this.mergeFromVert=Z,this.mergeToVert=de,this.runIndex=le,this.runOriginalID=We,this.faceID=qe,this.halfedgeTangent=cr,this.runTransform=lr}get numTri(){return this.triVerts.length/3}get numVert(){return this.vertProperties.length/this.numProp}get numRun(){return this.runOriginalID.length}merge(){const{changed:S,mesh:$}=n._Merge(this);return Object.assign(this,{...$}),S}verts(S){return this.triVerts.subarray(3*S,3*(S+1))}position(S){return this.vertProperties.subarray(numProp*S,numProp*S+3)}extras(S){return this.vertProperties.subarray(numProp*S+3,numProp*(S+1))}tangent(S){return this.halfedgeTangent.subarray(4*S,4*(S+1))}transform(S){const $=new Array(16);for(const j of[0,1,2,3])for(const Z of[0,1,2])$[4*j+Z]=this.runTransform[12*S+3*j+Z];return $[15]=1,$}}n.Mesh=X,n.Manifold.prototype.getMesh=function(C=[0,0,0]){return C instanceof Array&&(C={0:C[0],1:C[1],2:C[2]}),new X(this._GetMeshJS(C))},n.ManifoldError=function(S,...$){let j="Unknown error";switch(S){case n.status.NonFiniteVertex.value:j="Non-finite vertex";break;case n.status.NotManifold.value:j="Not manifold";break;case n.status.VertexOutOfBounds.value:j="Vertex index out of bounds";break;case n.status.PropertiesWrongLength.value:j="Properties have wrong length";break;case n.status.MissingPositionProperties.value:j="Less than three properties";break;case n.status.MergeVectorsDifferentLengths.value:j="Merge vectors have different lengths";break;case n.status.MergeIndexOutOfBounds.value:j="Merge index out of bounds";break;case n.status.TransformWrongLength.value:j="Transform vector has wrong length";break;case n.status.RunIndexWrongLength.value:j="Run index vector has wrong length";break;case n.status.FaceIDWrongLength.value:j="Face ID vector has wrong length";case n.status.InvalidConstruction.value:j="Manifold constructed with invalid parameters"}const Z=Error.apply(this,[j,...$]);Z.name=this.name="ManifoldError",this.message=Z.message,this.stack=Z.stack,this.code=S},n.ManifoldError.prototype=Object.create(Error.prototype,{constructor:{value:n.ManifoldError,writable:!0,configurable:!0}}),n.CrossSection=function(C,S="Positive"){const $=h(C),j=new P($,R(S));return p($),j},n.CrossSection.ofPolygons=function(C,S="Positive"){return new n.CrossSection(C,S)},n.CrossSection.square=function(...C){let S;C.length==0?S={x:1,y:1}:typeof C[0]=="number"?S={x:C[0],y:C[0]}:S=v(C);const $=C[1]||!1;return n._Square(S,$)},n.CrossSection.circle=function(C,S=0){return n._Circle(C,S)};function Y(C){return function(...S){S.length==1&&(S=S[0]);const $=new n.Vector_crossSection;for(const Z of S)$.push_back(L(Z));const j=n["_crossSection"+C]($);return $.delete(),j}}n.CrossSection.compose=Y("Compose"),n.CrossSection.union=Y("UnionN"),n.CrossSection.difference=Y("DifferenceN"),n.CrossSection.intersection=Y("IntersectionN");function J(C,S){i(C,S,$=>$ instanceof Array?{x:$[0],y:$[1]}:$)}n.CrossSection.hull=function(...C){C.length==1&&(C=C[0]);let S=new n.Vector_vec2;for(const j of C)if(j instanceof P)n._crossSectionCollectVertices(S,j);else if(j instanceof Array&&j.length==2&&typeof j[0]=="number")S.push_back({x:j[0],y:j[1]});else if(j.x)S.push_back(j);else{const de=j[0].length==2&&typeof j[0][0]=="number"||j[0].x?[j]:j;for(const le of de)J(S,le)}const $=n._crossSectionHullPoints(S);return S.delete(),$},n.CrossSection.prototype=Object.create(P.prototype),Object.defineProperty(n.CrossSection,Symbol.hasInstance,{get:()=>C=>C instanceof P});const Q=n.Manifold;n.Manifold=function(C){const S=new Q(C),$=S.status();if($.value!==0)throw new n.ManifoldError($.value);return S},n.Manifold.ofMesh=function(C){return new n.Manifold(C)},n.Manifold.tetrahedron=function(){return n._Tetrahedron()},n.Manifold.cube=function(...C){let S;C.length==0?S={x:1,y:1,z:1}:typeof C[0]=="number"?S={x:C[0],y:C[0],z:C[0]}:S=w(C);const $=C[1]||!1;return n._Cube(S,$)},n.Manifold.cylinder=function(C,S,$=-1,j=0,Z=!1){return n._Cylinder(C,S,$,j,Z)},n.Manifold.sphere=function(C,S=0){return n._Sphere(C,S)},n.Manifold.smooth=function(C,S=[]){const $=new n.Vector_smoothness;i($,S);const j=n._Smooth(C,$);return $.delete(),j},n.Manifold.extrude=function(C,S,$=0,j=0,Z=[1,1],de=!1){return(C instanceof P?C:n.CrossSection(C,"Positive")).extrude(S,$,j,Z,de)},n.Manifold.revolve=function(C,S=0,$=360){return(C instanceof P?C:n.CrossSection(C,"Positive")).revolve(S,$)},n.Manifold.reserveIDs=function(C){return n._ReserveIDs(C)},n.Manifold.compose=function(C){const S=new n.Vector_manifold;i(S,C);const $=n._manifoldCompose(S);return S.delete(),$};function pe(C){return function(...S){S.length==1&&(S=S[0]);const $=new n.Vector_manifold;for(const Z of S)$.push_back(Z);const j=n["_manifold"+C+"N"]($);return $.delete(),j}}n.Manifold.union=pe("Union"),n.Manifold.difference=pe("Difference"),n.Manifold.intersection=pe("Intersection"),n.Manifold.levelSet=function(C,S,$,j=0){const Z={min:{x:S.min[0],y:S.min[1],z:S.min[2]},max:{x:S.max[0],y:S.max[1],z:S.max[2]}},de=Sr(function(We){const qe=ot(We,"float"),cr=ot(We+4,"float"),lr=ot(We+8,"float");return C([qe,cr,lr])},"fi"),le=n._LevelSet(de,Z,$,j);return Ir(de),le};function we(C,S){i(C,S,$=>$ instanceof Array?{x:$[0],y:$[1],z:$[2]}:$)}n.Manifold.hull=function(...C){C.length==1&&(C=C[0]);let S=new n.Vector_vec3;for(const j of C)j instanceof Q?n._manifoldCollectVertices(S,j):j instanceof Array&&j.length==3&&typeof j[0]=="number"?S.push_back({x:j[0],y:j[1],z:j[2]}):j.x?S.push_back(j):we(S,j);const $=n._manifoldHullPoints(S);return S.delete(),$},n.Manifold.prototype=Object.create(Q.prototype),Object.defineProperty(n.Manifold,Symbol.hasInstance,{get:()=>C=>C instanceof Q}),n.triangulate=function(C,S=-1){const $=h(C),j=o(n._Triangulate($,S),Z=>[Z[0],Z[1],Z[2]]);return p($),j}};var E=Object.assign({},n),M="./this.program",A="";function N(i){return n.locateFile?n.locateFile(i,A):A+i}var m,I,x;if(d){var _=g("fs"),b=g("path");A=g("url").fileURLToPath(new URL("./",self.location)),m=(i,o)=>(i=rr(i)?new URL(i):b.normalize(i),_.readFileSync(i,o?void 0:"utf8")),x=i=>{var o=m(i,!0);return o.buffer||(o=new Uint8Array(o)),o},I=(i,o,f,h=!0)=>{i=rr(i)?new URL(i):b.normalize(i),_.readFile(i,h?void 0:"utf8",(p,v)=>{p?f(p):o(h?v.buffer:v)})},!n.thisProgram&&process.argv.length>1&&(M=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else(l||u)&&(u?A=self.location.href:typeof document<"u"&&document.currentScript&&(A=document.currentScript.src),t&&(A=t),A.startsWith("blob:")?A="":A=A.substr(0,A.replace(/[?#].*/,"").lastIndexOf("/")+1),m=i=>{var o=new XMLHttpRequest;return o.open("GET",i,!1),o.send(null),o.responseText},u&&(x=i=>{var o=new XMLHttpRequest;return o.open("GET",i,!1),o.responseType="arraybuffer",o.send(null),new Uint8Array(o.response)}),I=(i,o,f)=>{if(rr(i)){var h=new XMLHttpRequest;h.open("GET",i,!0),h.responseType="arraybuffer",h.onload=()=>{if(h.status==200||h.status==0&&h.response){o(h.response);return}f()},h.onerror=f,h.send(null);return}fetch(i,{credentials:"same-origin"}).then(p=>p.ok?p.arrayBuffer():Promise.reject(new Error(p.status+" : "+p.url))).then(o,f)});var F=n.print||console.log.bind(console),D=n.printErr||console.error.bind(console);Object.assign(n,E),E=null,n.arguments&&n.arguments,n.thisProgram&&(M=n.thisProgram),n.quit&&n.quit;var V;n.wasmBinary&&(V=n.wasmBinary);var B,U=!1,z,G,K,H,k,q,ue,re;function ve(){var i=B.buffer;n.HEAP8=z=new Int8Array(i),n.HEAP16=K=new Int16Array(i),n.HEAPU8=G=new Uint8Array(i),n.HEAPU16=H=new Uint16Array(i),n.HEAP32=k=new Int32Array(i),n.HEAPU32=q=new Uint32Array(i),n.HEAPF32=ue=new Float32Array(i),n.HEAPF64=re=new Float64Array(i)}var ge=[],ye=[],xe=[];function _e(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)Ie(n.preRun.shift());zn(ge)}function ke(){!n.noFSInit&&!y.init.initialized&&y.init(),y.ignorePermissions=!1,zn(ye)}function be(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)at(n.postRun.shift());zn(xe)}function Ie(i){ge.unshift(i)}function et(i){ye.unshift(i)}function at(i){xe.unshift(i)}var Ze=0,Ee=null;function St(i){return i}function Ge(i){Ze++,n.monitorRunDependencies?.(Ze)}function yt(i){if(Ze--,n.monitorRunDependencies?.(Ze),Ze==0&&Ee){var o=Ee;Ee=null,o()}}function He(i){n.onAbort?.(i),i="Aborted("+i+")",D(i),U=!0,i+=". Build with -sASSERTIONS for more info.";var o=new WebAssembly.RuntimeError(i);throw a(o),o}var It="data:application/octet-stream;base64,",Jr=i=>i.startsWith(It),rr=i=>i.startsWith("file://");function Vn(){if(n.locateFile){var i="manifold.wasm";return Jr(i)?i:N(i)}return new URL("/assets/manifold-88365b46.wasm",self.location).href}var Zr;function vi(i){if(i==Zr&&V)return new Uint8Array(V);if(x)return x(i);throw"both async and sync fetching of the wasm failed"}function pl(i){return V?Promise.resolve().then(()=>vi(i)):new Promise((o,f)=>{I(i,h=>o(new Uint8Array(h)),h=>{try{o(vi(i))}catch(p){f(p)}})})}function yi(i,o,f){return pl(i).then(h=>WebAssembly.instantiate(h,o)).then(f,h=>{D(`failed to asynchronously prepare wasm: ${h}`),He(h)})}function gl(i,o,f,h){return!i&&typeof WebAssembly.instantiateStreaming=="function"&&!Jr(o)&&!rr(o)&&!d&&typeof fetch=="function"?fetch(o,{credentials:"same-origin"}).then(p=>{var v=WebAssembly.instantiateStreaming(p,f);return v.then(h,function(w){return D(`wasm streaming compile failed: ${w}`),D("falling back to ArrayBuffer instantiation"),yi(o,f,h)})}):yi(o,f,h)}function ml(){return{a:_u}}function vl(){var i=ml();function o(h,p){return Ce=h.exports,B=Ce.Ma,ve(),Ft=Ce.Pa,et(Ce.Na),yt(),Ce}Ge();function f(h){o(h.instance)}if(n.instantiateWasm)try{return n.instantiateWasm(i,o)}catch(h){D(`Module.instantiateWasm callback failed with error: ${h}`),a(h)}return Zr||(Zr=Vn()),gl(V,Zr,i,f).catch(a),{}}var he,Le,zn=i=>{for(;i.length>0;)i.shift()(n)};function ot(i,o="i8"){switch(o.endsWith("*")&&(o="*"),o){case"i1":return z[i];case"i8":return z[i];case"i16":return K[i>>1];case"i32":return k[i>>2];case"i64":He("to do getValue(i64) use WASM_BIGINT");case"float":return ue[i>>2];case"double":return re[i>>3];case"*":return q[i>>2];default:He(`invalid type for getValue: ${o}`)}}n.noExitRuntime;function nr(i,o,f="i8"){switch(f.endsWith("*")&&(f="*"),f){case"i1":z[i]=o;break;case"i8":z[i]=o;break;case"i16":K[i>>1]=o;break;case"i32":k[i>>2]=o;break;case"i64":He("to do setValue(i64) use WASM_BIGINT");case"float":ue[i>>2]=o;break;case"double":re[i>>3]=o;break;case"*":q[i>>2]=o;break;default:He(`invalid type for setValue: ${f}`)}}var ie=i=>qi(i),ae=()=>Hi(),Qr=[],en=0,yl=i=>{var o=new Gn(i);return o.get_caught()||(o.set_caught(!0),en--),o.set_rethrown(!1),Qr.push(o),Xi(o.excPtr),o.get_exception_ptr()},xt=0,xl=()=>{se(0,0);var i=Qr.pop();Wi(i.excPtr),xt=0};class Gn{constructor(o){this.excPtr=o,this.ptr=o-24}set_type(o){q[this.ptr+4>>2]=o}get_type(){return q[this.ptr+4>>2]}set_destructor(o){q[this.ptr+8>>2]=o}get_destructor(){return q[this.ptr+8>>2]}set_caught(o){o=o?1:0,z[this.ptr+12]=o}get_caught(){return z[this.ptr+12]!=0}set_rethrown(o){o=o?1:0,z[this.ptr+13]=o}get_rethrown(){return z[this.ptr+13]!=0}init(o,f){this.set_adjusted_ptr(0),this.set_type(o),this.set_destructor(f)}set_adjusted_ptr(o){q[this.ptr+16>>2]=o}get_adjusted_ptr(){return q[this.ptr+16>>2]}get_exception_ptr(){var o=Ki(this.get_type());if(o)return q[this.excPtr>>2];var f=this.get_adjusted_ptr();return f!==0?f:this.excPtr}}var Tl=i=>{throw xt||(xt=i),xt},tn=i=>Gi(i),xi=i=>{var o=xt;if(!o)return tn(0),0;var f=new Gn(o);f.set_adjusted_ptr(o);var h=f.get_type();if(!h)return tn(0),o;for(var p of i){if(p===0||p===h)break;var v=f.ptr+16;if(Yi(p,h,v))return tn(p),o}return tn(h),o},El=()=>xi([]),wl=i=>xi([i]),Ml=()=>{var i=Qr.pop();i||He("no exception to throw");var o=i.excPtr;throw i.get_rethrown()||(Qr.push(i),i.set_rethrown(!0),i.set_caught(!1),en++),xt=o,xt},_l=(i,o,f)=>{var h=new Gn(i);throw h.init(o,f),xt=i,en++,xt},Rl=()=>en,bl=()=>{He("")},rn={},qn=i=>{for(;i.length;){var o=i.pop(),f=i.pop();f(o)}};function Tr(i){return this.fromWireType(q[i>>2])}var sr={},Ct={},nn={},Ti,sn=i=>{throw new Ti(i)},Nt=(i,o,f)=>{i.forEach(function(R){nn[R]=o});function h(R){var O=f(R);O.length!==i.length&&sn("Mismatched type converter count");for(var P=0;P<i.length;++P)ht(i[P],O[P])}var p=new Array(o.length),v=[],w=0;o.forEach((R,O)=>{Ct.hasOwnProperty(R)?p[O]=Ct[R]:(v.push(R),sr.hasOwnProperty(R)||(sr[R]=[]),sr[R].push(()=>{p[O]=Ct[R],++w,w===v.length&&h(p)}))}),v.length===0&&h(p)},Al=i=>{var o=rn[i];delete rn[i];var f=o.rawConstructor,h=o.rawDestructor,p=o.fields,v=p.map(w=>w.getterReturnType).concat(p.map(w=>w.setterArgumentType));Nt([i],v,w=>{var R={};return p.forEach((O,P)=>{var L=O.fieldName,X=w[P],Y=O.getter,J=O.getterContext,Q=w[P+p.length],pe=O.setter,we=O.setterContext;R[L]={read:C=>X.fromWireType(Y(J,C)),write:(C,S)=>{var $=[];pe(we,C,Q.toWireType($,S)),qn($)}}}),[{name:o.name,fromWireType:O=>{var P={};for(var L in R)P[L]=R[L].read(O);return h(O),P},toWireType:(O,P)=>{for(var L in R)if(!(L in P))throw new TypeError(`Missing field: "${L}"`);var X=f();for(L in R)R[L].write(X,P[L]);return O!==null&&O.push(h,X),X},argPackAdvance:dt,readValueFromPointer:Tr,destructorFunction:h}]})},Sl=(i,o,f,h,p)=>{},Il=()=>{for(var i=new Array(256),o=0;o<256;++o)i[o]=String.fromCharCode(o);Ei=i},Ei,je=i=>{for(var o="",f=i;G[f];)o+=Ei[G[f++]];return o},ir,me=i=>{throw new ir(i)};function Cl(i,o,f={}){var h=o.name;if(i||me(`type "${h}" must have a positive integer typeid pointer`),Ct.hasOwnProperty(i)){if(f.ignoreDuplicateRegistrations)return;me(`Cannot register type '${h}' twice`)}if(Ct[i]=o,delete nn[i],sr.hasOwnProperty(i)){var p=sr[i];delete sr[i],p.forEach(v=>v())}}function ht(i,o,f={}){if(!("argPackAdvance"in o))throw new TypeError("registerType registeredInstance requires argPackAdvance");return Cl(i,o,f)}var dt=8,Nl=(i,o,f,h)=>{o=je(o),ht(i,{name:o,fromWireType:function(p){return!!p},toWireType:function(p,v){return v?f:h},argPackAdvance:dt,readValueFromPointer:function(p){return this.fromWireType(G[p])},destructorFunction:null})},Fl=i=>({count:i.count,deleteScheduled:i.deleteScheduled,preservePointerOnDelete:i.preservePointerOnDelete,ptr:i.ptr,ptrType:i.ptrType,smartPtr:i.smartPtr,smartPtrType:i.smartPtrType}),Hn=i=>{function o(f){return f.$$.ptrType.registeredClass.name}me(o(i)+" instance already deleted")},Wn=!1,wi=i=>{},Ol=i=>{i.smartPtr?i.smartPtrType.rawDestructor(i.smartPtr):i.ptrType.registeredClass.rawDestructor(i.ptr)},Mi=i=>{i.count.value-=1;var o=i.count.value===0;o&&Ol(i)},_i=(i,o,f)=>{if(o===f)return i;if(f.baseClass===void 0)return null;var h=_i(i,o,f.baseClass);return h===null?null:f.downcast(h)},Ri={},Dl=()=>Object.keys(Mr).length,$l=()=>{var i=[];for(var o in Mr)Mr.hasOwnProperty(o)&&i.push(Mr[o]);return i},Er=[],Xn=()=>{for(;Er.length;){var i=Er.pop();i.$$.deleteScheduled=!1,i.delete()}},wr,Pl=i=>{wr=i,Er.length&&wr&&wr(Xn)},kl=()=>{n.getInheritedInstanceCount=Dl,n.getLiveInheritedInstances=$l,n.flushPendingDeletes=Xn,n.setDelayFunction=Pl},Mr={},Ul=(i,o)=>{for(o===void 0&&me("ptr should not be undefined");i.baseClass;)o=i.upcast(o),i=i.baseClass;return o},Ll=(i,o)=>(o=Ul(i,o),Mr[o]),an=(i,o)=>{(!o.ptrType||!o.ptr)&&sn("makeClassHandle requires ptr and ptrType");var f=!!o.smartPtrType,h=!!o.smartPtr;return f!==h&&sn("Both smartPtrType and smartPtr must be specified"),o.count={value:1},_r(Object.create(i,{$$:{value:o,writable:!0}}))};function Bl(i){var o=this.getPointee(i);if(!o)return this.destructor(i),null;var f=Ll(this.registeredClass,o);if(f!==void 0){if(f.$$.count.value===0)return f.$$.ptr=o,f.$$.smartPtr=i,f.clone();var h=f.clone();return this.destructor(i),h}function p(){return this.isSmartPointer?an(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:o,smartPtrType:this,smartPtr:i}):an(this.registeredClass.instancePrototype,{ptrType:this,ptr:i})}var v=this.registeredClass.getActualType(o),w=Ri[v];if(!w)return p.call(this);var R;this.isConst?R=w.constPointerType:R=w.pointerType;var O=_i(o,this.registeredClass,R.registeredClass);return O===null?p.call(this):this.isSmartPointer?an(R.registeredClass.instancePrototype,{ptrType:R,ptr:O,smartPtrType:this,smartPtr:i}):an(R.registeredClass.instancePrototype,{ptrType:R,ptr:O})}var _r=i=>typeof FinalizationRegistry>"u"?(_r=o=>o,i):(Wn=new FinalizationRegistry(o=>{Mi(o.$$)}),_r=o=>{var f=o.$$,h=!!f.smartPtr;if(h){var p={$$:f};Wn.register(o,p,o)}return o},wi=o=>Wn.unregister(o),_r(i)),jl=()=>{Object.assign(on.prototype,{isAliasOf(i){if(!(this instanceof on)||!(i instanceof on))return!1;var o=this.$$.ptrType.registeredClass,f=this.$$.ptr;i.$$=i.$$;for(var h=i.$$.ptrType.registeredClass,p=i.$$.ptr;o.baseClass;)f=o.upcast(f),o=o.baseClass;for(;h.baseClass;)p=h.upcast(p),h=h.baseClass;return o===h&&f===p},clone(){if(this.$$.ptr||Hn(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var i=_r(Object.create(Object.getPrototypeOf(this),{$$:{value:Fl(this.$$)}}));return i.$$.count.value+=1,i.$$.deleteScheduled=!1,i},delete(){this.$$.ptr||Hn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&me("Object already scheduled for deletion"),wi(this),Mi(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||Hn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&me("Object already scheduled for deletion"),Er.push(this),Er.length===1&&wr&&wr(Xn),this.$$.deleteScheduled=!0,this}})};function on(){}var ar=(i,o)=>Object.defineProperty(o,"name",{value:i}),bi=(i,o,f)=>{if(i[o].overloadTable===void 0){var h=i[o];i[o]=function(...p){return i[o].overloadTable.hasOwnProperty(p.length)||me(`Function '${f}' called with an invalid number of arguments (${p.length}) - expects one of (${i[o].overloadTable})!`),i[o].overloadTable[p.length].apply(this,p)},i[o].overloadTable=[],i[o].overloadTable[h.argCount]=h}},Yn=(i,o,f)=>{n.hasOwnProperty(i)?((f===void 0||n[i].overloadTable!==void 0&&n[i].overloadTable[f]!==void 0)&&me(`Cannot register public name '${i}' twice`),bi(n,i,i),n.hasOwnProperty(f)&&me(`Cannot register multiple overloads of a function with the same number of arguments (${f})!`),n[i].overloadTable[f]=o):(n[i]=o,f!==void 0&&(n[i].numArguments=f))},Vl=48,zl=57,Gl=i=>{if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var o=i.charCodeAt(0);return o>=Vl&&o<=zl?`_${i}`:i};function ql(i,o,f,h,p,v,w,R){this.name=i,this.constructor=o,this.instancePrototype=f,this.rawDestructor=h,this.baseClass=p,this.getActualType=v,this.upcast=w,this.downcast=R,this.pureVirtualFunctions=[]}var Kn=(i,o,f)=>{for(;o!==f;)o.upcast||me(`Expected null or instance of ${f.name}, got an instance of ${o.name}`),i=o.upcast(i),o=o.baseClass;return i};function Hl(i,o){if(o===null)return this.isReference&&me(`null is not a valid ${this.name}`),0;o.$$||me(`Cannot pass "${ts(o)}" as a ${this.name}`),o.$$.ptr||me(`Cannot pass deleted object as a pointer of type ${this.name}`);var f=o.$$.ptrType.registeredClass,h=Kn(o.$$.ptr,f,this.registeredClass);return h}function Wl(i,o){var f;if(o===null)return this.isReference&&me(`null is not a valid ${this.name}`),this.isSmartPointer?(f=this.rawConstructor(),i!==null&&i.push(this.rawDestructor,f),f):0;(!o||!o.$$)&&me(`Cannot pass "${ts(o)}" as a ${this.name}`),o.$$.ptr||me(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&o.$$.ptrType.isConst&&me(`Cannot convert argument of type ${o.$$.smartPtrType?o.$$.smartPtrType.name:o.$$.ptrType.name} to parameter type ${this.name}`);var h=o.$$.ptrType.registeredClass;if(f=Kn(o.$$.ptr,h,this.registeredClass),this.isSmartPointer)switch(o.$$.smartPtr===void 0&&me("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:o.$$.smartPtrType===this?f=o.$$.smartPtr:me(`Cannot convert argument of type ${o.$$.smartPtrType?o.$$.smartPtrType.name:o.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:f=o.$$.smartPtr;break;case 2:if(o.$$.smartPtrType===this)f=o.$$.smartPtr;else{var p=o.clone();f=this.rawShare(f,Be.toHandle(()=>p.delete())),i!==null&&i.push(this.rawDestructor,f)}break;default:me("Unsupporting sharing policy")}return f}function Xl(i,o){if(o===null)return this.isReference&&me(`null is not a valid ${this.name}`),0;o.$$||me(`Cannot pass "${ts(o)}" as a ${this.name}`),o.$$.ptr||me(`Cannot pass deleted object as a pointer of type ${this.name}`),o.$$.ptrType.isConst&&me(`Cannot convert argument of type ${o.$$.ptrType.name} to parameter type ${this.name}`);var f=o.$$.ptrType.registeredClass,h=Kn(o.$$.ptr,f,this.registeredClass);return h}var Yl=()=>{Object.assign(cn.prototype,{getPointee(i){return this.rawGetPointee&&(i=this.rawGetPointee(i)),i},destructor(i){this.rawDestructor?.(i)},argPackAdvance:dt,readValueFromPointer:Tr,fromWireType:Bl})};function cn(i,o,f,h,p,v,w,R,O,P,L){this.name=i,this.registeredClass=o,this.isReference=f,this.isConst=h,this.isSmartPointer=p,this.pointeeType=v,this.sharingPolicy=w,this.rawGetPointee=R,this.rawConstructor=O,this.rawShare=P,this.rawDestructor=L,!p&&o.baseClass===void 0?h?(this.toWireType=Hl,this.destructorFunction=null):(this.toWireType=Xl,this.destructorFunction=null):this.toWireType=Wl}var Ai=(i,o,f)=>{n.hasOwnProperty(i)||sn("Replacing nonexistent public symbol"),n[i].overloadTable!==void 0&&f!==void 0?n[i].overloadTable[f]=o:(n[i]=o,n[i].argCount=f)},Kl=(i,o,f)=>{i=i.replace(/p/g,"i");var h=n["dynCall_"+i];return h(o,...f)},Rr=[],Ft,ne=i=>{var o=Rr[i];return o||(i>=Rr.length&&(Rr.length=i+1),Rr[i]=o=Ft.get(i)),o},Jl=(i,o,f=[])=>{if(i.includes("j"))return Kl(i,o,f);var h=ne(o)(...f);return h},Zl=(i,o)=>(...f)=>Jl(i,o,f),ct=(i,o)=>{i=je(i);function f(){return i.includes("j")?Zl(i,o):ne(o)}var h=f();return typeof h!="function"&&me(`unknown function pointer with signature ${i}: ${o}`),h},Ql=(i,o)=>{var f=ar(o,function(h){this.name=o,this.message=h;var p=new Error(h).stack;p!==void 0&&(this.stack=this.toString()+`
`+p.replace(/^Error(:[^\n]*)?\n/,""))});return f.prototype=Object.create(i.prototype),f.prototype.constructor=f,f.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},f},Si,Ii=i=>{var o=zi(i),f=je(o);return wt(o),f},ln=(i,o)=>{var f=[],h={};function p(v){if(!h[v]&&!Ct[v]){if(nn[v]){nn[v].forEach(p);return}f.push(v),h[v]=!0}}throw o.forEach(p),new Si(`${i}: `+f.map(Ii).join([", "]))},ef=(i,o,f,h,p,v,w,R,O,P,L,X,Y)=>{L=je(L),v=ct(p,v),R&&=ct(w,R),P&&=ct(O,P),Y=ct(X,Y);var J=Gl(L);Yn(J,function(){ln(`Cannot construct ${L} due to unbound types`,[h])}),Nt([i,o,f],h?[h]:[],Q=>{Q=Q[0];var pe,we;h?(pe=Q.registeredClass,we=pe.instancePrototype):we=on.prototype;var C=ar(L,function(...le){if(Object.getPrototypeOf(this)!==S)throw new ir("Use 'new' to construct "+L);if($.constructor_body===void 0)throw new ir(L+" has no accessible constructor");var We=$.constructor_body[le.length];if(We===void 0)throw new ir(`Tried to invoke ctor of ${L} with invalid number of parameters (${le.length}) - expected (${Object.keys($.constructor_body).toString()}) parameters instead!`);return We.apply(this,le)}),S=Object.create(we,{constructor:{value:C}});C.prototype=S;var $=new ql(L,C,S,Y,pe,v,R,P);$.baseClass&&($.baseClass.__derivedClasses??=[],$.baseClass.__derivedClasses.push($));var j=new cn(L,$,!0,!1,!1),Z=new cn(L+"*",$,!1,!1,!1),de=new cn(L+" const*",$,!1,!0,!1);return Ri[i]={pointerType:Z,constPointerType:de},Ai(J,C),[j,Z,de]})},Jn=(i,o)=>{for(var f=[],h=0;h<i;h++)f.push(q[o+h*4>>2]);return f};function Ci(i){for(var o=1;o<i.length;++o)if(i[o]!==null&&i[o].destructorFunction===void 0)return!0;return!1}function Ni(i,o){if(!(i instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof i} which is not a function`);var f=ar(i.name||"unknownFunctionName",function(){});f.prototype=i.prototype;var h=new f,p=i.apply(h,o);return p instanceof Object?p:h}function tf(i,o,f,h){for(var p=Ci(i),v=i.length,w="",R="",O=0;O<v-2;++O)w+=(O!==0?", ":"")+"arg"+O,R+=(O!==0?", ":"")+"arg"+O+"Wired";var P=`
        return function (${w}) {
        if (arguments.length !== ${v-2}) {
          throwBindingError('function ' + humanName + ' called with ' + arguments.length + ' arguments, expected ${v-2}');
        }`;p&&(P+=`var destructors = [];
`);var L=p?"destructors":"null",X=["humanName","throwBindingError","invoker","fn","runDestructors","retType","classParam"];o&&(P+="var thisWired = classParam['toWireType']("+L+`, this);
`);for(var O=0;O<v-2;++O)P+="var arg"+O+"Wired = argType"+O+"['toWireType']("+L+", arg"+O+`);
`,X.push("argType"+O);if(o&&(R="thisWired"+(R.length>0?", ":"")+R),P+=(f||h?"var rv = ":"")+"invoker(fn"+(R.length>0?", ":"")+R+`);
`,p)P+=`runDestructors(destructors);
`;else for(var O=o?1:2;O<i.length;++O){var Y=O===1?"thisWired":"arg"+(O-2)+"Wired";i[O].destructorFunction!==null&&(P+=`${Y}_dtor(${Y});
`,X.push(`${Y}_dtor`))}return f&&(P+=`var ret = retType['fromWireType'](rv);
return ret;
`),P+=`}
`,[X,P]}function Zn(i,o,f,h,p,v){var w=o.length;w<2&&me("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var R=o[1]!==null&&f!==null,O=Ci(o),P=o[0].name!=="void",L=[i,me,h,p,qn,o[0],o[1]],X=0;X<w-2;++X)L.push(o[X+2]);if(!O)for(var X=R?1:2;X<o.length;++X)o[X].destructorFunction!==null&&L.push(o[X].destructorFunction);let[Y,J]=tf(o,R,P,v);Y.push(J);var Q=Ni(Function,Y)(...L);return ar(i,Q)}var rf=(i,o,f,h,p,v)=>{var w=Jn(o,f);p=ct(h,p),Nt([],[i],R=>{R=R[0];var O=`constructor ${R.name}`;if(R.registeredClass.constructor_body===void 0&&(R.registeredClass.constructor_body=[]),R.registeredClass.constructor_body[o-1]!==void 0)throw new ir(`Cannot register multiple constructors with identical number of parameters (${o-1}) for class '${R.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return R.registeredClass.constructor_body[o-1]=()=>{ln(`Cannot construct ${R.name} due to unbound types`,w)},Nt([],w,P=>(P.splice(1,0,null),R.registeredClass.constructor_body[o-1]=Zn(O,P,null,p,v),[])),[]})},Fi=i=>{i=i.trim();const o=i.indexOf("(");return o!==-1?i.substr(0,o):i},nf=(i,o,f,h,p,v,w,R,O)=>{var P=Jn(f,h);o=je(o),o=Fi(o),v=ct(p,v),Nt([],[i],L=>{L=L[0];var X=`${L.name}.${o}`;o.startsWith("@@")&&(o=Symbol[o.substring(2)]),R&&L.registeredClass.pureVirtualFunctions.push(o);function Y(){ln(`Cannot call ${X} due to unbound types`,P)}var J=L.registeredClass.instancePrototype,Q=J[o];return Q===void 0||Q.overloadTable===void 0&&Q.className!==L.name&&Q.argCount===f-2?(Y.argCount=f-2,Y.className=L.name,J[o]=Y):(bi(J,o,X),J[o].overloadTable[f-2]=Y),Nt([],P,pe=>{var we=Zn(X,pe,L,v,w,O);return J[o].overloadTable===void 0?(we.argCount=f-2,J[o]=we):J[o].overloadTable[f-2]=we,[]}),[]})},Qn=[],Tt=[],es=i=>{i>9&&--Tt[i+1]===0&&(Tt[i]=void 0,Qn.push(i))},sf=()=>Tt.length/2-5-Qn.length,af=()=>{Tt.push(0,1,void 0,1,null,1,!0,1,!1,1),n.count_emval_handles=sf},Be={toValue:i=>(i||me("Cannot use deleted val. handle = "+i),Tt[i]),toHandle:i=>{switch(i){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const o=Qn.pop()||Tt.length;return Tt[o]=i,Tt[o+1]=1,o}}}},of={name:"emscripten::val",fromWireType:i=>{var o=Be.toValue(i);return es(i),o},toWireType:(i,o)=>Be.toHandle(o),argPackAdvance:dt,readValueFromPointer:Tr,destructorFunction:null},Oi=i=>ht(i,of),cf=(i,o,f)=>{switch(o){case 1:return f?function(h){return this.fromWireType(z[h])}:function(h){return this.fromWireType(G[h])};case 2:return f?function(h){return this.fromWireType(K[h>>1])}:function(h){return this.fromWireType(H[h>>1])};case 4:return f?function(h){return this.fromWireType(k[h>>2])}:function(h){return this.fromWireType(q[h>>2])};default:throw new TypeError(`invalid integer width (${o}): ${i}`)}},lf=(i,o,f,h)=>{o=je(o);function p(){}p.values={},ht(i,{name:o,constructor:p,fromWireType:function(v){return this.constructor.values[v]},toWireType:(v,w)=>w.value,argPackAdvance:dt,readValueFromPointer:cf(o,f,h),destructorFunction:null}),Yn(o,p)},fn=(i,o)=>{var f=Ct[i];return f===void 0&&me(`${o} has unknown type ${Ii(i)}`),f},ff=(i,o,f)=>{var h=fn(i,"enum");o=je(o);var p=h.constructor,v=Object.create(h.constructor.prototype,{value:{value:f},constructor:{value:ar(`${h.name}_${o}`,function(){})}});p.values[f]=v,p[o]=v},ts=i=>{if(i===null)return"null";var o=typeof i;return o==="object"||o==="array"||o==="function"?i.toString():""+i},uf=(i,o)=>{switch(o){case 4:return function(f){return this.fromWireType(ue[f>>2])};case 8:return function(f){return this.fromWireType(re[f>>3])};default:throw new TypeError(`invalid float width (${o}): ${i}`)}},hf=(i,o,f)=>{o=je(o),ht(i,{name:o,fromWireType:h=>h,toWireType:(h,p)=>p,argPackAdvance:dt,readValueFromPointer:uf(o,f),destructorFunction:null})},df=(i,o,f,h,p,v,w)=>{var R=Jn(o,f);i=je(i),i=Fi(i),p=ct(h,p),Yn(i,function(){ln(`Cannot call ${i} due to unbound types`,R)},o-1),Nt([],R,O=>{var P=[O[0],null].concat(O.slice(1));return Ai(i,Zn(i,P,null,p,v,w),o-1),[]})},pf=(i,o,f)=>{switch(o){case 1:return f?h=>z[h]:h=>G[h];case 2:return f?h=>K[h>>1]:h=>H[h>>1];case 4:return f?h=>k[h>>2]:h=>q[h>>2];default:throw new TypeError(`invalid integer width (${o}): ${i}`)}},gf=(i,o,f,h,p)=>{o=je(o);var v=L=>L;if(h===0){var w=32-8*f;v=L=>L<<w>>>w}var R=o.includes("unsigned"),O=(L,X)=>{},P;R?P=function(L,X){return O(X,this.name),X>>>0}:P=function(L,X){return O(X,this.name),X},ht(i,{name:o,fromWireType:v,toWireType:P,argPackAdvance:dt,readValueFromPointer:pf(o,f,h!==0),destructorFunction:null})},mf=(i,o,f)=>{var h=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],p=h[o];function v(w){var R=q[w>>2],O=q[w+4>>2];return new p(z.buffer,O,R)}f=je(f),ht(i,{name:f,fromWireType:v,argPackAdvance:dt,readValueFromPointer:v},{ignoreDuplicateRegistrations:!0})},vf=(i,o)=>{Oi(i)},rs=(i,o,f,h)=>{if(!(h>0))return 0;for(var p=f,v=f+h-1,w=0;w<i.length;++w){var R=i.charCodeAt(w);if(R>=55296&&R<=57343){var O=i.charCodeAt(++w);R=65536+((R&1023)<<10)|O&1023}if(R<=127){if(f>=v)break;o[f++]=R}else if(R<=2047){if(f+1>=v)break;o[f++]=192|R>>6,o[f++]=128|R&63}else if(R<=65535){if(f+2>=v)break;o[f++]=224|R>>12,o[f++]=128|R>>6&63,o[f++]=128|R&63}else{if(f+3>=v)break;o[f++]=240|R>>18,o[f++]=128|R>>12&63,o[f++]=128|R>>6&63,o[f++]=128|R&63}}return o[f]=0,f-p},yf=(i,o,f)=>rs(i,G,o,f),ns=i=>{for(var o=0,f=0;f<i.length;++f){var h=i.charCodeAt(f);h<=127?o++:h<=2047?o+=2:h>=55296&&h<=57343?(o+=4,++f):o+=3}return o},Di=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,or=(i,o,f)=>{for(var h=o+f,p=o;i[p]&&!(p>=h);)++p;if(p-o>16&&i.buffer&&Di)return Di.decode(i.subarray(o,p));for(var v="";o<p;){var w=i[o++];if(!(w&128)){v+=String.fromCharCode(w);continue}var R=i[o++]&63;if((w&224)==192){v+=String.fromCharCode((w&31)<<6|R);continue}var O=i[o++]&63;if((w&240)==224?w=(w&15)<<12|R<<6|O:w=(w&7)<<18|R<<12|O<<6|i[o++]&63,w<65536)v+=String.fromCharCode(w);else{var P=w-65536;v+=String.fromCharCode(55296|P>>10,56320|P&1023)}}return v},un=(i,o)=>i?or(G,i,o):"",xf=(i,o)=>{o=je(o);var f=o==="std::string";ht(i,{name:o,fromWireType(h){var p=q[h>>2],v=h+4,w;if(f)for(var R=v,O=0;O<=p;++O){var P=v+O;if(O==p||G[P]==0){var L=P-R,X=un(R,L);w===void 0?w=X:(w+=String.fromCharCode(0),w+=X),R=P+1}}else{for(var Y=new Array(p),O=0;O<p;++O)Y[O]=String.fromCharCode(G[v+O]);w=Y.join("")}return wt(h),w},toWireType(h,p){p instanceof ArrayBuffer&&(p=new Uint8Array(p));var v,w=typeof p=="string";w||p instanceof Uint8Array||p instanceof Uint8ClampedArray||p instanceof Int8Array||me("Cannot pass non-string to std::string"),f&&w?v=ns(p):v=p.length;var R=fs(4+v+1),O=R+4;if(q[R>>2]=v,f&&w)yf(p,O,v+1);else if(w)for(var P=0;P<v;++P){var L=p.charCodeAt(P);L>255&&(wt(O),me("String has UTF-16 code units that do not fit in 8 bits")),G[O+P]=L}else for(var P=0;P<v;++P)G[O+P]=p[P];return h!==null&&h.push(wt,R),R},argPackAdvance:dt,readValueFromPointer:Tr,destructorFunction(h){wt(h)}})},$i=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Tf=(i,o)=>{for(var f=i,h=f>>1,p=h+o/2;!(h>=p)&&H[h];)++h;if(f=h<<1,f-i>32&&$i)return $i.decode(G.subarray(i,f));for(var v="",w=0;!(w>=o/2);++w){var R=K[i+w*2>>1];if(R==0)break;v+=String.fromCharCode(R)}return v},Ef=(i,o,f)=>{if(f??=2147483647,f<2)return 0;f-=2;for(var h=o,p=f<i.length*2?f/2:i.length,v=0;v<p;++v){var w=i.charCodeAt(v);K[o>>1]=w,o+=2}return K[o>>1]=0,o-h},wf=i=>i.length*2,Mf=(i,o)=>{for(var f=0,h="";!(f>=o/4);){var p=k[i+f*4>>2];if(p==0)break;if(++f,p>=65536){var v=p-65536;h+=String.fromCharCode(55296|v>>10,56320|v&1023)}else h+=String.fromCharCode(p)}return h},_f=(i,o,f)=>{if(f??=2147483647,f<4)return 0;for(var h=o,p=h+f-4,v=0;v<i.length;++v){var w=i.charCodeAt(v);if(w>=55296&&w<=57343){var R=i.charCodeAt(++v);w=65536+((w&1023)<<10)|R&1023}if(k[o>>2]=w,o+=4,o+4>p)break}return k[o>>2]=0,o-h},Rf=i=>{for(var o=0,f=0;f<i.length;++f){var h=i.charCodeAt(f);h>=55296&&h<=57343&&++f,o+=4}return o},bf=(i,o,f)=>{f=je(f);var h,p,v,w;o===2?(h=Tf,p=Ef,w=wf,v=R=>H[R>>1]):o===4&&(h=Mf,p=_f,w=Rf,v=R=>q[R>>2]),ht(i,{name:f,fromWireType:R=>{for(var O=q[R>>2],P,L=R+4,X=0;X<=O;++X){var Y=R+4+X*o;if(X==O||v(Y)==0){var J=Y-L,Q=h(L,J);P===void 0?P=Q:(P+=String.fromCharCode(0),P+=Q),L=Y+o}}return wt(R),P},toWireType:(R,O)=>{typeof O!="string"&&me(`Cannot pass non-string to C++ string type ${f}`);var P=w(O),L=fs(4+P+o);return q[L>>2]=P/o,p(O,L+4,P+o),R!==null&&R.push(wt,L),L},argPackAdvance:dt,readValueFromPointer:Tr,destructorFunction(R){wt(R)}})},Af=(i,o,f,h,p,v)=>{rn[i]={name:je(o),rawConstructor:ct(f,h),rawDestructor:ct(p,v),fields:[]}},Sf=(i,o,f,h,p,v,w,R,O,P)=>{rn[i].fields.push({fieldName:je(o),getterReturnType:f,getter:ct(h,p),getterContext:v,setterArgumentType:w,setter:ct(R,O),setterContext:P})},If=(i,o)=>{o=je(o),ht(i,{isVoid:!0,name:o,argPackAdvance:0,fromWireType:()=>{},toWireType:(f,h)=>{}})},Cf=(i,o,f)=>G.copyWithin(i,o,o+f),Pi=(i,o,f)=>{var h=[],p=i.toWireType(h,f);return h.length&&(q[o>>2]=Be.toHandle(h)),p},Nf=(i,o,f)=>(i=Be.toValue(i),o=fn(o,"emval::as"),Pi(o,f,i)),Ff={},ki=i=>{var o=Ff[i];return o===void 0?je(i):o},ss=[],Of=(i,o,f,h,p)=>(i=ss[i],o=Be.toValue(o),f=ki(f),i(o,o[f],h,p)),Df=(i,o)=>(i=Be.toValue(i),o=Be.toValue(o),i==o),$f=i=>{var o=ss.length;return ss.push(i),o},Pf=(i,o)=>{for(var f=new Array(i),h=0;h<i;++h)f[h]=fn(q[o+h*4>>2],"parameter "+h);return f},kf=(i,o,f)=>{var h=Pf(i,o),p=h.shift();i--;var v=`return function (obj, func, destructorsRef, args) {
`,w=0,R=[];f===0&&R.push("obj");for(var O=["retType"],P=[p],L=0;L<i;++L)R.push("arg"+L),O.push("argType"+L),P.push(h[L]),v+=`  var arg${L} = argType${L}.readValueFromPointer(args${w?"+"+w:""});
`,w+=h[L].argPackAdvance;var X=f===1?"new func":"func.call";v+=`  var rv = ${X}(${R.join(", ")});
`,p.isVoid||(O.push("emval_returnValue"),P.push(Pi),v+=`  return emval_returnValue(retType, destructorsRef, rv);
`),v+=`};
`,O.push(v);var Y=Ni(Function,O)(...P),J=`methodCaller<(${h.map(Q=>Q.name).join(", ")}) => ${p.name}>`;return $f(ar(J,Y))},Uf=(i,o)=>(i=Be.toValue(i),o=Be.toValue(o),Be.toHandle(i[o])),Lf=i=>{i>9&&(Tt[i+1]+=1)},Bf=i=>Be.toHandle(ki(i)),jf=()=>Be.toHandle({}),Vf=i=>{var o=Be.toValue(i);qn(o),es(i)},zf=(i,o,f)=>{i=Be.toValue(i),o=Be.toValue(o),f=Be.toValue(f),i[o]=f},Gf=(i,o)=>{i=fn(i,"_emval_take_value");var f=i.readValueFromPointer(o);return Be.toHandle(f)},qf=()=>2147483648,Hf=i=>{var o=B.buffer,f=(i-o.byteLength+65535)/65536;try{return B.grow(f),ve(),1}catch{}},Wf=i=>{var o=G.length;i>>>=0;var f=qf();if(i>f)return!1;for(var h=(O,P)=>O+(P-O%P)%P,p=1;p<=4;p*=2){var v=o*(1+.2/p);v=Math.min(v,i+100663296);var w=Math.min(f,h(Math.max(i,v),65536)),R=Hf(w);if(R)return!0}return!1},is={},Xf=()=>M||"./this.program",br=()=>{if(!br.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",o={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:Xf()};for(var f in is)is[f]===void 0?delete o[f]:o[f]=is[f];var h=[];for(var f in o)h.push(`${f}=${o[f]}`);br.strings=h}return br.strings},Yf=(i,o)=>{for(var f=0;f<i.length;++f)z[o++]=i.charCodeAt(f);z[o]=0},Kf=(i,o)=>{var f=0;return br().forEach((h,p)=>{var v=o+f;q[i+p*4>>2]=v,Yf(h,v),f+=h.length+1}),0},Jf=(i,o)=>{var f=br();q[i>>2]=f.length;var h=0;return f.forEach(p=>h+=p.length+1),q[o>>2]=h,0},Me={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var o=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return o.exec(i).slice(1)},normalizeArray:(i,o)=>{for(var f=0,h=i.length-1;h>=0;h--){var p=i[h];p==="."?i.splice(h,1):p===".."?(i.splice(h,1),f++):f&&(i.splice(h,1),f--)}if(o)for(;f;f--)i.unshift("..");return i},normalize:i=>{var o=Me.isAbs(i),f=i.substr(-1)==="/";return i=Me.normalizeArray(i.split("/").filter(h=>!!h),!o).join("/"),!i&&!o&&(i="."),i&&f&&(i+="/"),(o?"/":"")+i},dirname:i=>{var o=Me.splitPath(i),f=o[0],h=o[1];return!f&&!h?".":(h&&(h=h.substr(0,h.length-1)),f+h)},basename:i=>{if(i==="/")return"/";i=Me.normalize(i),i=i.replace(/\/$/,"");var o=i.lastIndexOf("/");return o===-1?i:i.substr(o+1)},join:(...i)=>Me.normalize(i.join("/")),join2:(i,o)=>Me.normalize(i+"/"+o)},Zf=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return h=>crypto.getRandomValues(h);if(d)try{var i=g("crypto"),o=i.randomFillSync;if(o)return h=>i.randomFillSync(h);var f=i.randomBytes;return h=>(h.set(f(h.byteLength)),h)}catch{}He("initRandomDevice")},Ui=i=>(Ui=Zf())(i),Et={resolve:(...i)=>{for(var o="",f=!1,h=i.length-1;h>=-1&&!f;h--){var p=h>=0?i[h]:y.cwd();if(typeof p!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!p)return"";o=p+"/"+o,f=Me.isAbs(p)}return o=Me.normalizeArray(o.split("/").filter(v=>!!v),!f).join("/"),(f?"/":"")+o||"."},relative:(i,o)=>{i=Et.resolve(i).substr(1),o=Et.resolve(o).substr(1);function f(P){for(var L=0;L<P.length&&P[L]==="";L++);for(var X=P.length-1;X>=0&&P[X]==="";X--);return L>X?[]:P.slice(L,X-L+1)}for(var h=f(i.split("/")),p=f(o.split("/")),v=Math.min(h.length,p.length),w=v,R=0;R<v;R++)if(h[R]!==p[R]){w=R;break}for(var O=[],R=w;R<h.length;R++)O.push("..");return O=O.concat(p.slice(w)),O.join("/")}},as=[];function hn(i,o,f){var h=f>0?f:ns(i)+1,p=new Array(h),v=rs(i,p,0,p.length);return o&&(p.length=v),p}var Qf=()=>{if(!as.length){var i=null;if(d){var o=256,f=Buffer.alloc(o),h=0,p=process.stdin.fd;try{h=_.readSync(p,f,0,o)}catch(v){if(v.toString().includes("EOF"))h=0;else throw v}h>0&&(i=f.slice(0,h).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(i=window.prompt("Input: "),i!==null&&(i+=`
`));if(!i)return null;as=hn(i,!0)}return as.shift()},Ot={ttys:[],init(){},shutdown(){},register(i,o){Ot.ttys[i]={input:[],output:[],ops:o},y.registerDevice(i,Ot.stream_ops)},stream_ops:{open(i){var o=Ot.ttys[i.node.rdev];if(!o)throw new y.ErrnoError(43);i.tty=o,i.seekable=!1},close(i){i.tty.ops.fsync(i.tty)},fsync(i){i.tty.ops.fsync(i.tty)},read(i,o,f,h,p){if(!i.tty||!i.tty.ops.get_char)throw new y.ErrnoError(60);for(var v=0,w=0;w<h;w++){var R;try{R=i.tty.ops.get_char(i.tty)}catch{throw new y.ErrnoError(29)}if(R===void 0&&v===0)throw new y.ErrnoError(6);if(R==null)break;v++,o[f+w]=R}return v&&(i.node.timestamp=Date.now()),v},write(i,o,f,h,p){if(!i.tty||!i.tty.ops.put_char)throw new y.ErrnoError(60);try{for(var v=0;v<h;v++)i.tty.ops.put_char(i.tty,o[f+v])}catch{throw new y.ErrnoError(29)}return h&&(i.node.timestamp=Date.now()),v}},default_tty_ops:{get_char(i){return Qf()},put_char(i,o){o===null||o===10?(F(or(i.output,0)),i.output=[]):o!=0&&i.output.push(o)},fsync(i){i.output&&i.output.length>0&&(F(or(i.output,0)),i.output=[])},ioctl_tcgets(i){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(i,o,f){return 0},ioctl_tiocgwinsz(i){return[24,80]}},default_tty1_ops:{put_char(i,o){o===null||o===10?(D(or(i.output,0)),i.output=[]):o!=0&&i.output.push(o)},fsync(i){i.output&&i.output.length>0&&(D(or(i.output,0)),i.output=[])}}},Li=i=>{He()},ce={ops_table:null,mount(i){return ce.createNode(null,"/",16895,0)},createNode(i,o,f,h){if(y.isBlkdev(f)||y.isFIFO(f))throw new y.ErrnoError(63);ce.ops_table||={dir:{node:{getattr:ce.node_ops.getattr,setattr:ce.node_ops.setattr,lookup:ce.node_ops.lookup,mknod:ce.node_ops.mknod,rename:ce.node_ops.rename,unlink:ce.node_ops.unlink,rmdir:ce.node_ops.rmdir,readdir:ce.node_ops.readdir,symlink:ce.node_ops.symlink},stream:{llseek:ce.stream_ops.llseek}},file:{node:{getattr:ce.node_ops.getattr,setattr:ce.node_ops.setattr},stream:{llseek:ce.stream_ops.llseek,read:ce.stream_ops.read,write:ce.stream_ops.write,allocate:ce.stream_ops.allocate,mmap:ce.stream_ops.mmap,msync:ce.stream_ops.msync}},link:{node:{getattr:ce.node_ops.getattr,setattr:ce.node_ops.setattr,readlink:ce.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ce.node_ops.getattr,setattr:ce.node_ops.setattr},stream:y.chrdev_stream_ops}};var p=y.createNode(i,o,f,h);return y.isDir(p.mode)?(p.node_ops=ce.ops_table.dir.node,p.stream_ops=ce.ops_table.dir.stream,p.contents={}):y.isFile(p.mode)?(p.node_ops=ce.ops_table.file.node,p.stream_ops=ce.ops_table.file.stream,p.usedBytes=0,p.contents=null):y.isLink(p.mode)?(p.node_ops=ce.ops_table.link.node,p.stream_ops=ce.ops_table.link.stream):y.isChrdev(p.mode)&&(p.node_ops=ce.ops_table.chrdev.node,p.stream_ops=ce.ops_table.chrdev.stream),p.timestamp=Date.now(),i&&(i.contents[o]=p,i.timestamp=p.timestamp),p},getFileDataAsTypedArray(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage(i,o){var f=i.contents?i.contents.length:0;if(!(f>=o)){var h=1024*1024;o=Math.max(o,f*(f<h?2:1.125)>>>0),f!=0&&(o=Math.max(o,256));var p=i.contents;i.contents=new Uint8Array(o),i.usedBytes>0&&i.contents.set(p.subarray(0,i.usedBytes),0)}},resizeFileStorage(i,o){if(i.usedBytes!=o)if(o==0)i.contents=null,i.usedBytes=0;else{var f=i.contents;i.contents=new Uint8Array(o),f&&i.contents.set(f.subarray(0,Math.min(o,i.usedBytes))),i.usedBytes=o}},node_ops:{getattr(i){var o={};return o.dev=y.isChrdev(i.mode)?i.id:1,o.ino=i.id,o.mode=i.mode,o.nlink=1,o.uid=0,o.gid=0,o.rdev=i.rdev,y.isDir(i.mode)?o.size=4096:y.isFile(i.mode)?o.size=i.usedBytes:y.isLink(i.mode)?o.size=i.link.length:o.size=0,o.atime=new Date(i.timestamp),o.mtime=new Date(i.timestamp),o.ctime=new Date(i.timestamp),o.blksize=4096,o.blocks=Math.ceil(o.size/o.blksize),o},setattr(i,o){o.mode!==void 0&&(i.mode=o.mode),o.timestamp!==void 0&&(i.timestamp=o.timestamp),o.size!==void 0&&ce.resizeFileStorage(i,o.size)},lookup(i,o){throw y.genericErrors[44]},mknod(i,o,f,h){return ce.createNode(i,o,f,h)},rename(i,o,f){if(y.isDir(i.mode)){var h;try{h=y.lookupNode(o,f)}catch{}if(h)for(var p in h.contents)throw new y.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=f,o.contents[f]=i,o.timestamp=i.parent.timestamp},unlink(i,o){delete i.contents[o],i.timestamp=Date.now()},rmdir(i,o){var f=y.lookupNode(i,o);for(var h in f.contents)throw new y.ErrnoError(55);delete i.contents[o],i.timestamp=Date.now()},readdir(i){var o=[".",".."];for(var f of Object.keys(i.contents))o.push(f);return o},symlink(i,o,f){var h=ce.createNode(i,o,41471,0);return h.link=f,h},readlink(i){if(!y.isLink(i.mode))throw new y.ErrnoError(28);return i.link}},stream_ops:{read(i,o,f,h,p){var v=i.node.contents;if(p>=i.node.usedBytes)return 0;var w=Math.min(i.node.usedBytes-p,h);if(w>8&&v.subarray)o.set(v.subarray(p,p+w),f);else for(var R=0;R<w;R++)o[f+R]=v[p+R];return w},write(i,o,f,h,p,v){if(o.buffer===z.buffer&&(v=!1),!h)return 0;var w=i.node;if(w.timestamp=Date.now(),o.subarray&&(!w.contents||w.contents.subarray)){if(v)return w.contents=o.subarray(f,f+h),w.usedBytes=h,h;if(w.usedBytes===0&&p===0)return w.contents=o.slice(f,f+h),w.usedBytes=h,h;if(p+h<=w.usedBytes)return w.contents.set(o.subarray(f,f+h),p),h}if(ce.expandFileStorage(w,p+h),w.contents.subarray&&o.subarray)w.contents.set(o.subarray(f,f+h),p);else for(var R=0;R<h;R++)w.contents[p+R]=o[f+R];return w.usedBytes=Math.max(w.usedBytes,p+h),h},llseek(i,o,f){var h=o;if(f===1?h+=i.position:f===2&&y.isFile(i.node.mode)&&(h+=i.node.usedBytes),h<0)throw new y.ErrnoError(28);return h},allocate(i,o,f){ce.expandFileStorage(i.node,o+f),i.node.usedBytes=Math.max(i.node.usedBytes,o+f)},mmap(i,o,f,h,p){if(!y.isFile(i.node.mode))throw new y.ErrnoError(43);var v,w,R=i.node.contents;if(!(p&2)&&R.buffer===z.buffer)w=!1,v=R.byteOffset;else{if((f>0||f+o<R.length)&&(R.subarray?R=R.subarray(f,f+o):R=Array.prototype.slice.call(R,f,f+o)),w=!0,v=Li(),!v)throw new y.ErrnoError(48);z.set(R,v)}return{ptr:v,allocated:w}},msync(i,o,f,h,p){return ce.stream_ops.write(i,o,0,h,f,!1),0}}},eu=(i,o,f,h)=>{var p=h?"":`al ${i}`;I(i,v=>{o(new Uint8Array(v)),p&&yt()},v=>{if(f)f();else throw`Loading data file "${i}" failed.`}),p&&Ge()},tu=(i,o,f,h,p,v)=>{y.createDataFile(i,o,f,h,p,v)},ru=n.preloadPlugins||[],nu=(i,o,f,h)=>{typeof Browser<"u"&&Browser.init();var p=!1;return ru.forEach(v=>{p||v.canHandle(o)&&(v.handle(i,o,f,h),p=!0)}),p},su=(i,o,f,h,p,v,w,R,O,P)=>{var L=o?Et.resolve(Me.join2(i,o)):i;function X(Y){function J(Q){P?.(),R||tu(i,o,Q,h,p,O),v?.(),yt()}nu(Y,L,J,()=>{w?.(),yt()})||J(Y)}Ge(),typeof f=="string"?eu(f,X,w):X(f)},iu=i=>{var o={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},f=o[i];if(typeof f>"u")throw new Error(`Unknown file open mode: ${i}`);return f},os=(i,o)=>{var f=0;return i&&(f|=365),o&&(f|=146),f},y={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(i){this.name="ErrnoError",this.errno=i}},genericErrors:{},filesystems:null,syncFSRequests:0,FSStream:class{constructor(){this.shared={}}get object(){return this.node}set object(i){this.node=i}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(i){this.shared.flags=i}get position(){return this.shared.position}set position(i){this.shared.position=i}},FSNode:class{constructor(i,o,f,h){i||(i=this),this.parent=i,this.mount=i.mount,this.mounted=null,this.id=y.nextInode++,this.name=o,this.mode=f,this.node_ops={},this.stream_ops={},this.rdev=h,this.readMode=365,this.writeMode=146}get read(){return(this.mode&this.readMode)===this.readMode}set read(i){i?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(i){i?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return y.isDir(this.mode)}get isDevice(){return y.isChrdev(this.mode)}},lookupPath(i,o={}){if(i=Et.resolve(i),!i)return{path:"",node:null};var f={follow_mount:!0,recurse_count:0};if(o=Object.assign(f,o),o.recurse_count>8)throw new y.ErrnoError(32);for(var h=i.split("/").filter(X=>!!X),p=y.root,v="/",w=0;w<h.length;w++){var R=w===h.length-1;if(R&&o.parent)break;if(p=y.lookupNode(p,h[w]),v=Me.join2(v,h[w]),y.isMountpoint(p)&&(!R||R&&o.follow_mount)&&(p=p.mounted.root),!R||o.follow)for(var O=0;y.isLink(p.mode);){var P=y.readlink(v);v=Et.resolve(Me.dirname(v),P);var L=y.lookupPath(v,{recurse_count:o.recurse_count+1});if(p=L.node,O++>40)throw new y.ErrnoError(32)}}return{path:v,node:p}},getPath(i){for(var o;;){if(y.isRoot(i)){var f=i.mount.mountpoint;return o?f[f.length-1]!=="/"?`${f}/${o}`:f+o:f}o=o?`${i.name}/${o}`:i.name,i=i.parent}},hashName(i,o){for(var f=0,h=0;h<o.length;h++)f=(f<<5)-f+o.charCodeAt(h)|0;return(i+f>>>0)%y.nameTable.length},hashAddNode(i){var o=y.hashName(i.parent.id,i.name);i.name_next=y.nameTable[o],y.nameTable[o]=i},hashRemoveNode(i){var o=y.hashName(i.parent.id,i.name);if(y.nameTable[o]===i)y.nameTable[o]=i.name_next;else for(var f=y.nameTable[o];f;){if(f.name_next===i){f.name_next=i.name_next;break}f=f.name_next}},lookupNode(i,o){var f=y.mayLookup(i);if(f)throw new y.ErrnoError(f);for(var h=y.hashName(i.id,o),p=y.nameTable[h];p;p=p.name_next){var v=p.name;if(p.parent.id===i.id&&v===o)return p}return y.lookup(i,o)},createNode(i,o,f,h){var p=new y.FSNode(i,o,f,h);return y.hashAddNode(p),p},destroyNode(i){y.hashRemoveNode(i)},isRoot(i){return i===i.parent},isMountpoint(i){return!!i.mounted},isFile(i){return(i&61440)===32768},isDir(i){return(i&61440)===16384},isLink(i){return(i&61440)===40960},isChrdev(i){return(i&61440)===8192},isBlkdev(i){return(i&61440)===24576},isFIFO(i){return(i&61440)===4096},isSocket(i){return(i&49152)===49152},flagsToPermissionString(i){var o=["r","w","rw"][i&3];return i&512&&(o+="w"),o},nodePermissions(i,o){return y.ignorePermissions?0:o.includes("r")&&!(i.mode&292)||o.includes("w")&&!(i.mode&146)||o.includes("x")&&!(i.mode&73)?2:0},mayLookup(i){if(!y.isDir(i.mode))return 54;var o=y.nodePermissions(i,"x");return o||(i.node_ops.lookup?0:2)},mayCreate(i,o){try{var f=y.lookupNode(i,o);return 20}catch{}return y.nodePermissions(i,"wx")},mayDelete(i,o,f){var h;try{h=y.lookupNode(i,o)}catch(v){return v.errno}var p=y.nodePermissions(i,"wx");if(p)return p;if(f){if(!y.isDir(h.mode))return 54;if(y.isRoot(h)||y.getPath(h)===y.cwd())return 10}else if(y.isDir(h.mode))return 31;return 0},mayOpen(i,o){return i?y.isLink(i.mode)?32:y.isDir(i.mode)&&(y.flagsToPermissionString(o)!=="r"||o&512)?31:y.nodePermissions(i,y.flagsToPermissionString(o)):44},MAX_OPEN_FDS:4096,nextfd(){for(var i=0;i<=y.MAX_OPEN_FDS;i++)if(!y.streams[i])return i;throw new y.ErrnoError(33)},getStreamChecked(i){var o=y.getStream(i);if(!o)throw new y.ErrnoError(8);return o},getStream:i=>y.streams[i],createStream(i,o=-1){return i=Object.assign(new y.FSStream,i),o==-1&&(o=y.nextfd()),i.fd=o,y.streams[o]=i,i},closeStream(i){y.streams[i]=null},dupStream(i,o=-1){var f=y.createStream(i,o);return f.stream_ops?.dup?.(f),f},chrdev_stream_ops:{open(i){var o=y.getDevice(i.node.rdev);i.stream_ops=o.stream_ops,i.stream_ops.open?.(i)},llseek(){throw new y.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,o)=>i<<8|o,registerDevice(i,o){y.devices[i]={stream_ops:o}},getDevice:i=>y.devices[i],getMounts(i){for(var o=[],f=[i];f.length;){var h=f.pop();o.push(h),f.push(...h.mounts)}return o},syncfs(i,o){typeof i=="function"&&(o=i,i=!1),y.syncFSRequests++,y.syncFSRequests>1&&D(`warning: ${y.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var f=y.getMounts(y.root.mount),h=0;function p(w){return y.syncFSRequests--,o(w)}function v(w){if(w)return v.errored?void 0:(v.errored=!0,p(w));++h>=f.length&&p(null)}f.forEach(w=>{if(!w.type.syncfs)return v(null);w.type.syncfs(w,i,v)})},mount(i,o,f){var h=f==="/",p=!f,v;if(h&&y.root)throw new y.ErrnoError(10);if(!h&&!p){var w=y.lookupPath(f,{follow_mount:!1});if(f=w.path,v=w.node,y.isMountpoint(v))throw new y.ErrnoError(10);if(!y.isDir(v.mode))throw new y.ErrnoError(54)}var R={type:i,opts:o,mountpoint:f,mounts:[]},O=i.mount(R);return O.mount=R,R.root=O,h?y.root=O:v&&(v.mounted=R,v.mount&&v.mount.mounts.push(R)),O},unmount(i){var o=y.lookupPath(i,{follow_mount:!1});if(!y.isMountpoint(o.node))throw new y.ErrnoError(28);var f=o.node,h=f.mounted,p=y.getMounts(h);Object.keys(y.nameTable).forEach(w=>{for(var R=y.nameTable[w];R;){var O=R.name_next;p.includes(R.mount)&&y.destroyNode(R),R=O}}),f.mounted=null;var v=f.mount.mounts.indexOf(h);f.mount.mounts.splice(v,1)},lookup(i,o){return i.node_ops.lookup(i,o)},mknod(i,o,f){var h=y.lookupPath(i,{parent:!0}),p=h.node,v=Me.basename(i);if(!v||v==="."||v==="..")throw new y.ErrnoError(28);var w=y.mayCreate(p,v);if(w)throw new y.ErrnoError(w);if(!p.node_ops.mknod)throw new y.ErrnoError(63);return p.node_ops.mknod(p,v,o,f)},create(i,o){return o=o!==void 0?o:438,o&=4095,o|=32768,y.mknod(i,o,0)},mkdir(i,o){return o=o!==void 0?o:511,o&=1023,o|=16384,y.mknod(i,o,0)},mkdirTree(i,o){for(var f=i.split("/"),h="",p=0;p<f.length;++p)if(f[p]){h+="/"+f[p];try{y.mkdir(h,o)}catch(v){if(v.errno!=20)throw v}}},mkdev(i,o,f){return typeof f>"u"&&(f=o,o=438),o|=8192,y.mknod(i,o,f)},symlink(i,o){if(!Et.resolve(i))throw new y.ErrnoError(44);var f=y.lookupPath(o,{parent:!0}),h=f.node;if(!h)throw new y.ErrnoError(44);var p=Me.basename(o),v=y.mayCreate(h,p);if(v)throw new y.ErrnoError(v);if(!h.node_ops.symlink)throw new y.ErrnoError(63);return h.node_ops.symlink(h,p,i)},rename(i,o){var f=Me.dirname(i),h=Me.dirname(o),p=Me.basename(i),v=Me.basename(o),w,R,O;if(w=y.lookupPath(i,{parent:!0}),R=w.node,w=y.lookupPath(o,{parent:!0}),O=w.node,!R||!O)throw new y.ErrnoError(44);if(R.mount!==O.mount)throw new y.ErrnoError(75);var P=y.lookupNode(R,p),L=Et.relative(i,h);if(L.charAt(0)!==".")throw new y.ErrnoError(28);if(L=Et.relative(o,f),L.charAt(0)!==".")throw new y.ErrnoError(55);var X;try{X=y.lookupNode(O,v)}catch{}if(P!==X){var Y=y.isDir(P.mode),J=y.mayDelete(R,p,Y);if(J)throw new y.ErrnoError(J);if(J=X?y.mayDelete(O,v,Y):y.mayCreate(O,v),J)throw new y.ErrnoError(J);if(!R.node_ops.rename)throw new y.ErrnoError(63);if(y.isMountpoint(P)||X&&y.isMountpoint(X))throw new y.ErrnoError(10);if(O!==R&&(J=y.nodePermissions(R,"w"),J))throw new y.ErrnoError(J);y.hashRemoveNode(P);try{R.node_ops.rename(P,O,v),P.parent=O}catch(Q){throw Q}finally{y.hashAddNode(P)}}},rmdir(i){var o=y.lookupPath(i,{parent:!0}),f=o.node,h=Me.basename(i),p=y.lookupNode(f,h),v=y.mayDelete(f,h,!0);if(v)throw new y.ErrnoError(v);if(!f.node_ops.rmdir)throw new y.ErrnoError(63);if(y.isMountpoint(p))throw new y.ErrnoError(10);f.node_ops.rmdir(f,h),y.destroyNode(p)},readdir(i){var o=y.lookupPath(i,{follow:!0}),f=o.node;if(!f.node_ops.readdir)throw new y.ErrnoError(54);return f.node_ops.readdir(f)},unlink(i){var o=y.lookupPath(i,{parent:!0}),f=o.node;if(!f)throw new y.ErrnoError(44);var h=Me.basename(i),p=y.lookupNode(f,h),v=y.mayDelete(f,h,!1);if(v)throw new y.ErrnoError(v);if(!f.node_ops.unlink)throw new y.ErrnoError(63);if(y.isMountpoint(p))throw new y.ErrnoError(10);f.node_ops.unlink(f,h),y.destroyNode(p)},readlink(i){var o=y.lookupPath(i),f=o.node;if(!f)throw new y.ErrnoError(44);if(!f.node_ops.readlink)throw new y.ErrnoError(28);return Et.resolve(y.getPath(f.parent),f.node_ops.readlink(f))},stat(i,o){var f=y.lookupPath(i,{follow:!o}),h=f.node;if(!h)throw new y.ErrnoError(44);if(!h.node_ops.getattr)throw new y.ErrnoError(63);return h.node_ops.getattr(h)},lstat(i){return y.stat(i,!0)},chmod(i,o,f){var h;if(typeof i=="string"){var p=y.lookupPath(i,{follow:!f});h=p.node}else h=i;if(!h.node_ops.setattr)throw new y.ErrnoError(63);h.node_ops.setattr(h,{mode:o&4095|h.mode&-4096,timestamp:Date.now()})},lchmod(i,o){y.chmod(i,o,!0)},fchmod(i,o){var f=y.getStreamChecked(i);y.chmod(f.node,o)},chown(i,o,f,h){var p;if(typeof i=="string"){var v=y.lookupPath(i,{follow:!h});p=v.node}else p=i;if(!p.node_ops.setattr)throw new y.ErrnoError(63);p.node_ops.setattr(p,{timestamp:Date.now()})},lchown(i,o,f){y.chown(i,o,f,!0)},fchown(i,o,f){var h=y.getStreamChecked(i);y.chown(h.node,o,f)},truncate(i,o){if(o<0)throw new y.ErrnoError(28);var f;if(typeof i=="string"){var h=y.lookupPath(i,{follow:!0});f=h.node}else f=i;if(!f.node_ops.setattr)throw new y.ErrnoError(63);if(y.isDir(f.mode))throw new y.ErrnoError(31);if(!y.isFile(f.mode))throw new y.ErrnoError(28);var p=y.nodePermissions(f,"w");if(p)throw new y.ErrnoError(p);f.node_ops.setattr(f,{size:o,timestamp:Date.now()})},ftruncate(i,o){var f=y.getStreamChecked(i);if(!(f.flags&2097155))throw new y.ErrnoError(28);y.truncate(f.node,o)},utime(i,o,f){var h=y.lookupPath(i,{follow:!0}),p=h.node;p.node_ops.setattr(p,{timestamp:Math.max(o,f)})},open(i,o,f){if(i==="")throw new y.ErrnoError(44);o=typeof o=="string"?iu(o):o,o&64?(f=typeof f>"u"?438:f,f=f&4095|32768):f=0;var h;if(typeof i=="object")h=i;else{i=Me.normalize(i);try{var p=y.lookupPath(i,{follow:!(o&131072)});h=p.node}catch{}}var v=!1;if(o&64)if(h){if(o&128)throw new y.ErrnoError(20)}else h=y.mknod(i,f,0),v=!0;if(!h)throw new y.ErrnoError(44);if(y.isChrdev(h.mode)&&(o&=-513),o&65536&&!y.isDir(h.mode))throw new y.ErrnoError(54);if(!v){var w=y.mayOpen(h,o);if(w)throw new y.ErrnoError(w)}o&512&&!v&&y.truncate(h,0),o&=-131713;var R=y.createStream({node:h,path:y.getPath(h),flags:o,seekable:!0,position:0,stream_ops:h.stream_ops,ungotten:[],error:!1});return R.stream_ops.open&&R.stream_ops.open(R),n.logReadFiles&&!(o&1)&&(y.readFiles||(y.readFiles={}),i in y.readFiles||(y.readFiles[i]=1)),R},close(i){if(y.isClosed(i))throw new y.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(o){throw o}finally{y.closeStream(i.fd)}i.fd=null},isClosed(i){return i.fd===null},llseek(i,o,f){if(y.isClosed(i))throw new y.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new y.ErrnoError(70);if(f!=0&&f!=1&&f!=2)throw new y.ErrnoError(28);return i.position=i.stream_ops.llseek(i,o,f),i.ungotten=[],i.position},read(i,o,f,h,p){if(h<0||p<0)throw new y.ErrnoError(28);if(y.isClosed(i))throw new y.ErrnoError(8);if((i.flags&2097155)===1)throw new y.ErrnoError(8);if(y.isDir(i.node.mode))throw new y.ErrnoError(31);if(!i.stream_ops.read)throw new y.ErrnoError(28);var v=typeof p<"u";if(!v)p=i.position;else if(!i.seekable)throw new y.ErrnoError(70);var w=i.stream_ops.read(i,o,f,h,p);return v||(i.position+=w),w},write(i,o,f,h,p,v){if(h<0||p<0)throw new y.ErrnoError(28);if(y.isClosed(i))throw new y.ErrnoError(8);if(!(i.flags&2097155))throw new y.ErrnoError(8);if(y.isDir(i.node.mode))throw new y.ErrnoError(31);if(!i.stream_ops.write)throw new y.ErrnoError(28);i.seekable&&i.flags&1024&&y.llseek(i,0,2);var w=typeof p<"u";if(!w)p=i.position;else if(!i.seekable)throw new y.ErrnoError(70);var R=i.stream_ops.write(i,o,f,h,p,v);return w||(i.position+=R),R},allocate(i,o,f){if(y.isClosed(i))throw new y.ErrnoError(8);if(o<0||f<=0)throw new y.ErrnoError(28);if(!(i.flags&2097155))throw new y.ErrnoError(8);if(!y.isFile(i.node.mode)&&!y.isDir(i.node.mode))throw new y.ErrnoError(43);if(!i.stream_ops.allocate)throw new y.ErrnoError(138);i.stream_ops.allocate(i,o,f)},mmap(i,o,f,h,p){if(h&2&&!(p&2)&&(i.flags&2097155)!==2)throw new y.ErrnoError(2);if((i.flags&2097155)===1)throw new y.ErrnoError(2);if(!i.stream_ops.mmap)throw new y.ErrnoError(43);return i.stream_ops.mmap(i,o,f,h,p)},msync(i,o,f,h,p){return i.stream_ops.msync?i.stream_ops.msync(i,o,f,h,p):0},ioctl(i,o,f){if(!i.stream_ops.ioctl)throw new y.ErrnoError(59);return i.stream_ops.ioctl(i,o,f)},readFile(i,o={}){if(o.flags=o.flags||0,o.encoding=o.encoding||"binary",o.encoding!=="utf8"&&o.encoding!=="binary")throw new Error(`Invalid encoding type "${o.encoding}"`);var f,h=y.open(i,o.flags),p=y.stat(i),v=p.size,w=new Uint8Array(v);return y.read(h,w,0,v,0),o.encoding==="utf8"?f=or(w,0):o.encoding==="binary"&&(f=w),y.close(h),f},writeFile(i,o,f={}){f.flags=f.flags||577;var h=y.open(i,f.flags,f.mode);if(typeof o=="string"){var p=new Uint8Array(ns(o)+1),v=rs(o,p,0,p.length);y.write(h,p,0,v,void 0,f.canOwn)}else if(ArrayBuffer.isView(o))y.write(h,o,0,o.byteLength,void 0,f.canOwn);else throw new Error("Unsupported data type");y.close(h)},cwd:()=>y.currentPath,chdir(i){var o=y.lookupPath(i,{follow:!0});if(o.node===null)throw new y.ErrnoError(44);if(!y.isDir(o.node.mode))throw new y.ErrnoError(54);var f=y.nodePermissions(o.node,"x");if(f)throw new y.ErrnoError(f);y.currentPath=o.path},createDefaultDirectories(){y.mkdir("/tmp"),y.mkdir("/home"),y.mkdir("/home/web_user")},createDefaultDevices(){y.mkdir("/dev"),y.registerDevice(y.makedev(1,3),{read:()=>0,write:(h,p,v,w,R)=>w}),y.mkdev("/dev/null",y.makedev(1,3)),Ot.register(y.makedev(5,0),Ot.default_tty_ops),Ot.register(y.makedev(6,0),Ot.default_tty1_ops),y.mkdev("/dev/tty",y.makedev(5,0)),y.mkdev("/dev/tty1",y.makedev(6,0));var i=new Uint8Array(1024),o=0,f=()=>(o===0&&(o=Ui(i).byteLength),i[--o]);y.createDevice("/dev","random",f),y.createDevice("/dev","urandom",f),y.mkdir("/dev/shm"),y.mkdir("/dev/shm/tmp")},createSpecialDirectories(){y.mkdir("/proc");var i=y.mkdir("/proc/self");y.mkdir("/proc/self/fd"),y.mount({mount(){var o=y.createNode(i,"fd",16895,73);return o.node_ops={lookup(f,h){var p=+h,v=y.getStreamChecked(p),w={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>v.path}};return w.parent=w,w}},o}},{},"/proc/self/fd")},createStandardStreams(){n.stdin?y.createDevice("/dev","stdin",n.stdin):y.symlink("/dev/tty","/dev/stdin"),n.stdout?y.createDevice("/dev","stdout",null,n.stdout):y.symlink("/dev/tty","/dev/stdout"),n.stderr?y.createDevice("/dev","stderr",null,n.stderr):y.symlink("/dev/tty1","/dev/stderr"),y.open("/dev/stdin",0),y.open("/dev/stdout",1),y.open("/dev/stderr",1)},staticInit(){[44].forEach(i=>{y.genericErrors[i]=new y.ErrnoError(i),y.genericErrors[i].stack="<generic error, no stack>"}),y.nameTable=new Array(4096),y.mount(ce,{},"/"),y.createDefaultDirectories(),y.createDefaultDevices(),y.createSpecialDirectories(),y.filesystems={MEMFS:ce}},init(i,o,f){y.init.initialized=!0,n.stdin=i||n.stdin,n.stdout=o||n.stdout,n.stderr=f||n.stderr,y.createStandardStreams()},quit(){y.init.initialized=!1;for(var i=0;i<y.streams.length;i++){var o=y.streams[i];o&&y.close(o)}},findObject(i,o){var f=y.analyzePath(i,o);return f.exists?f.object:null},analyzePath(i,o){try{var f=y.lookupPath(i,{follow:!o});i=f.path}catch{}var h={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var f=y.lookupPath(i,{parent:!0});h.parentExists=!0,h.parentPath=f.path,h.parentObject=f.node,h.name=Me.basename(i),f=y.lookupPath(i,{follow:!o}),h.exists=!0,h.path=f.path,h.object=f.node,h.name=f.node.name,h.isRoot=f.path==="/"}catch(p){h.error=p.errno}return h},createPath(i,o,f,h){i=typeof i=="string"?i:y.getPath(i);for(var p=o.split("/").reverse();p.length;){var v=p.pop();if(v){var w=Me.join2(i,v);try{y.mkdir(w)}catch{}i=w}}return w},createFile(i,o,f,h,p){var v=Me.join2(typeof i=="string"?i:y.getPath(i),o),w=os(h,p);return y.create(v,w)},createDataFile(i,o,f,h,p,v){var w=o;i&&(i=typeof i=="string"?i:y.getPath(i),w=o?Me.join2(i,o):i);var R=os(h,p),O=y.create(w,R);if(f){if(typeof f=="string"){for(var P=new Array(f.length),L=0,X=f.length;L<X;++L)P[L]=f.charCodeAt(L);f=P}y.chmod(O,R|146);var Y=y.open(O,577);y.write(Y,f,0,f.length,0,v),y.close(Y),y.chmod(O,R)}},createDevice(i,o,f,h){var p=Me.join2(typeof i=="string"?i:y.getPath(i),o),v=os(!!f,!!h);y.createDevice.major||(y.createDevice.major=64);var w=y.makedev(y.createDevice.major++,0);return y.registerDevice(w,{open(R){R.seekable=!1},close(R){h?.buffer?.length&&h(10)},read(R,O,P,L,X){for(var Y=0,J=0;J<L;J++){var Q;try{Q=f()}catch{throw new y.ErrnoError(29)}if(Q===void 0&&Y===0)throw new y.ErrnoError(6);if(Q==null)break;Y++,O[P+J]=Q}return Y&&(R.node.timestamp=Date.now()),Y},write(R,O,P,L,X){for(var Y=0;Y<L;Y++)try{h(O[P+Y])}catch{throw new y.ErrnoError(29)}return L&&(R.node.timestamp=Date.now()),Y}}),y.mkdev(p,v,w)},forceLoadFile(i){if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(m)try{i.contents=hn(m(i.url),!0),i.usedBytes=i.contents.length}catch{throw new y.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile(i,o,f,h,p){class v{constructor(){this.lengthKnown=!1,this.chunks=[]}get(J){if(!(J>this.length-1||J<0)){var Q=J%this.chunkSize,pe=J/this.chunkSize|0;return this.getter(pe)[Q]}}setDataGetter(J){this.getter=J}cacheLength(){var J=new XMLHttpRequest;if(J.open("HEAD",f,!1),J.send(null),!(J.status>=200&&J.status<300||J.status===304))throw new Error("Couldn't load "+f+". Status: "+J.status);var Q=Number(J.getResponseHeader("Content-length")),pe,we=(pe=J.getResponseHeader("Accept-Ranges"))&&pe==="bytes",C=(pe=J.getResponseHeader("Content-Encoding"))&&pe==="gzip",S=1024*1024;we||(S=Q);var $=(Z,de)=>{if(Z>de)throw new Error("invalid range ("+Z+", "+de+") or no bytes requested!");if(de>Q-1)throw new Error("only "+Q+" bytes available! programmer error!");var le=new XMLHttpRequest;if(le.open("GET",f,!1),Q!==S&&le.setRequestHeader("Range","bytes="+Z+"-"+de),le.responseType="arraybuffer",le.overrideMimeType&&le.overrideMimeType("text/plain; charset=x-user-defined"),le.send(null),!(le.status>=200&&le.status<300||le.status===304))throw new Error("Couldn't load "+f+". Status: "+le.status);return le.response!==void 0?new Uint8Array(le.response||[]):hn(le.responseText||"",!0)},j=this;j.setDataGetter(Z=>{var de=Z*S,le=(Z+1)*S-1;if(le=Math.min(le,Q-1),typeof j.chunks[Z]>"u"&&(j.chunks[Z]=$(de,le)),typeof j.chunks[Z]>"u")throw new Error("doXHR failed!");return j.chunks[Z]}),(C||!Q)&&(S=Q=1,Q=this.getter(0).length,S=Q,F("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=Q,this._chunkSize=S,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!u)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var w=new v,R={isDevice:!1,contents:w}}else var R={isDevice:!1,url:f};var O=y.createFile(i,o,R,h,p);R.contents?O.contents=R.contents:R.url&&(O.contents=null,O.url=R.url),Object.defineProperties(O,{usedBytes:{get:function(){return this.contents.length}}});var P={},L=Object.keys(O.stream_ops);L.forEach(Y=>{var J=O.stream_ops[Y];P[Y]=(...Q)=>(y.forceLoadFile(O),J(...Q))});function X(Y,J,Q,pe,we){var C=Y.node.contents;if(we>=C.length)return 0;var S=Math.min(C.length-we,pe);if(C.slice)for(var $=0;$<S;$++)J[Q+$]=C[we+$];else for(var $=0;$<S;$++)J[Q+$]=C.get(we+$);return S}return P.read=(Y,J,Q,pe,we)=>(y.forceLoadFile(O),X(Y,J,Q,pe,we)),P.mmap=(Y,J,Q,pe,we)=>{y.forceLoadFile(O);var C=Li();if(!C)throw new y.ErrnoError(48);return X(Y,z,C,J,Q),{ptr:C,allocated:!0}},O.stream_ops=P,O}},Ar={DEFAULT_POLLMASK:5,calculateAt(i,o,f){if(Me.isAbs(o))return o;var h;if(i===-100)h=y.cwd();else{var p=Ar.getStreamFromFD(i);h=p.path}if(o.length==0){if(!f)throw new y.ErrnoError(44);return h}return Me.join2(h,o)},doStat(i,o,f){var h=i(o);k[f>>2]=h.dev,k[f+4>>2]=h.mode,q[f+8>>2]=h.nlink,k[f+12>>2]=h.uid,k[f+16>>2]=h.gid,k[f+20>>2]=h.rdev,Le=[h.size>>>0,(he=h.size,+Math.abs(he)>=1?he>0?+Math.floor(he/4294967296)>>>0:~~+Math.ceil((he-+(~~he>>>0))/4294967296)>>>0:0)],k[f+24>>2]=Le[0],k[f+28>>2]=Le[1],k[f+32>>2]=4096,k[f+36>>2]=h.blocks;var p=h.atime.getTime(),v=h.mtime.getTime(),w=h.ctime.getTime();return Le=[Math.floor(p/1e3)>>>0,(he=Math.floor(p/1e3),+Math.abs(he)>=1?he>0?+Math.floor(he/4294967296)>>>0:~~+Math.ceil((he-+(~~he>>>0))/4294967296)>>>0:0)],k[f+40>>2]=Le[0],k[f+44>>2]=Le[1],q[f+48>>2]=p%1e3*1e3,Le=[Math.floor(v/1e3)>>>0,(he=Math.floor(v/1e3),+Math.abs(he)>=1?he>0?+Math.floor(he/4294967296)>>>0:~~+Math.ceil((he-+(~~he>>>0))/4294967296)>>>0:0)],k[f+56>>2]=Le[0],k[f+60>>2]=Le[1],q[f+64>>2]=v%1e3*1e3,Le=[Math.floor(w/1e3)>>>0,(he=Math.floor(w/1e3),+Math.abs(he)>=1?he>0?+Math.floor(he/4294967296)>>>0:~~+Math.ceil((he-+(~~he>>>0))/4294967296)>>>0:0)],k[f+72>>2]=Le[0],k[f+76>>2]=Le[1],q[f+80>>2]=w%1e3*1e3,Le=[h.ino>>>0,(he=h.ino,+Math.abs(he)>=1?he>0?+Math.floor(he/4294967296)>>>0:~~+Math.ceil((he-+(~~he>>>0))/4294967296)>>>0:0)],k[f+88>>2]=Le[0],k[f+92>>2]=Le[1],0},doMsync(i,o,f,h,p){if(!y.isFile(o.node.mode))throw new y.ErrnoError(43);if(h&2)return 0;var v=G.slice(i,i+f);y.msync(o,v,p,f,h)},getStreamFromFD(i){var o=y.getStreamChecked(i);return o},varargs:void 0,getStr(i){var o=un(i);return o}};function au(i){try{var o=Ar.getStreamFromFD(i);return y.close(o),0}catch(f){if(typeof y>"u"||f.name!=="ErrnoError")throw f;return f.errno}}var ou=(i,o,f,h)=>{for(var p=0,v=0;v<f;v++){var w=q[o>>2],R=q[o+4>>2];o+=8;var O=y.read(i,z,w,R,h);if(O<0)return-1;if(p+=O,O<R)break;typeof h<"u"&&(h+=O)}return p};function cu(i,o,f,h){try{var p=Ar.getStreamFromFD(i),v=ou(p,o,f);return q[h>>2]=v,0}catch(w){if(typeof y>"u"||w.name!=="ErrnoError")throw w;return w.errno}}var lu=(i,o)=>o+2097152>>>0<4194305-!!i?(i>>>0)+o*4294967296:NaN;function fu(i,o,f,h,p){var v=lu(o,f);try{if(isNaN(v))return 61;var w=Ar.getStreamFromFD(i);return y.llseek(w,v,h),Le=[w.position>>>0,(he=w.position,+Math.abs(he)>=1?he>0?+Math.floor(he/4294967296)>>>0:~~+Math.ceil((he-+(~~he>>>0))/4294967296)>>>0:0)],k[p>>2]=Le[0],k[p+4>>2]=Le[1],w.getdents&&v===0&&h===0&&(w.getdents=null),0}catch(R){if(typeof y>"u"||R.name!=="ErrnoError")throw R;return R.errno}}var uu=(i,o,f,h)=>{for(var p=0,v=0;v<f;v++){var w=q[o>>2],R=q[o+4>>2];o+=8;var O=y.write(i,z,w,R,h);if(O<0)return-1;p+=O,typeof h<"u"&&(h+=O)}return p};function hu(i,o,f,h){try{var p=Ar.getStreamFromFD(i),v=uu(p,o,f);return q[h>>2]=v,0}catch(w){if(typeof y>"u"||w.name!=="ErrnoError")throw w;return w.errno}}var dn=i=>i%4===0&&(i%100!==0||i%400===0),du=(i,o)=>{for(var f=0,h=0;h<=o;f+=i[h++]);return f},Bi=[31,29,31,30,31,30,31,31,30,31,30,31],ji=[31,28,31,30,31,30,31,31,30,31,30,31],pu=(i,o)=>{for(var f=new Date(i.getTime());o>0;){var h=dn(f.getFullYear()),p=f.getMonth(),v=(h?Bi:ji)[p];if(o>v-f.getDate())o-=v-f.getDate()+1,f.setDate(1),p<11?f.setMonth(p+1):(f.setMonth(0),f.setFullYear(f.getFullYear()+1));else return f.setDate(f.getDate()+o),f}return f},gu=(i,o)=>{z.set(i,o)},mu=(i,o,f,h)=>{var p=q[h+40>>2],v={tm_sec:k[h>>2],tm_min:k[h+4>>2],tm_hour:k[h+8>>2],tm_mday:k[h+12>>2],tm_mon:k[h+16>>2],tm_year:k[h+20>>2],tm_wday:k[h+24>>2],tm_yday:k[h+28>>2],tm_isdst:k[h+32>>2],tm_gmtoff:k[h+36>>2],tm_zone:p?un(p):""},w=un(f),R={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var O in R)w=w.replace(new RegExp(O,"g"),R[O]);var P=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],L=["January","February","March","April","May","June","July","August","September","October","November","December"];function X(S,$,j){for(var Z=typeof S=="number"?S.toString():S||"";Z.length<$;)Z=j[0]+Z;return Z}function Y(S,$){return X(S,$,"0")}function J(S,$){function j(de){return de<0?-1:de>0?1:0}var Z;return(Z=j(S.getFullYear()-$.getFullYear()))===0&&(Z=j(S.getMonth()-$.getMonth()))===0&&(Z=j(S.getDate()-$.getDate())),Z}function Q(S){switch(S.getDay()){case 0:return new Date(S.getFullYear()-1,11,29);case 1:return S;case 2:return new Date(S.getFullYear(),0,3);case 3:return new Date(S.getFullYear(),0,2);case 4:return new Date(S.getFullYear(),0,1);case 5:return new Date(S.getFullYear()-1,11,31);case 6:return new Date(S.getFullYear()-1,11,30)}}function pe(S){var $=pu(new Date(S.tm_year+1900,0,1),S.tm_yday),j=new Date($.getFullYear(),0,4),Z=new Date($.getFullYear()+1,0,4),de=Q(j),le=Q(Z);return J(de,$)<=0?J(le,$)<=0?$.getFullYear()+1:$.getFullYear():$.getFullYear()-1}var we={"%a":S=>P[S.tm_wday].substring(0,3),"%A":S=>P[S.tm_wday],"%b":S=>L[S.tm_mon].substring(0,3),"%B":S=>L[S.tm_mon],"%C":S=>{var $=S.tm_year+1900;return Y($/100|0,2)},"%d":S=>Y(S.tm_mday,2),"%e":S=>X(S.tm_mday,2," "),"%g":S=>pe(S).toString().substring(2),"%G":pe,"%H":S=>Y(S.tm_hour,2),"%I":S=>{var $=S.tm_hour;return $==0?$=12:$>12&&($-=12),Y($,2)},"%j":S=>Y(S.tm_mday+du(dn(S.tm_year+1900)?Bi:ji,S.tm_mon-1),3),"%m":S=>Y(S.tm_mon+1,2),"%M":S=>Y(S.tm_min,2),"%n":()=>`
`,"%p":S=>S.tm_hour>=0&&S.tm_hour<12?"AM":"PM","%S":S=>Y(S.tm_sec,2),"%t":()=>"	","%u":S=>S.tm_wday||7,"%U":S=>{var $=S.tm_yday+7-S.tm_wday;return Y(Math.floor($/7),2)},"%V":S=>{var $=Math.floor((S.tm_yday+7-(S.tm_wday+6)%7)/7);if((S.tm_wday+371-S.tm_yday-2)%7<=2&&$++,$){if($==53){var Z=(S.tm_wday+371-S.tm_yday)%7;Z!=4&&(Z!=3||!dn(S.tm_year))&&($=1)}}else{$=52;var j=(S.tm_wday+7-S.tm_yday-1)%7;(j==4||j==5&&dn(S.tm_year%400-1))&&$++}return Y($,2)},"%w":S=>S.tm_wday,"%W":S=>{var $=S.tm_yday+7-(S.tm_wday+6)%7;return Y(Math.floor($/7),2)},"%y":S=>(S.tm_year+1900).toString().substring(2),"%Y":S=>S.tm_year+1900,"%z":S=>{var $=S.tm_gmtoff,j=$>=0;return $=Math.abs($)/60,$=$/60*100+$%60,(j?"+":"-")+("0000"+$).slice(-4)},"%Z":S=>S.tm_zone,"%%":()=>"%"};w=w.replace(/%%/g,"\0\0");for(var O in we)w.includes(O)&&(w=w.replace(new RegExp(O,"g"),we[O](v)));w=w.replace(/\0\0/g,"%");var C=hn(w,!1);return C.length>o?0:(gu(C,i),C.length-1)},vu=(i,o,f,h,p)=>mu(i,o,f,h),Vi=(i,o)=>{i<128?o.push(i):o.push(i%128|128,i>>7)},yu=i=>{for(var o={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},f={parameters:[],results:i[0]=="v"?[]:[o[i[0]]]},h=1;h<i.length;++h)f.parameters.push(o[i[h]]);return f},xu=(i,o)=>{var f=i.slice(0,1),h=i.slice(1),p={i:127,p:127,j:126,f:125,d:124,e:111};o.push(96),Vi(h.length,o);for(var v=0;v<h.length;++v)o.push(p[h[v]]);f=="v"?o.push(0):o.push(1,p[f])},Tu=(i,o)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(yu(o),i);var f=[1];xu(o,f);var h=[0,97,115,109,1,0,0,0,1];Vi(f.length,h),h.push(...f),h.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var p=new WebAssembly.Module(new Uint8Array(h)),v=new WebAssembly.Instance(p,{e:{f:i}}),w=v.exports.f;return w},Eu=(i,o)=>{if(Dt)for(var f=i;f<i+o;f++){var h=ne(f);h&&Dt.set(h,f)}},Dt,wu=i=>(Dt||(Dt=new WeakMap,Eu(0,Ft.length)),Dt.get(i)||0),cs=[],Mu=()=>{if(cs.length)return cs.pop();try{Ft.grow(1)}catch(i){throw i instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":i}return Ft.length-1},ls=(i,o)=>{Ft.set(i,o),Rr[i]=Ft.get(i)},Sr=(i,o)=>{var f=wu(i);if(f)return f;var h=Mu();try{ls(h,i)}catch(v){if(!(v instanceof TypeError))throw v;var p=Tu(i,o);ls(h,p)}return Dt.set(i,h),h},Ir=i=>{Dt.delete(ne(i)),ls(i,null),cs.push(i)};Ti=n.InternalError=class extends Error{constructor(o){super(o),this.name="InternalError"}},Il(),ir=n.BindingError=class extends Error{constructor(o){super(o),this.name="BindingError"}},jl(),kl(),Yl(),Si=n.UnboundTypeError=Ql(Error,"UnboundTypeError"),af(),y.createPreloadedFile=su,y.staticInit();var _u={G:yl,O:xl,a:El,k:wl,na:Ml,h:_l,ma:Rl,e:Tl,fa:bl,Da:Al,ea:Sl,Aa:Nl,z:ef,y:rf,j:nf,za:Oi,S:lf,u:ff,$:hf,o:df,C:gf,t:mf,D:vf,_:xf,R:bf,F:Af,Ea:Sf,Ca:If,pa:Cf,Ia:Nf,va:Of,Ka:es,Ha:Df,Ba:kf,Ja:Uf,Ga:Lf,L:Bf,aa:jf,ja:Vf,La:zf,I:Gf,oa:Wf,ha:Kf,ia:Jf,ka:au,la:cu,ca:fu,V:hu,sa:sh,K:Nu,w:Su,B:Bu,P:Uu,qa:ah,T:lh,q:eh,d:Cu,b:bu,m:Au,l:ku,A:Ou,E:oh,U:ch,N:fh,da:hh,ba:dh,i:Lu,g:Iu,xa:qu,f:Fu,J:Gu,Z:Vu,ya:zu,s:Wu,ua:rh,ta:nh,wa:Hu,c:Ru,Q:th,Fa:$u,n:Du,x:ju,ra:ih,Y:Ku,r:Xu,v:Zu,W:Qu,H:Yu,p:Pu,M:uh,X:Ju,ga:vu},Ce=vl(),zi=i=>(zi=Ce.Oa)(i),fs=i=>(fs=Ce.Qa)(i),wt=i=>(wt=Ce.Ra)(i),se=(i,o)=>(se=Ce.Sa)(i,o),Gi=i=>(Gi=Ce.Ta)(i),qi=i=>(qi=Ce.Ua)(i),Hi=()=>(Hi=Ce.Va)(),Wi=i=>(Wi=Ce.Wa)(i),Xi=i=>(Xi=Ce.Xa)(i),Yi=(i,o,f)=>(Yi=Ce.Ya)(i,o,f),Ki=i=>(Ki=Ce.Za)(i),Ji=n.dynCall_iiij=(i,o,f,h,p)=>(Ji=n.dynCall_iiij=Ce._a)(i,o,f,h,p);n.dynCall_viijii=(i,o,f,h,p,v,w)=>(n.dynCall_viijii=Ce.$a)(i,o,f,h,p,v,w),n.dynCall_jiji=(i,o,f,h,p)=>(n.dynCall_jiji=Ce.ab)(i,o,f,h,p);var Zi=n.dynCall_jiiii=(i,o,f,h,p)=>(Zi=n.dynCall_jiiii=Ce.bb)(i,o,f,h,p);n.dynCall_iiiiij=(i,o,f,h,p,v,w)=>(n.dynCall_iiiiij=Ce.cb)(i,o,f,h,p,v,w),n.dynCall_iiiiijj=(i,o,f,h,p,v,w,R,O)=>(n.dynCall_iiiiijj=Ce.db)(i,o,f,h,p,v,w,R,O),n.dynCall_iiiiiijj=(i,o,f,h,p,v,w,R,O,P)=>(n.dynCall_iiiiiijj=Ce.eb)(i,o,f,h,p,v,w,R,O,P);function Ru(i,o,f,h){var p=ae();try{ne(i)(o,f,h)}catch(v){if(ie(p),v!==v+0)throw v;se(1,0)}}function bu(i,o,f){var h=ae();try{return ne(i)(o,f)}catch(p){if(ie(h),p!==p+0)throw p;se(1,0)}}function Au(i,o,f,h){var p=ae();try{return ne(i)(o,f,h)}catch(v){if(ie(p),v!==v+0)throw v;se(1,0)}}function Su(i,o,f,h,p,v){var w=ae();try{return ne(i)(o,f,h,p,v)}catch(R){if(ie(w),R!==R+0)throw R;se(1,0)}}function Iu(i,o){var f=ae();try{ne(i)(o)}catch(h){if(ie(f),h!==h+0)throw h;se(1,0)}}function Cu(i,o){var f=ae();try{return ne(i)(o)}catch(h){if(ie(f),h!==h+0)throw h;se(1,0)}}function Nu(i,o,f,h){var p=ae();try{return ne(i)(o,f,h)}catch(v){if(ie(p),v!==v+0)throw v;se(1,0)}}function Fu(i,o,f){var h=ae();try{ne(i)(o,f)}catch(p){if(ie(h),p!==p+0)throw p;se(1,0)}}function Ou(i,o,f,h,p,v){var w=ae();try{return ne(i)(o,f,h,p,v)}catch(R){if(ie(w),R!==R+0)throw R;se(1,0)}}function Du(i,o,f,h,p){var v=ae();try{ne(i)(o,f,h,p)}catch(w){if(ie(v),w!==w+0)throw w;se(1,0)}}function $u(i,o,f,h,p,v,w,R){var O=ae();try{ne(i)(o,f,h,p,v,w,R)}catch(P){if(ie(O),P!==P+0)throw P;se(1,0)}}function Pu(i,o,f,h,p,v,w,R,O,P,L){var X=ae();try{ne(i)(o,f,h,p,v,w,R,O,P,L)}catch(Y){if(ie(X),Y!==Y+0)throw Y;se(1,0)}}function ku(i,o,f,h,p){var v=ae();try{return ne(i)(o,f,h,p)}catch(w){if(ie(v),w!==w+0)throw w;se(1,0)}}function Uu(i,o,f){var h=ae();try{return ne(i)(o,f)}catch(p){if(ie(h),p!==p+0)throw p;se(1,0)}}function Lu(i){var o=ae();try{ne(i)()}catch(f){if(ie(o),f!==f+0)throw f;se(1,0)}}function Bu(i,o){var f=ae();try{return ne(i)(o)}catch(h){if(ie(f),h!==h+0)throw h;se(1,0)}}function ju(i,o,f,h,p,v){var w=ae();try{ne(i)(o,f,h,p,v)}catch(R){if(ie(w),R!==R+0)throw R;se(1,0)}}function Vu(i,o,f,h,p){var v=ae();try{ne(i)(o,f,h,p)}catch(w){if(ie(v),w!==w+0)throw w;se(1,0)}}function zu(i,o,f,h,p,v,w,R,O){var P=ae();try{ne(i)(o,f,h,p,v,w,R,O)}catch(L){if(ie(P),L!==L+0)throw L;se(1,0)}}function Gu(i,o,f,h,p,v){var w=ae();try{ne(i)(o,f,h,p,v)}catch(R){if(ie(w),R!==R+0)throw R;se(1,0)}}function qu(i,o,f,h){var p=ae();try{ne(i)(o,f,h)}catch(v){if(ie(p),v!==v+0)throw v;se(1,0)}}function Hu(i,o,f,h,p,v,w){var R=ae();try{ne(i)(o,f,h,p,v,w)}catch(O){if(ie(R),O!==O+0)throw O;se(1,0)}}function Wu(i,o,f,h){var p=ae();try{ne(i)(o,f,h)}catch(v){if(ie(p),v!==v+0)throw v;se(1,0)}}function Xu(i,o,f,h,p,v,w){var R=ae();try{ne(i)(o,f,h,p,v,w)}catch(O){if(ie(R),O!==O+0)throw O;se(1,0)}}function Yu(i,o,f,h,p,v,w,R,O,P,L,X,Y,J){var Q=ae();try{ne(i)(o,f,h,p,v,w,R,O,P,L,X,Y,J)}catch(pe){if(ie(Q),pe!==pe+0)throw pe;se(1,0)}}function Ku(i,o,f,h,p,v,w){var R=ae();try{ne(i)(o,f,h,p,v,w)}catch(O){if(ie(R),O!==O+0)throw O;se(1,0)}}function Ju(i,o,f,h,p,v,w,R,O,P,L,X,Y,J,Q,pe,we,C,S){var $=ae();try{ne(i)(o,f,h,p,v,w,R,O,P,L,X,Y,J,Q,pe,we,C,S)}catch(j){if(ie($),j!==j+0)throw j;se(1,0)}}function Zu(i,o,f,h,p,v,w,R){var O=ae();try{ne(i)(o,f,h,p,v,w,R)}catch(P){if(ie(O),P!==P+0)throw P;se(1,0)}}function Qu(i,o,f,h,p,v,w,R,O,P){var L=ae();try{ne(i)(o,f,h,p,v,w,R,O,P)}catch(X){if(ie(L),X!==X+0)throw X;se(1,0)}}function eh(i){var o=ae();try{return ne(i)()}catch(f){if(ie(o),f!==f+0)throw f;se(1,0)}}function th(i,o,f,h,p){var v=ae();try{ne(i)(o,f,h,p)}catch(w){if(ie(v),w!==w+0)throw w;se(1,0)}}function rh(i,o,f,h,p){var v=ae();try{ne(i)(o,f,h,p)}catch(w){if(ie(v),w!==w+0)throw w;se(1,0)}}function nh(i,o,f,h,p,v){var w=ae();try{ne(i)(o,f,h,p,v)}catch(R){if(ie(w),R!==R+0)throw R;se(1,0)}}function sh(i){var o=ae();try{return ne(i)()}catch(f){if(ie(o),f!==f+0)throw f;se(1,0)}}function ih(i,o,f,h,p,v,w){var R=ae();try{ne(i)(o,f,h,p,v,w)}catch(O){if(ie(R),O!==O+0)throw O;se(1,0)}}function ah(i,o,f,h){var p=ae();try{return ne(i)(o,f,h)}catch(v){if(ie(p),v!==v+0)throw v;se(1,0)}}function oh(i,o,f,h,p,v,w){var R=ae();try{return ne(i)(o,f,h,p,v,w)}catch(O){if(ie(R),O!==O+0)throw O;se(1,0)}}function ch(i,o,f,h,p,v,w,R){var O=ae();try{return ne(i)(o,f,h,p,v,w,R)}catch(P){if(ie(O),P!==P+0)throw P;se(1,0)}}function lh(i,o,f,h){var p=ae();try{return ne(i)(o,f,h)}catch(v){if(ie(p),v!==v+0)throw v;se(1,0)}}function fh(i,o,f,h,p,v,w,R,O,P,L,X){var Y=ae();try{return ne(i)(o,f,h,p,v,w,R,O,P,L,X)}catch(J){if(ie(Y),J!==J+0)throw J;se(1,0)}}function uh(i,o,f,h,p,v,w,R,O,P,L,X,Y,J,Q,pe){var we=ae();try{ne(i)(o,f,h,p,v,w,R,O,P,L,X,Y,J,Q,pe)}catch(C){if(ie(we),C!==C+0)throw C;se(1,0)}}function hh(i,o,f,h,p){var v=ae();try{return Ji(i,o,f,h,p)}catch(w){if(ie(v),w!==w+0)throw w;se(1,0)}}function dh(i,o,f,h,p){var v=ae();try{return Zi(i,o,f,h,p)}catch(w){if(ie(v),w!==w+0)throw w;se(1,0)}}n.addFunction=Sr,n.removeFunction=Ir;var pn;Ee=function i(){pn||Qi(),pn||(Ee=i)};function Qi(){if(Ze>0||(_e(),Ze>0))return;function i(){pn||(pn=!0,n.calledRun=!0,!U&&(ke(),s(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),be()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),i()},1)):i()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return Qi(),r=c,r}})();const mt="EXT_mesh_manifold",Sa="MERGE";class pi extends $e{static EXTENSION_NAME=mt;init(){pi.EXTENSION_NAME=mt,this.propertyType="ManifoldPrimitive",this.parentTypes=[W.MESH]}getDefaults(){return Object.assign(super.getDefaults(),{manifoldPrimitive:null,mergeIndices:null,mergeValues:null})}getMergeIndices(){return this.getRef("mergeIndices")}getMergeValues(){return this.getRef("mergeValues")}setMerge(e,r){if(e.getCount()!==r.getCount())throw new Error("merge vectors must be the same length.");return this.setRef("mergeIndices",e),this.setRef("mergeValues",r)}getRunIndex(){return this.get("runIndex")}setRunIndex(e){return this.set("runIndex",e)}setIndices(e){return this.setRef("indices",e)}getIndices(){return this.getRef("indices")}}class sl extends Se{extensionName=mt;prewriteTypes=[W.ACCESSOR];static EXTENSION_NAME=mt;createManifoldPrimitive(){return new pi(this.document.getGraph())}read(e){const{json:r}=e.jsonDoc;return(r.meshes||[]).forEach((s,a)=>{if(!s.extensions||!s.extensions[mt])return;const c=e.meshes[a],l=this.createManifoldPrimitive();c.setExtension(mt,l);const u=s.extensions[mt];if(u.manifoldPrimitive){let d=0;const g=Array();g.push(d);for(const T of c.listPrimitives()){const E=T.getIndices();if(!E){console.log("Skipping non-indexed primitive ",T.getName());continue}d+=E.getCount(),g.push(d)}l.setRunIndex(g),l.setIndices(e.accessors[u.manifoldPrimitive.indices])}u.mergeIndices!=null&&u.mergeValues!=null&&l.setMerge(e.accessors[u.mergeIndices],e.accessors[u.mergeValues])}),this}prewrite(e){return this.document.getRoot().listMeshes().forEach(r=>{const n=r.getExtension(mt);if(!n)return;const s=n.getIndices();e.addAccessorToUsageGroup(s,ft.BufferViewUsage.ELEMENT_ARRAY_BUFFER);const a=n.getMergeIndices(),c=n.getMergeValues();!a||!c||(e.addAccessorToUsageGroup(a,Sa),e.addAccessorToUsageGroup(c,Sa))}),this}write(e){const{json:r}=e.jsonDoc;return this.document.getRoot().listMeshes().forEach(n=>{const s=n.getExtension(mt);if(!s)return;const a=e.meshIndexMap.get(n),c=r.meshes[a],l=s.getRunIndex(),u=l.length-1;if(u!==c.primitives.length)throw new Error("The number of primitives must be exactly one less than the length of runIndex.");const d=e.accessorIndexMap.get(s.getMergeIndices()),g=e.accessorIndexMap.get(s.getMergeValues()),T=r.accessors[d],E=r.accessors[g],M=c.primitives[0],A={indices:e.accessorIndexMap.get(s.getIndices()),mode:M.mode,attributes:{POSITION:M.attributes.POSITION}},N=r.accessors[A.indices];if(N){T&&E&&(N.sparse={count:T.count,indices:{bufferView:T.bufferView,byteOffset:T.byteOffset,componentType:T.componentType},values:{bufferView:E.bufferView,byteOffset:E.byteOffset}});for(let m=0;m<u;++m){const I=r.accessors[c.primitives[m].indices];I.bufferView=N.bufferView,I.byteOffset=N.byteOffset+4*l[m],I.count=l[m+1]-l[m]}c.extensions=c.extensions||{},c.extensions[mt]={manifoldPrimitive:A,mergeIndices:d,mergeValues:g}}}),this}}const Or={POSITION:{type:te.Type.VEC3,components:3},NORMAL:{type:te.Type.VEC3,components:3},TANGENT:{type:te.Type.VEC4,components:4},TEXCOORD_0:{type:te.Type.VEC2,components:2},TEXCOORD_1:{type:te.Type.VEC2,components:2},COLOR_0:{type:te.Type.VEC3,components:3},JOINTS_0:{type:te.Type.VEC4,components:4},WEIGHTS_0:{type:te.Type.VEC4,components:4},SKIP_1:{type:null,components:1},SKIP_2:{type:null,components:2},SKIP_3:{type:null,components:3},SKIP_4:{type:null,components:4}};function cv(t){return t.registerExtensions([sl])}function Ia(t,e,r){t.getRoot().listBuffers().length===0&&t.createBuffer();const n=t.getRoot().listBuffers()[0],s=t.createExtension(sl),a=t.createMesh(),c=Array(),l=Array(),u=new Map,d=e.runIndex.length-1;let g=-1;for(let _=0;_<d;++_){const b=e.runOriginalID[_];if(b==g)continue;g=b,c.push(e.runIndex[_]);const F=t.createAccessor("primitive indices of ID "+b).setBuffer(n).setType(te.Type.SCALAR).setArray(new Uint32Array(1)),D=t.createPrimitive().setIndices(F),V=r.get(b);if(V){const{material:B,attributes:U}=V;if(U.length<1||U[0]!=="POSITION")throw new Error('First attribute must be "POSITION".');D.setMaterial(B),u.set(D,U),V.attributes.forEach((z,G)=>{if(G>=l.length)l.push(z);else{const K=Or[z].components,H=Or[l[G]].components;if(K!=H)throw new Error("Attribute sizes do not correspond: "+z+" and "+l[G]);Or[l[G]].type==null&&(l[G]=z)}})}else u.set(D,["POSITION"]);a.addPrimitive(D)}c.push(e.runIndex[d]);const T=e.numVert,E=e.numProp;let M=0;l.forEach((_,b)=>{const F=Or[_];if(F==null)throw new Error(_+" is not a recognized attribute.");if(F.type==null){++M;return}const D=F.components;if(M+D>E)throw new Error("Too many attribute channels.");const V=new Float32Array(D*T);for(let U=0;U<T;++U)for(let z=0;z<D;++z){let G=e.vertProperties[E*U+M+z];_=="COLOR_0"&&(G=Math.max(0,Math.min(1,G))),V[D*U+z]=G}const B=t.createAccessor(_).setBuffer(n).setType(F.type).setArray(V);for(const U of a.listPrimitives()){const z=u.get(U);z.length>b&&Or[z[b]].type!=null&&U.setAttribute(_,B)}M+=D});const A=s.createManifoldPrimitive();a.setExtension("EXT_mesh_manifold",A);const N=t.createAccessor("manifold indices").setBuffer(n).setType(te.Type.SCALAR).setArray(e.triVerts);A.setIndices(N),A.setRunIndex(c);const m=[...Array(e.numVert).keys()],I=Array(),x=Array();if(e.mergeFromVert&&e.mergeToVert){for(const[_,b]of e.mergeFromVert.entries())m[b]=e.mergeToVert[_];for(const[_,b]of e.triVerts.entries()){const F=m[b];b!==F&&(I.push(_),x.push(F))}}if(I.length>0){const _=t.createAccessor("merge from").setBuffer(n).setType(te.Type.SCALAR).setArray(new Uint32Array(I)),b=t.createAccessor("merge to").setBuffer(n).setType(te.Type.SCALAR).setArray(new Uint32Array(x));A.setMerge(_,b)}return a}const it=await ov();it.setup();Ho(Array);const il=cv(new kh);il.registerExtensions($o);const lv=["cube","cylinder","sphere","tetrahedron","extrude","revolve","compose","union","difference","intersection","levelSet","smooth","ofMesh","hull"],fv=["add","subtract","intersect","decompose","warp","transform","translate","rotate","scale","mirror","calculateCurvature","calculateNormals","smoothByNormals","smoothOut","refine","refineToLength","setProperties","asOriginal","trimByPlane","split","splitByPlane","slice","project","hull"],uv=["square","circle","union","difference","intersection","compose","ofPolygons","hull"],hv=["add","subtract","intersect","rectClip","decompose","transform","translate","rotate","scale","mirror","simplify","offset","hull"],al=["show","only","setMaterial"],dv=["setMinCircularAngle","setMinCircularEdgeLength","setCircularSegments","getCircularSegments","resetToCircularDefaults","Mesh","GLTFNode","Manifold","CrossSection","setMorphStart","setMorphEnd"],pv=al.concat(dv),On=new Array;function jn(t,e,r){const n=it[t],s=r?n:n.prototype;for(const a of e){const c=s[a];s[a]=function(...l){const u=c(...l);return On.push(u),u}}}jn("Manifold",fv,!1);jn("Manifold",lv,!0);jn("CrossSection",hv,!1);jn("CrossSection",uv,!0);for(const t of al){const e=it[t];it[t]=function(...r){const n=e(...r);return On.push(n),n}}let gi=!1;const Dn=new Map,mi=new Map,gv=30,ol={roughness:.2,metallic:1,baseColorFactor:[1,1,0],alpha:1,unlit:!1,animationLength:1,animationMode:"loop"},mv={baseColorFactor:[1,0,0],alpha:.25,roughness:1,metallic:0},vv={baseColorFactor:[.5,.5,.5],alpha:.25,roughness:1,metallic:0},Yt=new Array,$n=new Map,_n=new Map,Zt=new Map,er=new Map;let Yr=1,pr,qr,vs,Rn,Pn;function yv(){for(const t of On)if(t instanceof Array)for(const e of t)e.delete();else t.delete();On.length=0,gi=!1,Dn.clear(),mi.clear(),Yt.length=0,$n.clear(),_n.clear(),Zt.clear(),er.clear(),Yr=1}class xv{_parent;manifold;translation;rotation;scale;material;name;constructor(e){this._parent=e,Yt.push(this)}clone(e){const r={...this};return r._parent=e,Yt.push(r),r}get parent(){return this._parent}}it.GLTFNode=xv;const Wt={...ol};it.setMaterial=(t,e)=>{const r=t.asOriginal();return $n.set(r.originalID(),e),r};it.setMorphStart=(t,e)=>{const r=er.get(t);r!=null?r.start=e:er.set(t,{start:e})};it.setMorphEnd=(t,e)=>{const r=er.get(t);r!=null?r.end=e:er.set(t,{end:e})};function cl(t,e){let r=t.asOriginal();return e.set(r.originalID(),r.getMesh()),r}it.show=t=>cl(t,Dn);it.only=t=>(gi=!0,cl(t,mi));function hr(...t){typeof self<"u"&&self.console&&self.console.log(...t)}function ll(t){const{quat:e}=nl,r=Math.PI/180,n=e.create();return e.rotateZ(n,n,r*t[2]),e.rotateY(n,n,r*t[1]),e.rotateX(n,n,r*t[0]),n}function ys(t,e,r,n){const s=r[e];if(s==null)return null;if(typeof s!="function")return s;const a=qr.getCount(),c=e=="rotation"?4:3,l=new Float32Array(c*a);for(let T=0;T<a;++T){const E=T/(a-1),M=s(Wt.animationMode!=="ping-pong"?E:(1-Math.cos(E*2*Math.PI))/2);l.set(c===4?ll(M):M,c*T)}const u=t.createAccessor(r.name+" "+e+" frames").setBuffer(t.getRoot().listBuffers()[0]).setArray(l).setType(c===4?te.Type.VEC4:te.Type.VEC3),d=t.createAnimationSampler().setInput(qr).setOutput(u).setInterpolation("LINEAR"),g=t.createAnimationChannel().setTargetPath(e).setTargetNode(n).setSampler(d);return pr.addSampler(d),pr.addChannel(g),Pn=!0,s(0)}function Tv(t,e,r){if(er.has(r)){const n=t.createAnimationChannel().setTargetPath("weights").setTargetNode(e).setSampler(Rn);pr.addChannel(n),Pn=!0}}function Ev(t,e){const r=[];if(e==null)return r;for(let n=0;n<t.numVert;++n)for(let s=0;s<3;++s)r[n*3+s]=t.vertProperties[n*t.numProp+s];if(e.start)for(let n=0;n<t.numVert;++n){const s=t.vertProperties,a=n*t.numProp,c=r.slice(a,a+3);e.start(c);for(let l=0;l<3;++l)s[a+l]=c[l]}return r}function wv(t,e,r,n,s){s!=null&&(r.setWeights([0]),r.listPrimitives().forEach((a,c)=>{if(s.end)for(let E=0;E<e.numVert;++E){const M=n.slice(3*E,3*(E+1));s.end(M),n.splice(3*E,3,...M)}const l=a.getAttribute("POSITION").getArray(),u=new Float32Array(l.length),d=e.runIndex[c];for(let E=0;E<u.length;++E)u[E]=n[d+E]-l[E];const g=t.createAccessor(r.getName()+" morph target").setBuffer(t.getRoot().listBuffers()[0]).setArray(u).setType(te.Type.VEC3),T=t.createPrimitiveTarget().setAttribute("POSITION",g);a.addTarget(T)}))}function Mv(t,e){const r=t.createNode(e.name),n=ys(t,"translation",e,r);n!=null&&r.setTranslation(n);const s=ys(t,"rotation",e,r);s!=null&&r.setRotation(ll(s));const a=ys(t,"scale",e,r);return a!=null&&r.setScale(a),r}function fl(t){return t==null?{}:(t.material==null&&(t.material=fl(t.parent)),t.material)}function _v(t,e={}){const r={...Wt};Object.assign(r,e);const{roughness:n,metallic:s,baseColorFactor:a,alpha:c,unlit:l}=r,u=t.createMaterial(e.name??"");if(l){const d=t.createExtension(ti).createUnlit();u.setExtension("KHR_materials_unlit",d)}return c<1&&u.setAlphaMode(yr.AlphaMode.BLEND).setDoubleSided(!0),u.setRoughnessFactor(n).setMetallicFactor(s).setBaseColorFactor([...a,c])}function kn(t,e){return _n.has(e)||_n.set(e,_v(t,e)),_n.get(e)}function ul(t,e,r,n,s={}){const a=n.numTri();if(a==0){hr("Empty manifold, skipping.");return}hr(`Triangles: ${a.toLocaleString()}`);const c=n.boundingBox(),l=[0,0,0];for(let N=0;N<3;N++)l[N]=Math.round((c.max[N]-c.min[N])*10)/10;hr(`Bounding Box: X = ${l[0].toLocaleString()} mm, Y = ${l[1].toLocaleString()} mm, Z = ${l[2].toLocaleString()} mm`);const u=Math.round(n.getProperties().volume/10);hr(`Genus: ${n.genus().toLocaleString()}, Volume: ${(u/100).toLocaleString()} cm^3`);const d=n.getMesh(),g=new Map;for(const N of d.runOriginalID){const m=$n.get(N)||s;g.set(N,{material:kn(t,gi?vv:m),attributes:["POSITION",...m.attributes??[]]})}const T=er.get(n),E=Ev(d,T),M=Ia(t,d,g);M.setName(r.getName()),r.setMesh(M),wv(t,d,M,E,T);const A=d.numProp===3?d.vertProperties:new Float32Array(d.numVert*3);if(d.numProp>3)for(let N=0;N<d.numVert;++N)for(let m=0;m<3;++m)A[N*3+m]=d.vertProperties[N*d.numProp+m];Zt.set(n,Yr),e.meshes.push({vertices:A,indices:d.triVerts,id:`${Yr++}`});for(const[N,m]of d.runOriginalID.entries()){const I=Dn.has(m),x=I?Dn.get(m):mi.get(m);if(x==null)continue;g.get(m).material=kn(t,I?mv:$n.get(m)||s);const _=t.createNode("debug").setMesh(Ia(t,x,g)).setMatrix(d.transform(N));r.addChild(_)}}function hl(t,e){t.setMesh(e.getMesh()),e.listChildren().forEach(r=>{const n=r.clone();t.addChild(n)})}function Rv(t,e,r,n,s){hl(e,r);const a=t.createMesh();e.setMesh(a),r.getMesh().listPrimitives().forEach(c=>{const l=c.clone();c.getMaterial()===s&&l.setMaterial(n),a.addPrimitive(l)})}function bv(t,e,r,n){const s=Mv(t,r),{manifold:a}=r;if(a!=null){Tv(t,s,a);const c=fl(r),l=n.get(a);if(l==null){ul(t,e,s,a,c);const u=new Map;u.set(c,s),n.set(a,u)}else{const u=l.get(c);if(u==null){const[d,g]=l.entries().next().value;Rv(t,s,g,kn(t,c),kn(t,d)),l.set(c,s)}else hl(s,u)}}return Zt.set(r,Yr),e.components.push({id:`${Yr++}`,name:r.name,children:a==null?[]:[{objectID:`${Zt.get(a)}`}]}),s}async function dl(t,e){Object.assign(Wt,ol),Object.assign(Wt,t);const r=new Bs,n=Math.sqrt(2)/2,s=1/1e3,a=r.createNode("wrapper").setRotation([-n,0,0,n]).setScale([s,s,s]);r.createScene().addChild(a),pr=r.createAnimation(""),Pn=!1;const c=Math.round(Wt.animationLength*gv)+1,l=new Float32Array(c),u=new Float32Array(c);for(let I=0;I<c;++I){const x=I/(c-1);l[I]=x*Wt.animationLength,u[I]=Wt.animationMode!=="ping-pong"?x:(1-Math.cos(x*2*Math.PI))/2}qr=r.createAccessor("animation times").setBuffer(r.createBuffer()).setArray(l).setType(te.Type.SCALAR),vs=r.createAccessor("animation weights").setBuffer(r.getRoot().listBuffers()[0]).setArray(u).setType(te.Type.SCALAR),Rn=r.createAnimationSampler().setInput(qr).setOutput(vs).setInterpolation("LINEAR"),pr.addSampler(Rn);const d={meshes:[],components:[],items:[],precision:7,header:{unit:"millimeter",title:"ManifoldCAD.org model",description:"ManifoldCAD.org model",application:"ManifoldCAD.org"}};if(Yt.length>0){const I=new Map,x=new Map;let _=0;for(const b of Yt)I.set(b,bv(r,d,b,x)),b.manifold&&++_;for(const b of Yt){const F=I.get(b),D={objectID:`${Zt.get(b)}`,transform:F.getMatrix()},{parent:V}=b;V==null?(a.addChild(F),d.items.push(D)):(I.get(V).addChild(F),d.components.find(U=>U.id==`${Zt.get(V)}`).children.push(D))}hr("Total glTF nodes: ",Yt.length,", Total mesh references: ",_)}else{if(e==null){hr('No output because "result" is undefined and no "GLTFNode"s were created.');return}const I=r.createNode();ul(r,d,I,e),a.addChild(I),d.items.push({objectID:`${Zt.get(e)}`})}Pn||(qr.dispose(),vs.dispose(),Rn.dispose(),pr.dispose());const g=await il.writeBinary(r),T=new Blob([g],{type:"application/octet-stream"}),E=new Dd;E.add3dModel("3D/3dmodel.model");const M=Od(d),A={};A["3D/3dmodel.model"]=Gr(M),A[Ea.name]=Gr(Ea.content),A[E.name]=Gr(E.content);const N=Yd(A),m=new Blob([N],{type:"application/vnd.ms-package.3dmanufacturing-3dmodel+xml"});return{glbURL:URL.createObjectURL(T),threeMFURL:URL.createObjectURL(m)}}function Av(t){const e={},r={globalDefaults:e,exportModels:dl,glMatrix:nl,module:it,...Object.fromEntries(pv.map(a=>[a,it[a]]))},s=new Function(...Object.keys(r),`resetToCircularDefaults();
`+t+`
 return typeof result === "undefined" ? undefined : result;`)(...Object.values(r));return{globalDefaults:e,manifold:s}}async function Sv(t){const{globalDefaults:e,manifold:r}=Av(t);return await dl(e,r)}self.postMessage(null);if(self.console){const t=self.console.log;self.console.log=function(...e){let r="";for(const n of e)n==null?r+="undefined":typeof n=="object"?r+=JSON.stringify(n,null,4):r+=n.toString();self.postMessage({log:r}),t(...e)}}self.onmessage=async t=>{try{const e=await Sv(t.data);self.postMessage(e)}catch(e){console.log(e.toString()),self.postMessage({objectURL:null})}finally{yv()}};
//# sourceMappingURL=worker-wrapper-a130e168.js.map
